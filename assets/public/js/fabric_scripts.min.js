(function(d,c){var b=0,a=Array.prototype.slice,e=d.cleanData;d.cleanData=function(a){for(var f=0,b;null!=(b=a[f]);f++)try{d(b).triggerHandler("remove")}catch(c){}e(a)};d.widget=function(a,f,e){var b,c,p,m,n=a.split(".")[0];a=a.split(".")[1];b=n+"-"+a;e||(e=f,f=d.Widget);d.expr[":"][b.toLowerCase()]=function(f){return!!d.data(f,b)};d[n]=d[n]||{};c=d[n][a];p=d[n][a]=function(f,a){if(!this._createWidget)return new p(f,a);arguments.length&&this._createWidget(f,a)};d.extend(p,c,{version:e.version,_proto:d.extend({},
e),_childConstructors:[]});m=new f;m.options=d.widget.extend({},m.options);d.each(e,function(a,b){d.isFunction(b)&&(e[a]=function(){var e=function(){return f.prototype[a].apply(this,arguments)},c=function(e){return f.prototype[a].apply(this,e)};return function(){var f=this._super,a=this._superApply,h;return this._super=e,this._superApply=c,h=b.apply(this,arguments),this._super=f,this._superApply=a,h}}())});p.prototype=d.widget.extend(m,{widgetEventPrefix:m.widgetEventPrefix||a},e,{constructor:p,namespace:n,
widgetName:a,widgetBaseClass:b,widgetFullName:b});c?(d.each(c._childConstructors,function(f,a){var e=a.prototype;d.widget(e.namespace+"."+e.widgetName,p,a._proto)}),delete c._childConstructors):f._childConstructors.push(p);d.widget.bridge(a,p)};d.widget.extend=function(e){for(var f=a.call(arguments,1),b=0,k=f.length,l,p;b<k;b++)for(l in f[b])p=f[b][l],f[b].hasOwnProperty(l)&&p!==c&&(d.isPlainObject(p)?e[l]=d.isPlainObject(e[l])?d.widget.extend({},e[l],p):d.widget.extend({},p):e[l]=p);return e};d.widget.bridge=
function(e,f){var b=f.prototype.widgetFullName;d.fn[e]=function(k){var l="string"==typeof k,p=a.call(arguments,1),m=this;return k=!l&&p.length?d.widget.extend.apply(null,[k].concat(p)):k,l?this.each(function(){var f,a=d.data(this,b);if(!a)return d.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+k+"'");if(!d.isFunction(a[k])||"_"===k.charAt(0))return d.error("no such method '"+k+"' for "+e+" widget instance");f=a[k].apply(a,p);if(f!==a&&f!==c)return m=f&&f.jquery?
m.pushStack(f.get()):f,!1}):this.each(function(){var a=d.data(this,b);a?a.option(k||{})._init():new f(k,this)}),m}};d.Widget=function(){};d.Widget._childConstructors=[];d.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(a,f){f=d(f||this.defaultElement||this)[0];this.element=d(f);this.uuid=b++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=d.widget.extend({},this.options,this._getCreateOptions(),
a);this.bindings=d();this.hoverable=d();this.focusable=d();f!==this&&(d.data(f,this.widgetName,this),d.data(f,this.widgetFullName,this),this._on(this.element,{remove:function(a){a.target===f&&this.destroy()}}),this.document=d(f.style?f.ownerDocument:f.document||f),this.window=d(this.document[0].defaultView||this.document[0].parentWindow));this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:d.noop,_getCreateEventData:d.noop,_create:d.noop,_init:d.noop,
destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(d.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:d.noop,widget:function(){return this.element},
option:function(a,f){var e=a,b,l,p;if(0===arguments.length)return d.widget.extend({},this.options);if("string"==typeof a)if(e={},b=a.split("."),a=b.shift(),b.length){l=e[a]=d.widget.extend({},this.options[a]);for(p=0;p<b.length-1;p++)l[b[p]]=l[b[p]]||{},l=l[b[p]];a=b.pop();if(f===c)return l[a]===c?null:l[a];l[a]=f}else{if(f===c)return this.options[a]===c?null:this.options[a];e[a]=f}return this._setOptions(e),this},_setOptions:function(a){for(var f in a)this._setOption(f,a[f]);return this},_setOption:function(a,
f){return this.options[a]=f,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!f).attr("aria-disabled",f),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(a,f){var e,b=this;f?(a=e=d(a),this.bindings=this.bindings.add(a)):(f=a,a=this.element,e=this.widget());d.each(f,function(f,c){function m(){if(!0!==
b.options.disabled&&!d(this).hasClass("ui-state-disabled"))return("string"==typeof c?b[c]:c).apply(b,arguments)}"string"!=typeof c&&(m.guid=c.guid=c.guid||m.guid||d.guid++);var n=f.match(/^(\w+)\s*(.*)$/),u=n[1]+b.eventNamespace;(n=n[2])?e.delegate(n,u,m):a.bind(u,m)})},_off:function(a,f){f=(f||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;a.unbind(f).undelegate(f)},_delay:function(a,f){var e=this;return setTimeout(function(){return("string"==typeof a?e[a]:a).apply(e,arguments)},
f||0)},_hoverable:function(a){this.hoverable=this.hoverable.add(a);this._on(a,{mouseenter:function(f){d(f.currentTarget).addClass("ui-state-hover")},mouseleave:function(f){d(f.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(a){this.focusable=this.focusable.add(a);this._on(a,{focusin:function(f){d(f.currentTarget).addClass("ui-state-focus")},focusout:function(f){d(f.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(a,f,e){var b,c=this.options[a];e=e||{};f=d.Event(f);
f.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase();f.target=this.element[0];if(a=f.originalEvent)for(b in a)b in f||(f[b]=a[b]);return this.element.trigger(f,e),!(d.isFunction(c)&&!1===c.apply(this.element[0],[f].concat(e))||f.isDefaultPrevented())}};d.each({show:"fadeIn",hide:"fadeOut"},function(a,f){d.Widget.prototype["_"+a]=function(e,b,c){"string"==typeof b&&(b={effect:b});var p,m=b?!0===b||"number"==typeof b?f:b.effect||f:a;b=b||{};"number"==typeof b&&(b={duration:b});
p=!d.isEmptyObject(b);b.complete=c;b.delay&&e.delay(b.delay);p&&d.effects&&(d.effects.effect[m]||!1!==d.uiBackCompat&&d.effects[m])?e[a](b):m!==a&&e[m]?e[m](b.duration,b.easing,c):e.queue(function(f){d(this)[a]();c&&c.call(e[0]);f()})}});!1!==d.uiBackCompat&&(d.Widget.prototype._getCreateOptions=function(){return d.metadata&&d.metadata.get(this.element[0])[this.widgetName]})})(jQuery);
(function(d){"function"===typeof define&&define.amd?define(["jquery"],d):d(window.jQuery)})(function(d){var c=0;d.ajaxTransport("iframe",function(b){if(b.async){var a=b.initialIframeSrc||"javascript:false;",e,g,f;return{send:function(h,k){e=d('<form style="display:none;"></form>');e.attr("accept-charset",b.formAcceptCharset);f=/\?/.test(b.url)?"&":"?";"DELETE"===b.type?(b.url=b.url+f+"_method=DELETE",b.type="POST"):"PUT"===b.type?(b.url=b.url+f+"_method=PUT",b.type="POST"):"PATCH"===b.type&&(b.url=
b.url+f+"_method=PATCH",b.type="POST");c+=1;g=d('<iframe src="'+a+'" name="iframe-transport-'+c+'"></iframe>').bind("load",function(){var f,c=d.isArray(b.paramName)?b.paramName:[b.paramName];g.unbind("load").bind("load",function(){var f;try{if(f=g.contents(),!f.length||!f[0].firstChild)throw Error();}catch(b){f=void 0}k(200,"success",{iframe:f});d('<iframe src="'+a+'"></iframe>').appendTo(e);window.setTimeout(function(){e.remove()},0)});e.prop("target",g.prop("name")).prop("action",b.url).prop("method",
b.type);b.formData&&d.each(b.formData,function(f,a){d('<input type="hidden"/>').prop("name",a.name).val(a.value).appendTo(e)});b.fileInput&&b.fileInput.length&&"POST"===b.type&&(f=b.fileInput.clone(),b.fileInput.after(function(a){return f[a]}),b.paramName&&b.fileInput.each(function(f){d(this).prop("name",c[f]||b.paramName)}),e.append(b.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),b.fileInput.removeAttr("form"));e.submit();f&&f.length&&b.fileInput.each(function(a,
b){var e=d(f[a]);d(b).prop("name",e.prop("name")).attr("form",e.attr("form"));e.replaceWith(b)})});e.append(g).appendTo(document.body)},abort:function(){g&&g.unbind("load").prop("src",a);e&&e.remove()}}}});d.ajaxSetup({converters:{"iframe text":function(b){return b&&d(b[0].body).text()},"iframe json":function(b){return b&&d.parseJSON(d(b[0].body).text())},"iframe html":function(b){return b&&d(b[0].body).html()},"iframe xml":function(b){return(b=b&&b[0])&&d.isXMLDoc(b)?b:d.parseXML(b.XMLDocument&&
b.XMLDocument.xml||d(b.body).html())},"iframe script":function(b){return b&&d.globalEval(d(b[0].body).text())}}})});
(function(d){"function"===typeof define&&define.amd?define(["jquery","jquery.ui.widget"],d):d(window.jQuery)})(function(d){d.support.fileInput=!(/(Android (1\.[0156]|2\.[01]))|(Windows Phone (OS 7|8\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1\.0|2\.[05]|3\.0))/.test(window.navigator.userAgent)||d('<input type="file">').prop("disabled"));d.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader);d.support.xhrFormDataFileUpload=!!window.FormData;d.support.blobSlice=
window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);d.widget("blueimp.fileupload",{options:{dropZone:d(document),pasteZone:d(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,
uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(c,b){c=this.messages[c]||c.toString();b&&d.each(b,function(a,e){c=c.replace("{"+a+"}",e)});return c},formData:function(c){return c.serializeArray()},add:function(c,b){if(c.isDefaultPrevented())return!1;(b.autoUpload||!1!==b.autoUpload&&d(this).fileupload("option","autoUpload"))&&b.process().done(function(){b.submit()})},processData:!1,
contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:d.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.bitrate=this.loaded=0;this.getBitrate=function(c,b,a){var e=c-this.timestamp;if(!this.bitrate||!a||e>a)this.bitrate=1E3/e*(b-this.loaded)*8,this.loaded=b,this.timestamp=c;return this.bitrate}},
_isXHRUpload:function(c){return!c.forceIframeTransport&&(!c.multipart&&d.support.xhrFileUpload||d.support.xhrFormDataFileUpload)},_getFormData:function(c){var b;return"function"===d.type(c.formData)?c.formData(c.form):d.isArray(c.formData)?c.formData:"object"===d.type(c.formData)?(b=[],d.each(c.formData,function(a,e){b.push({name:a,value:e})}),b):[]},_getTotal:function(c){var b=0;d.each(c,function(a,e){b+=e.size||1});return b},_initProgressObject:function(c){var b={loaded:0,total:0,bitrate:0};c._progress?
d.extend(c._progress,b):c._progress=b},_initResponseObject:function(c){var b;if(c._response)for(b in c._response)c._response.hasOwnProperty(b)&&delete c._response[b];else c._response={}},_onProgress:function(c,b){if(c.lengthComputable){var a=Date.now?Date.now():(new Date).getTime(),e;b._time&&b.progressInterval&&a-b._time<b.progressInterval&&c.loaded!==c.total||(b._time=a,e=Math.floor(c.loaded/c.total*(b.chunkSize||b._progress.total))+(b.uploadedBytes||0),this._progress.loaded+=e-b._progress.loaded,
this._progress.bitrate=this._bitrateTimer.getBitrate(a,this._progress.loaded,b.bitrateInterval),b._progress.loaded=b.loaded=e,b._progress.bitrate=b.bitrate=b._bitrateTimer.getBitrate(a,e,b.bitrateInterval),this._trigger("progress",d.Event("progress",{delegatedEvent:c}),b),this._trigger("progressall",d.Event("progressall",{delegatedEvent:c}),this._progress))}},_initProgressListener:function(c){var b=this,a=c.xhr?c.xhr():d.ajaxSettings.xhr();a.upload&&(d(a.upload).bind("progress",function(a){var g=
a.originalEvent;a.lengthComputable=g.lengthComputable;a.loaded=g.loaded;a.total=g.total;b._onProgress(a,c)}),c.xhr=function(){return a})},_isInstanceOf:function(c,b){return Object.prototype.toString.call(b)==="[object "+c+"]"},_initXHRData:function(c){var b=this,a,e=c.files[0],g=c.multipart||!d.support.xhrFileUpload,f="array"===d.type(c.paramName)?c.paramName[0]:c.paramName;c.headers=d.extend({},c.headers);c.contentRange&&(c.headers["Content-Range"]=c.contentRange);g&&!c.blob&&this._isInstanceOf("File",
e)||(c.headers["Content-Disposition"]='attachment; filename="'+encodeURI(e.name)+'"');g?d.support.xhrFormDataFileUpload&&(c.postMessage?(a=this._getFormData(c),c.blob?a.push({name:f,value:c.blob}):d.each(c.files,function(b,e){a.push({name:"array"===d.type(c.paramName)&&c.paramName[b]||f,value:e})})):(b._isInstanceOf("FormData",c.formData)?a=c.formData:(a=new FormData,d.each(this._getFormData(c),function(f,b){a.append(b.name,b.value)})),c.blob?a.append(f,c.blob,e.name):d.each(c.files,function(e,g){(b._isInstanceOf("File",
g)||b._isInstanceOf("Blob",g))&&a.append("array"===d.type(c.paramName)&&c.paramName[e]||f,g,g.uploadName||g.name)})),c.data=a):(c.contentType=e.type||"application/octet-stream",c.data=c.blob||e);c.blob=null},_initIframeSettings:function(c){var b=d("<a></a>").prop("href",c.url).prop("host");c.dataType="iframe "+(c.dataType||"");c.formData=this._getFormData(c);c.redirect&&b&&b!==location.host&&c.formData.push({name:c.redirectParamName||"redirect",value:c.redirect})},_initDataSettings:function(c){this._isXHRUpload(c)?
(this._chunkedUpload(c,!0)||(c.data||this._initXHRData(c),this._initProgressListener(c)),c.postMessage&&(c.dataType="postmessage "+(c.dataType||""))):this._initIframeSettings(c)},_getParamName:function(c){var b=d(c.fileInput),a=c.paramName;a?d.isArray(a)||(a=[a]):(a=[],b.each(function(){for(var b=d(this),c=b.prop("name")||"files[]",b=(b.prop("files")||[1]).length;b;)a.push(c),--b}),a.length||(a=[b.prop("name")||"files[]"]));return a},_initFormSettings:function(c){c.form&&c.form.length||(c.form=d(c.fileInput.prop("form")),
c.form.length||(c.form=d(this.options.fileInput.prop("form"))));c.paramName=this._getParamName(c);c.url||(c.url=c.form.prop("action")||location.href);c.type=(c.type||"string"===d.type(c.form.prop("method"))&&c.form.prop("method")||"").toUpperCase();"POST"!==c.type&&"PUT"!==c.type&&"PATCH"!==c.type&&(c.type="POST");c.formAcceptCharset||(c.formAcceptCharset=c.form.attr("accept-charset"))},_getAJAXSettings:function(c){c=d.extend({},this.options,c);this._initFormSettings(c);this._initDataSettings(c);
return c},_getDeferredState:function(c){return c.state?c.state():c.isResolved()?"resolved":c.isRejected()?"rejected":"pending"},_enhancePromise:function(c){c.success=c.done;c.error=c.fail;c.complete=c.always;return c},_getXHRPromise:function(c,b,a){var e=d.Deferred(),g=e.promise();b=b||this.options.context||g;!0===c?e.resolveWith(b,a):!1===c&&e.rejectWith(b,a);g.abort=e.promise;return this._enhancePromise(g)},_addConvenienceMethods:function(c,b){var a=this,e=function(b){return d.Deferred().resolveWith(a,
b).promise()};b.process=function(c,f){if(c||f)b._processQueue=this._processQueue=(this._processQueue||e([this])).pipe(function(){return b.errorThrown?d.Deferred().rejectWith(a,[b]).promise():e(arguments)}).pipe(c,f);return this._processQueue||e([this])};b.submit=function(){"pending"!==this.state()&&(b.jqXHR=this.jqXHR=!1!==a._trigger("submit",d.Event("submit",{delegatedEvent:c}),this)&&a._onSend(c,this));return this.jqXHR||a._getXHRPromise()};b.abort=function(){if(this.jqXHR)return this.jqXHR.abort();
this.errorThrown="abort";a._trigger("fail",null,this);return a._getXHRPromise(!1)};b.state=function(){if(this.jqXHR)return a._getDeferredState(this.jqXHR);if(this._processQueue)return a._getDeferredState(this._processQueue)};b.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===a._getDeferredState(this._processQueue)};b.progress=function(){return this._progress};b.response=function(){return this._response}},_getUploadedBytes:function(c){return(c=(c=(c=c.getResponseHeader("Range"))&&
c.split("-"))&&1<c.length&&parseInt(c[1],10))&&c+1},_chunkedUpload:function(c,b){c.uploadedBytes=c.uploadedBytes||0;var a=this,e=c.files[0],g=e.size,f=c.uploadedBytes,h=c.maxChunkSize||g,k=this._blobSlice,l=d.Deferred(),p=l.promise(),m,n;if(!(this._isXHRUpload(c)&&k&&(f||h<g))||c.data)return!1;if(b)return!0;if(f>=g)return e.error=c.i18n("uploadedBytes"),this._getXHRPromise(!1,c.context,[null,"error",e.error]);n=function(){var b=d.extend({},c),p=b._progress.loaded;b.blob=k.call(e,f,f+h,e.type);b.chunkSize=
b.blob.size;b.contentRange="bytes "+f+"-"+(f+b.chunkSize-1)+"/"+g;a._initXHRData(b);a._initProgressListener(b);m=(!1!==a._trigger("chunksend",null,b)&&d.ajax(b)||a._getXHRPromise(!1,b.context)).done(function(e,h,k){f=a._getUploadedBytes(k)||f+b.chunkSize;p+b.chunkSize-b._progress.loaded&&a._onProgress(d.Event("progress",{lengthComputable:!0,loaded:f-b.uploadedBytes,total:f-b.uploadedBytes}),b);c.uploadedBytes=b.uploadedBytes=f;b.result=e;b.textStatus=h;b.jqXHR=k;a._trigger("chunkdone",null,b);a._trigger("chunkalways",
null,b);f<g?n():l.resolveWith(b.context,[e,h,k])}).fail(function(f,e,c){b.jqXHR=f;b.textStatus=e;b.errorThrown=c;a._trigger("chunkfail",null,b);a._trigger("chunkalways",null,b);l.rejectWith(b.context,[f,e,c])})};this._enhancePromise(p);p.abort=function(){return m.abort()};n();return p},_beforeSend:function(c,b){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0);this._initResponseObject(b);this._initProgressObject(b);
b._progress.loaded=b.loaded=b.uploadedBytes||0;b._progress.total=b.total=this._getTotal(b.files)||1;b._progress.bitrate=b.bitrate=0;this._active+=1;this._progress.loaded+=b.loaded;this._progress.total+=b.total},_onDone:function(c,b,a,e){var g=e._progress.total,f=e._response;e._progress.loaded<g&&this._onProgress(d.Event("progress",{lengthComputable:!0,loaded:g,total:g}),e);f.result=e.result=c;f.textStatus=e.textStatus=b;f.jqXHR=e.jqXHR=a;this._trigger("done",null,e)},_onFail:function(c,b,a,e){var g=
e._response;e.recalculateProgress&&(this._progress.loaded-=e._progress.loaded,this._progress.total-=e._progress.total);g.jqXHR=e.jqXHR=c;g.textStatus=e.textStatus=b;g.errorThrown=e.errorThrown=a;this._trigger("fail",null,e)},_onAlways:function(c,b,a,e){this._trigger("always",null,e)},_onSend:function(c,b){b.submit||this._addConvenienceMethods(c,b);var a=this,e,g,f,h,k=a._getAJAXSettings(b),l=function(){a._sending+=1;k._bitrateTimer=new a._BitrateTimer;return e=e||((g||!1===a._trigger("send",d.Event("send",
{delegatedEvent:c}),k))&&a._getXHRPromise(!1,k.context,g)||a._chunkedUpload(k)||d.ajax(k)).done(function(f,b,e){a._onDone(f,b,e,k)}).fail(function(f,b,e){a._onFail(f,b,e,k)}).always(function(f,b,e){a._onAlways(f,b,e,k);--a._sending;--a._active;if(k.limitConcurrentUploads&&k.limitConcurrentUploads>a._sending)for(f=a._slots.shift();f;){if("pending"===a._getDeferredState(f)){f.resolve();break}f=a._slots.shift()}0===a._active&&a._trigger("stop")})};this._beforeSend(c,k);return this.options.sequentialUploads||
this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(1<this.options.limitConcurrentUploads?(f=d.Deferred(),this._slots.push(f),h=f.pipe(l)):h=this._sequence=this._sequence.pipe(l,l),h.abort=function(){g=[void 0,"abort","abort"];return e?e.abort():(f&&f.rejectWith(k.context,g),l())},this._enhancePromise(h)):l()},_onAdd:function(c,b){var a=this,e=!0,g=d.extend({},this.options,b),f=b.files,h=f.length,k=g.limitMultiFileUploads,l=g.limitMultiFileUploadSize,p=g.limitMultiFileUploadSizeOverhead,
m=0,n=this._getParamName(g),u,x,y=0;!l||h&&void 0!==f[0].size||(l=void 0);if((g.singleFileUploads||k||l)&&this._isXHRUpload(g))if(g.singleFileUploads||l||!k)if(!g.singleFileUploads&&l)for(x=[],u=[],g=0;g<h;g+=1){if(m+=f[g].size+p,g+1===h||m+f[g+1].size+p>l||k&&g+1-y>=k)x.push(f.slice(y,g+1)),m=n.slice(y,g+1),m.length||(m=n),u.push(m),y=g+1,m=0}else u=n;else for(x=[],u=[],g=0;g<h;g+=k)x.push(f.slice(g,g+k)),m=n.slice(g,g+k),m.length||(m=n),u.push(m);else x=[f],u=[n];b.originalFiles=f;d.each(x||f,function(f,
h){var g=d.extend({},b);g.files=x?h:[h];g.paramName=u[f];a._initResponseObject(g);a._initProgressObject(g);a._addConvenienceMethods(c,g);return e=a._trigger("add",d.Event("add",{delegatedEvent:c}),g)});return e},_replaceFileInput:function(c){var b=c.clone(!0);d("<form></form>").append(b)[0].reset();c.after(b).detach();d.cleanData(c.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(a,e){return e===c[0]?b[0]:e});c[0]===this.element[0]&&(this.element=b)},_handleFileTreeEntry:function(c,
b){var a=this,e=d.Deferred(),g=function(f){f&&!f.entry&&(f.entry=c);e.resolve([f])},f;b=b||"";c.isFile?c._file?(c._file.relativePath=b,e.resolve(c._file)):c.file(function(f){f.relativePath=b;e.resolve(f)},g):c.isDirectory?(f=c.createReader(),f.readEntries(function(f){a._handleFileTreeEntries(f,b+c.name+"/").done(function(f){e.resolve(f)}).fail(g)},g)):e.resolve([]);return e.promise()},_handleFileTreeEntries:function(c,b){var a=this;return d.when.apply(d,d.map(c,function(e){return a._handleFileTreeEntry(e,
b)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(c){c=c||{};var b=c.items;return b&&b.length&&(b[0].webkitGetAsEntry||b[0].getAsEntry)?this._handleFileTreeEntries(d.map(b,function(a){var b;if(a.webkitGetAsEntry){if(b=a.webkitGetAsEntry())b._file=a.getAsFile();return b}return a.getAsEntry()})):d.Deferred().resolve(d.makeArray(c.files)).promise()},_getSingleFileInputFiles:function(c){c=d(c);var b=c.prop("webkitEntries")||c.prop("entries");if(b&&b.length)return this._handleFileTreeEntries(b);
b=d.makeArray(c.prop("files"));if(b.length)void 0===b[0].name&&b[0].fileName&&d.each(b,function(a,b){b.name=b.fileName;b.size=b.fileSize});else{c=c.prop("value");if(!c)return d.Deferred().resolve([]).promise();b=[{name:c.replace(/^.*\\/,"")}]}return d.Deferred().resolve(b).promise()},_getFileInputFiles:function(c){return c instanceof d&&1!==c.length?d.when.apply(d,d.map(c,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(c)},
_onChange:function(c){var b=this,a={fileInput:d(c.target),form:d(c.target.form)};this._getFileInputFiles(a.fileInput).always(function(e){a.files=e;b.options.replaceFileInput&&b._replaceFileInput(a.fileInput);!1!==b._trigger("change",d.Event("change",{delegatedEvent:c}),a)&&b._onAdd(c,a)})},_onPaste:function(c){var b=c.originalEvent&&c.originalEvent.clipboardData&&c.originalEvent.clipboardData.items,a={files:[]};b&&b.length&&(d.each(b,function(b,c){var f=c.getAsFile&&c.getAsFile();f&&a.files.push(f)}),
!1!==this._trigger("paste",d.Event("paste",{delegatedEvent:c}),a)&&this._onAdd(c,a))},_onDrop:function(c){c.dataTransfer=c.originalEvent&&c.originalEvent.dataTransfer;var b=this,a=c.dataTransfer,e={};a&&a.files&&a.files.length&&(c.preventDefault(),this._getDroppedFiles(a).always(function(a){e.files=a;!1!==b._trigger("drop",d.Event("drop",{delegatedEvent:c}),e)&&b._onAdd(c,e)}))},_onDragOver:function(c){c.dataTransfer=c.originalEvent&&c.originalEvent.dataTransfer;var b=c.dataTransfer;b&&-1!==d.inArray("Files",
b.types)&&!1!==this._trigger("dragover",d.Event("dragover",{delegatedEvent:c}))&&(c.preventDefault(),b.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste}));d.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop");this._off(this.options.pasteZone,
"paste");this._off(this.options.fileInput,"change")},_setOption:function(c,b){var a=-1!==d.inArray(c,this._specialOptions);a&&this._destroyEventHandlers();this._super(c,b);a&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var c=this.options;void 0===c.fileInput?c.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):c.fileInput instanceof d||(c.fileInput=d(c.fileInput));c.dropZone instanceof d||(c.dropZone=d(c.dropZone));
c.pasteZone instanceof d||(c.pasteZone=d(c.pasteZone))},_getRegExp:function(c){c=c.split("/");var b=c.pop();c.shift();return new RegExp(c.join("/"),b)},_isRegExpOption:function(c,b){return"url"!==c&&"string"===d.type(b)&&/^\/.*\/[igm]{0,3}$/.test(b)},_initDataAttributes:function(){var c=this,b=this.options;d.each(d(this.element[0].cloneNode(!1)).data(),function(a,e){c._isRegExpOption(a,e)&&(e=c._getRegExp(e));b[a]=e})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=
[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(c){var b=this;c&&!this.options.disabled&&(c.fileInput&&!c.files?this._getFileInputFiles(c.fileInput).always(function(a){c.files=a;b._onAdd(null,c)}):(c.files=d.makeArray(c.files),this._onAdd(null,c)))},send:function(c){if(c&&!this.options.disabled){if(c.fileInput&&!c.files){var b=
this,a=d.Deferred(),e=a.promise(),g,f;e.abort=function(){f=!0;if(g)return g.abort();a.reject(null,"abort","abort");return e};this._getFileInputFiles(c.fileInput).always(function(e){f||(e.length?(c.files=e,g=b._onSend(null,c).then(function(f,b,e){a.resolve(f,b,e)},function(f,b,e){a.reject(f,b,e)})):a.reject())});return this._enhancePromise(e)}c.files=d.makeArray(c.files);if(c.files.length)return this._onSend(null,c)}return this._getXHRPromise(!1,c&&c.context)}})});
(function(d){"function"===typeof define&&define.amd?define(["jquery","./jquery.fileupload"],d):d(window.jQuery)})(function(d){var c=d.blueimp.fileupload.prototype.options.add;d.widget("blueimp.fileupload",d.blueimp.fileupload,{options:{processQueue:[],add:function(b,a){var e=d(this);a.process(function(){return e.fileupload("process",a)});c.call(this,b,a)}},processActions:{},_processFile:function(b,a){var e=this,c=d.Deferred().resolveWith(e,[b]).promise();this._trigger("process",null,b);d.each(b.processQueue,
function(f,b){var k=function(f){return a.errorThrown?d.Deferred().rejectWith(e,[a]).promise():e.processActions[b.action].call(e,f,b)};c=c.pipe(k,b.always&&k)});c.done(function(){e._trigger("processdone",null,b);e._trigger("processalways",null,b)}).fail(function(){e._trigger("processfail",null,b);e._trigger("processalways",null,b)});return c},_transformProcessQueue:function(b){var a=[];d.each(b.processQueue,function(){var e={},c=this.action,f=!0===this.prefix?c:this.prefix;d.each(this,function(a,c){"string"===
d.type(c)&&"@"===c.charAt(0)?e[a]=b[c.slice(1)||(f?f+a.charAt(0).toUpperCase()+a.slice(1):a)]:e[a]=c});a.push(e)});b.processQueue=a},processing:function(){return this._processing},process:function(b){var a=this,e=d.extend({},this.options,b);e.processQueue&&e.processQueue.length&&(this._transformProcessQueue(e),0===this._processing&&this._trigger("processstart"),d.each(b.files,function(c){var f=c?d.extend({},e):e,h=function(){return b.errorThrown?d.Deferred().rejectWith(a,[b]).promise():a._processFile(f,
b)};f.index=c;a._processing+=1;a._processingQueue=a._processingQueue.pipe(h,h).always(function(){--a._processing;0===a._processing&&a._trigger("processstop")})}));return this._processingQueue},_create:function(){this._super();this._processing=0;this._processingQueue=d.Deferred().resolveWith(this).promise()}})});
(function(d){"function"===typeof define&&define.amd?define(["jquery","./jquery.fileupload-process"],d):d(window.jQuery)})(function(d){d.blueimp.fileupload.prototype.options.processQueue.push({action:"validate",always:!0,acceptFileTypes:"@",maxFileSize:"@",minFileSize:"@",maxNumberOfFiles:"@",disabled:"@disableValidation"});d.widget("blueimp.fileupload",d.blueimp.fileupload,{options:{getNumberOfFiles:d.noop,messages:{maxNumberOfFiles:"Maximum number of files exceeded",acceptFileTypes:"File type not allowed",
maxFileSize:"File is too large",minFileSize:"File is too small"}},processActions:{validate:function(c,b){if(b.disabled)return c;var a=d.Deferred(),e=this.options,g=c.files[c.index],f;if(b.minFileSize||b.maxFileSize)f=g.size;"number"===d.type(b.maxNumberOfFiles)&&(e.getNumberOfFiles()||0)+c.files.length>b.maxNumberOfFiles?g.error=e.i18n("maxNumberOfFiles"):!b.acceptFileTypes||b.acceptFileTypes.test(g.type)||b.acceptFileTypes.test(g.name)?f>b.maxFileSize?g.error=e.i18n("maxFileSize"):"number"===d.type(f)&&
f<b.minFileSize?g.error=e.i18n("minFileSize"):delete g.error:g.error=e.i18n("acceptFileTypes");g.error||c.files.error?(c.files.error=!0,a.rejectWith(this,[c])):a.resolveWith(this,[c]);return a.promise()}}})});
(function(d){"function"===typeof define&&define.amd?define("jquery tmpl ./jquery.fileupload-image ./jquery.fileupload-audio ./jquery.fileupload-video ./jquery.fileupload-validate".split(" "),d):d(window.jQuery,window.tmpl)})(function(d,c){d.blueimp.fileupload.prototype._specialOptions.push("filesContainer","uploadTemplateId","downloadTemplateId");d.widget("blueimp.fileupload",d.blueimp.fileupload,{options:{autoUpload:!1,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,
prependFiles:!1,dataType:"json",getNumberOfFiles:function(){return this.filesContainer.children().not(".processing").length},getFilesFromResponse:function(b){return b.result&&d.isArray(b.result.files)?b.result.files:[]},add:function(b,a){if(b.isDefaultPrevented())return!1;var e=d(this),c=e.data("blueimp-fileupload")||e.data("fileupload"),f=c.options;a.context=c._renderUpload(a.files).data("data",a).addClass("processing");f.filesContainer[f.prependFiles?"prepend":"append"](a.context);c._forceReflow(a.context);
d.when(c._transition(a.context),a.process(function(){return e.fileupload("process",a)})).always(function(){a.context.each(function(f){d(this).find(".size").text(c._formatFileSize(a.files[f].size))}).removeClass("processing");c._renderPreviews(a)}).done(function(){a.context.find(".start").prop("disabled",!1);!1!==c._trigger("added",b,a)&&(f.autoUpload||a.autoUpload)&&!1!==a.autoUpload&&a.submit()}).fail(function(){a.files.error&&a.context.each(function(f){(f=a.files[f].error)&&d(this).find(".error").text(f)})})},
send:function(b,a){if(b.isDefaultPrevented())return!1;var e=d(this).data("blueimp-fileupload")||d(this).data("fileupload");a.context&&a.dataType&&"iframe"===a.dataType.substr(0,6)&&a.context.find(".progress").addClass(!d.support.transition&&"progress-animated").attr("aria-valuenow",100).children().first().css("width","100%");return e._trigger("sent",b,a)},done:function(b,a){if(b.isDefaultPrevented())return!1;var e=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),c=(a.getFilesFromResponse||
e.options.getFilesFromResponse)(a),f,h;a.context?a.context.each(function(k){var l=c[k]||{error:"Empty file upload result"};h=e._addFinishedDeferreds();e._transition(d(this)).done(function(){var c=d(this);f=e._renderDownload([l]).replaceAll(c);e._forceReflow(f);e._transition(f).done(function(){a.context=d(this);e._trigger("completed",b,a);e._trigger("finished",b,a);h.resolve()})})}):(f=e._renderDownload(c)[e.options.prependFiles?"prependTo":"appendTo"](e.options.filesContainer),e._forceReflow(f),h=
e._addFinishedDeferreds(),e._transition(f).done(function(){a.context=d(this);e._trigger("completed",b,a);e._trigger("finished",b,a);h.resolve()}))},fail:function(b,a){if(b.isDefaultPrevented())return!1;var e=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),c,f;a.context?a.context.each(function(h){if("abort"!==a.errorThrown){var k=a.files[h];k.error=k.error||a.errorThrown||!0;f=e._addFinishedDeferreds();e._transition(d(this)).done(function(){var h=d(this);c=e._renderDownload([k]).replaceAll(h);
e._forceReflow(c);e._transition(c).done(function(){a.context=d(this);e._trigger("failed",b,a);e._trigger("finished",b,a);f.resolve()})})}else f=e._addFinishedDeferreds(),e._transition(d(this)).done(function(){d(this).remove();e._trigger("failed",b,a);e._trigger("finished",b,a);f.resolve()})}):"abort"!==a.errorThrown?(a.context=e._renderUpload(a.files)[e.options.prependFiles?"prependTo":"appendTo"](e.options.filesContainer).data("data",a),e._forceReflow(a.context),f=e._addFinishedDeferreds(),e._transition(a.context).done(function(){a.context=
d(this);e._trigger("failed",b,a);e._trigger("finished",b,a);f.resolve()})):(e._trigger("failed",b,a),e._trigger("finished",b,a),e._addFinishedDeferreds().resolve())},progress:function(b,a){if(b.isDefaultPrevented())return!1;var e=Math.floor(a.loaded/a.total*100);a.context&&a.context.each(function(){d(this).find(".progress").attr("aria-valuenow",e).children().first().css("width",e+"%")})},progressall:function(b,a){if(b.isDefaultPrevented())return!1;var e=d(this),c=Math.floor(a.loaded/a.total*100),
f=e.find(".fileupload-progress"),h=f.find(".progress-extended");h.length&&h.html((e.data("blueimp-fileupload")||e.data("fileupload"))._renderExtendedProgress(a));f.find(".progress").attr("aria-valuenow",c).children().first().css("width",c+"%")},start:function(b){if(b.isDefaultPrevented())return!1;var a=d(this).data("blueimp-fileupload")||d(this).data("fileupload");a._resetFinishedDeferreds();a._transition(d(this).find(".fileupload-progress")).done(function(){a._trigger("started",b)})},stop:function(b){if(b.isDefaultPrevented())return!1;
var a=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),e=a._addFinishedDeferreds();d.when.apply(d,a._getFinishedDeferreds()).done(function(){a._trigger("stopped",b)});a._transition(d(this).find(".fileupload-progress")).done(function(){d(this).find(".progress").attr("aria-valuenow","0").children().first().css("width","0%");d(this).find(".progress-extended").html("&nbsp;");e.resolve()})},processstart:function(b){if(b.isDefaultPrevented())return!1;d(this).addClass("fileupload-processing")},
processstop:function(b){if(b.isDefaultPrevented())return!1;d(this).removeClass("fileupload-processing")},destroy:function(b,a){if(b.isDefaultPrevented())return!1;var e=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),c=function(){e._transition(a.context).done(function(){d(this).remove();e._trigger("destroyed",b,a)})};a.url?(a.dataType=a.dataType||e.options.dataType,d.ajax(a).done(c)):c()}},_resetFinishedDeferreds:function(){this._finishedUploads=[]},_addFinishedDeferreds:function(b){b||
(b=d.Deferred());this._finishedUploads.push(b);return b},_getFinishedDeferreds:function(){return this._finishedUploads},_enableDragToDesktop:function(){var b=d(this),a=b.prop("href"),e=b.prop("download");b.bind("dragstart",function(b){try{b.originalEvent.dataTransfer.setData("DownloadURL",["application/octet-stream",e,a].join(":"))}catch(f){}})},_formatFileSize:function(b){return"number"!==typeof b?"":1E9<=b?(b/1E9).toFixed(2)+" GB":1E6<=b?(b/1E6).toFixed(2)+" MB":(b/1E3).toFixed(2)+" KB"},_formatBitrate:function(b){return"number"!==
typeof b?"":1E9<=b?(b/1E9).toFixed(2)+" Gbit/s":1E6<=b?(b/1E6).toFixed(2)+" Mbit/s":1E3<=b?(b/1E3).toFixed(2)+" kbit/s":b.toFixed(2)+" bit/s"},_formatTime:function(b){var a=new Date(1E3*b);b=Math.floor(b/86400);return(b?b+"d ":"")+("0"+a.getUTCHours()).slice(-2)+":"+("0"+a.getUTCMinutes()).slice(-2)+":"+("0"+a.getUTCSeconds()).slice(-2)},_formatPercentage:function(b){return(100*b).toFixed(2)+" %"},_renderExtendedProgress:function(b){return this._formatBitrate(b.bitrate)+" | "+this._formatTime(8*(b.total-
b.loaded)/b.bitrate)+" | "+this._formatPercentage(b.loaded/b.total)+" | "+this._formatFileSize(b.loaded)+" / "+this._formatFileSize(b.total)},_renderTemplate:function(b,a){if(!b)return d();var e=b({files:a,formatFileSize:this._formatFileSize,options:this.options});return e instanceof d?e:d(this.options.templatesContainer).html(e).children()},_renderPreviews:function(b){b.context.find(".preview").each(function(a,e){d(e).append(b.files[a].preview)})},_renderUpload:function(b){return this._renderTemplate(this.options.uploadTemplate,
b)},_renderDownload:function(b){return this._renderTemplate(this.options.downloadTemplate,b).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(b){b.preventDefault();b=d(b.currentTarget);var a=b.closest(".template-upload").data("data");b.prop("disabled",!0);a&&a.submit&&a.submit()},_cancelHandler:function(b){b.preventDefault();var a=d(b.currentTarget).closest(".template-upload,.template-download"),e=a.data("data")||{};e.context=e.context||a;e.abort?e.abort():(e.errorThrown=
"abort",this._trigger("fail",b,e))},_deleteHandler:function(b){b.preventDefault();var a=d(b.currentTarget);this._trigger("destroy",b,d.extend({context:a.closest(".template-download"),type:"DELETE"},a.data()))},_forceReflow:function(b){return d.support.transition&&b.length&&b[0].offsetWidth},_transition:function(b){var a=d.Deferred();d.support.transition&&b.hasClass("fade")&&b.is(":visible")?b.bind(d.support.transition.end,function(e){e.target===b[0]&&(b.unbind(d.support.transition.end),a.resolveWith(b))}).toggleClass("in"):
(b.toggleClass("in"),a.resolveWith(b));return a},_initButtonBarEventHandlers:function(){var b=this.element.find(".fileupload-buttonbar"),a=this.options.filesContainer;this._on(b.find(".start"),{click:function(b){b.preventDefault();a.find(".start").click()}});this._on(b.find(".cancel"),{click:function(b){b.preventDefault();a.find(".cancel").click()}});this._on(b.find(".delete"),{click:function(e){e.preventDefault();a.find(".toggle:checked").closest(".template-download").find(".delete").click();b.find(".toggle").prop("checked",
!1)}});this._on(b.find(".toggle"),{change:function(b){a.find(".toggle").prop("checked",d(b.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(this.element.find(".fileupload-buttonbar").find(".start, .cancel, .delete"),"click");this._off(this.element.find(".fileupload-buttonbar .toggle"),"change.")},_initEventHandlers:function(){this._super();this._on(this.options.filesContainer,{"click .start":this._startHandler,"click .cancel":this._cancelHandler,"click .delete":this._deleteHandler});
this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers();this._off(this.options.filesContainer,"click");this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var b=this.options;b.templatesContainer=this.document[0].createElement(b.filesContainer.prop("nodeName"));
c&&(b.uploadTemplateId&&(b.uploadTemplate=c(b.uploadTemplateId)),b.downloadTemplateId&&(b.downloadTemplate=c(b.downloadTemplateId)))},_initFilesContainer:function(){var b=this.options;void 0===b.filesContainer?b.filesContainer=this.element.find(".files"):b.filesContainer instanceof d||(b.filesContainer=d(b.filesContainer))},_initSpecialOptions:function(){this._super();this._initFilesContainer();this._initTemplates()},_create:function(){this._super();this._resetFinishedDeferreds();d.support.fileInput||
this._disableFileInputButton()},enable:function(){var b=!1;this.options.disabled&&(b=!0);this._super();b&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton());this._super()}})});
var Canvas2Image=function(){var d=!1,c=document.createElement("canvas");c.getContext("2d")&&(d=!0);if(!d)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var b=!!c.getContext("2d").getImageData,a=!!c.toDataURL,e=!!window.btoa,g=function(f){var a="";if("string"==typeof f)a=f;else for(var b=0;b<f.length;b++)a+=String.fromCharCode(f[b]);return btoa(a)},f=function(f){console.log(f);document.location.href=f},h=function(f){var a=document.createElement("img");a.src=f;return a},
k=function(f,a,b){if(a&&b){var e=document.createElement("canvas");e.width=a;e.height=b;e.style.width=a+"px";e.style.height=b+"px";e.getContext("2d").drawImage(f,0,0,f.width,f.height,0,0,a,b);return e}return f};return{saveAsPNG:function(b,e,c,g){if(!a)return!1;b=k(b,c,g).toDataURL("image/png");if(e)return h(b);f(b.replace("image/png","image/octet-stream"));return!0},saveAsJPEG:function(b,e,c,g){if(!a)return!1;b=k(b,c,g).toDataURL("image/jpeg");if(5!=b.indexOf("image/jpeg"))return!1;if(e)return h(b);
f(b.replace("image/jpeg","image/octet-stream"));return!0},saveAsBMP:function(a,c,d,n){if(!b||!e)return!1;a=k(a,d,n);d=parseInt(a.width);n=parseInt(a.height);var u=a.getContext("2d").getImageData(0,0,d,n);a=[];d=u.width;var x=u.height;a.push(66);a.push(77);n=d*x*3+54;a.push(n%256);n=Math.floor(n/256);a.push(n%256);n=Math.floor(n/256);a.push(n%256);n=Math.floor(n/256);a.push(n%256);a.push(0);a.push(0);a.push(0);a.push(0);a.push(54);a.push(0);a.push(0);a.push(0);n=[];n.push(40);n.push(0);n.push(0);n.push(0);
var y=d;n.push(y%256);y=Math.floor(y/256);n.push(y%256);y=Math.floor(y/256);n.push(y%256);y=Math.floor(y/256);n.push(y%256);y=x;n.push(y%256);y=Math.floor(y/256);n.push(y%256);y=Math.floor(y/256);n.push(y%256);y=Math.floor(y/256);n.push(y%256);n.push(1);n.push(0);n.push(24);n.push(0);n.push(0);n.push(0);n.push(0);n.push(0);y=d*x*3;n.push(y%256);y=Math.floor(y/256);n.push(y%256);y=Math.floor(y/256);n.push(y%256);y=Math.floor(y/256);n.push(y%256);for(y=0;16>y;y++)n.push(0);var y=(4-3*d%4)%4,u=u.data,
z="";do{for(var t=d*(x-1)*4,r="",v=0;v<d;v++)var q=4*v,r=r+String.fromCharCode(u[t+q+2]),r=r+String.fromCharCode(u[t+q+1]),r=r+String.fromCharCode(u[t+q]);for(t=0;t<y;t++)r+=String.fromCharCode(0);z+=r}while(--x);a=g(a.concat(n))+g(z);if(c)return h("data:image/bmp;base64,"+a);f("data:image/octet-stream;base64,"+a);return!0}}}(),fabric=fabric||{version:"1.6.0-rc.1"};"undefined"!=typeof exports&&(exports.fabric=fabric);
"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.document.createWindow?fabric.window=fabric.document.createWindow():fabric.window=fabric.document.parentWindow);fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window;
fabric.SHARED_ATTRIBUTES="display transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width id".split(" ");fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;
(function(){function d(a,b){this.__eventListeners[a]&&(b?fabric.util.removeFromArray(this.__eventListeners[a],b):this.__eventListeners[a].length=0)}function c(a,b){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var f in a)this.on(f,a[f]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function b(a,b){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"==
typeof arguments[0])for(var f in a)d.call(this,f,a[f]);else d.call(this,a,b);return this}}function a(a,b){if(this.__eventListeners){var f=this.__eventListeners[a];if(f){for(var c=0,d=f.length;d>c;c++)f[c].call(this,b||{});return this}}}fabric.Observable={observe:c,stopObserving:b,fire:a,on:c,off:b,trigger:a}})();
fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var d=0,c=arguments.length;c>d;d++)this._onObjectAdded(arguments[d]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(d,c,b){var a=this.getObjects();return b?a[c]=d:a.splice(c,0,d),this._onObjectAdded(d),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var d,c=this.getObjects(),b=0,a=arguments.length;a>b;b++)d=c.indexOf(arguments[b]),-1!==d&&(c.splice(d,1),this._onObjectRemoved(arguments[b]));
return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(d,c){for(var b=this.getObjects(),a=b.length;a--;)d.call(c,b[a],a,b);return this},getObjects:function(d){return"undefined"==typeof d?this._objects:this._objects.filter(function(c){return c.type===d})},item:function(d){return this.getObjects()[d]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(d){return-1<this.getObjects().indexOf(d)},complexity:function(){return this.getObjects().reduce(function(d,
c){return d+(c.complexity?c.complexity():0)},0)}};
(function(d){var c=Math.sqrt,b=Math.atan2,a=(Math.atan,Math.pow),e=Math.abs,g=Math.PI/180;fabric.util={removeFromArray:function(f,a){var b=f.indexOf(a);return-1!==b&&f.splice(b,1),f},getRandomInt:function(f,a){return Math.floor(Math.random()*(a-f+1))+f},degreesToRadians:function(f){return f*g},radiansToDegrees:function(f){return f/g},rotatePoint:function(f,a,b){f.subtractEquals(a);f=fabric.util.rotateVector(f,b);return(new fabric.Point(f.x,f.y)).addEquals(a)},rotateVector:function(f,a){var b=Math.sin(a),
e=Math.cos(a);return{x:f.x*e-f.y*b,y:f.x*b+f.y*e}},transformPoint:function(f,a,b){return b?new fabric.Point(a[0]*f.x+a[2]*f.y,a[1]*f.x+a[3]*f.y):new fabric.Point(a[0]*f.x+a[2]*f.y+a[4],a[1]*f.x+a[3]*f.y+a[5])},makeBoundingBoxFromPoints:function(f){var a=[f[0].x,f[1].x,f[2].x,f[3].x],b=fabric.util.array.min(a),a=fabric.util.array.max(a),a=Math.abs(b-a),e=[f[0].y,f[1].y,f[2].y,f[3].y];f=fabric.util.array.min(e);e=fabric.util.array.max(e);return{left:b,top:f,width:a,height:Math.abs(f-e)}},invertTransform:function(f){var a=
1/(f[0]*f[3]-f[1]*f[2]),a=[a*f[3],-a*f[1],-a*f[2],a*f[0]];f=fabric.util.transformPoint({x:f[4],y:f[5]},a,!0);return a[4]=-f.x,a[5]=-f.y,a},toFixed:function(f,a){return parseFloat(Number(f).toFixed(a))},parseUnit:function(f,a){var b=/\D{0,2}$/.exec(f),e=parseFloat(f);switch(a||(a=fabric.Text.DEFAULT_SVG_FONT_SIZE),b[0]){case "mm":return e*fabric.DPI/25.4;case "cm":return e*fabric.DPI/2.54;case "in":return e*fabric.DPI;case "pt":return e*fabric.DPI/72;case "pc":return e*fabric.DPI/72*12;case "em":return e*
a;default:return e}},falseFunction:function(){return!1},getKlass:function(f,a){return f=fabric.util.string.camelize(f.charAt(0).toUpperCase()+f.slice(1)),fabric.util.resolveNamespace(a)[f]},resolveNamespace:function(f){if(!f)return fabric;f=f.split(".");for(var a=f.length,b=d||fabric.window,e=0;a>e;++e)b=b[f[e]];return b},loadImage:function(f,a,b,e){if(!f)return void(a&&a.call(b,f));var c=fabric.util.createImage();c.onload=function(){a&&a.call(b,c);c=c.onload=c.onerror=null};c.onerror=function(){fabric.log("Error loading "+
c.src);a&&a.call(b,null,!0);c=c.onload=c.onerror=null};0!==f.indexOf("data")&&e&&(c.crossOrigin=e);c.src=f},enlivenObjects:function(f,a,b,e){function c(){++d===u&&a&&a(g)}f=f||[];var g=[],d=0,u=f.length;return u?void f.forEach(function(a,f){if(!a||!a.type)return void c();var h=fabric.util.getKlass(a.type,b);h.async?h.fromObject(a,function(b,h){h||(g[f]=b,e&&e(a,g[f]));c()}):(g[f]=h.fromObject(a),e&&e(a,g[f]),c())}):void(a&&a(g))},groupSVGElements:function(a,b,e){var c;return c=new fabric.PathGroup(a,
b),"undefined"!=typeof e&&c.setSourcePath(e),c},populateWithProperties:function(a,b,e){if(e&&"[object Array]"===Object.prototype.toString.call(e))for(var c=0,g=e.length;g>c;c++)e[c]in a&&(b[e[c]]=a[e[c]])},drawDashedLine:function(a,e,g,d,p,m){d-=e;var n=p-g;p=c(d*d+n*n);d=b(n,d);var n=m.length,u=0,x=!0;a.save();a.translate(e,g);a.moveTo(0,0);a.rotate(d);for(e=0;p>e;)e+=m[u++%n],e>p&&(e=p),a[x?"lineTo":"moveTo"](e,0),x=!x;a.restore()},createCanvasElement:function(a){return a||(a=fabric.document.createElement("canvas")),
a.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a),a},createImage:function(){return fabric.isLikelyNode?new (require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(a){a=a.prototype;for(var b=a.stateProperties.length;b--;){var e=a.stateProperties[b],c=e.charAt(0).toUpperCase()+e.slice(1),g="set"+c,c="get"+c;a[c]||(a[c]=new Function('return this.get("'+e+'")'));a[g]||(a[g]=new Function("value",'return this.set("'+e+'", value)'))}},
clipContext:function(a,b){b.save();b.beginPath();a.clipTo(b);b.clip()},multiplyTransformMatrices:function(a,b,e){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],e?0:a[0]*b[4]+a[2]*b[5]+a[4],e?0:a[1]*b[4]+a[3]*b[5]+a[5]]},qrDecompose:function(f){var e=b(f[1],f[0]),d=a(f[0],2)+a(f[1],2),l=c(d),p=(f[0]*f[3]-f[2]*f[1])/l,d=b(f[0]*f[2]+f[1]*f[3],d);return{angle:e/g,scaleX:l,scaleY:p,skewX:d/g,skewY:0,translateX:f[4],translateY:f[5]}},customTransformMatrix:function(a,
b,c){c=[1,0,e(Math.tan(c*g)),1];a=[e(a),0,0,e(b)];return fabric.util.multiplyTransformMatrices(a,c,!0)},resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.skewX=0;a.skewY=0;a.flipX=!1;a.flipY=!1;a.setAngle(0)},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,b,e,c){0<c&&(b>c?b-=c:b=0,e>c?e-=c:e=0);var g=!0;a=a.getImageData(b,e,2*c||1,2*c||1);b=3;for(e=a.data.length;e>b&&(g=0>=a.data[b],!1!==g);b+=4);return g},parsePreserveAspectRatioAttribute:function(a){var b,
e="meet",c="Mid",g="Mid";a=a.split(" ");return a&&a.length&&(e=a.pop(),"meet"!==e&&"slice"!==e?(b=e,e="meet"):a.length&&(b=a.pop())),c="none"!==b?b.slice(1,4):"none",g="none"!==b?b.slice(5,8):"none",{meetOrSlice:e,alignX:c,alignY:g}}}})("undefined"!=typeof exports?exports:this);
(function(){function d(a,f,g,d,n,u,x){var y=h.call(arguments);if(e[y])return e[y];var z=Math.PI,t=x*z/180,r=Math.sin(t),t=Math.cos(t),v=0,q=0;g=Math.abs(g);d=Math.abs(d);var w=-t*a*.5-r*f*.5,A=-t*f*.5+r*a*.5,B=g*g,C=d*d,D=A*A,E=w*w,F=B*C-B*D-C*E,G=0;0>F?(B=Math.sqrt(1-F/(B*C)),g*=B,d*=B):G=(n===u?-1:1)*Math.sqrt(F/(B*D+C*E));D=G*g*A/d;E=-G*d*w/g;G=t*D-r*E+.5*a;B=r*D+t*E+.5*f;C=b(1,0,(w-D)/g,(A-E)/d);A=b((w-D)/g,(A-E)/d,(-w-D)/g,(-A-E)/d);0===u&&0<A?A-=2*z:1===u&&0>A&&(A+=2*z);z=Math.ceil(Math.abs(A/
z*2));w=[];A/=z;D=8/3*Math.sin(A/4)*Math.sin(A/4)/Math.sin(A/2);E=C+A;for(F=0;z>F;F++)w[F]=c(C,E,t,r,g,d,G,B,D,v,q),v=w[F][4],q=w[F][5],C=E,E+=A;return e[y]=w,w}function c(a,f,b,e,c,d,x,y,z,t,r){var v=h.call(arguments);if(g[v])return g[v];var q=Math.cos(a),w=Math.sin(a),A=Math.cos(f),B=Math.sin(f),C=b*c*A-e*d*B+x,D=e*c*A+b*d*B+y;return g[v]=[t+z*(-b*c*w-e*d*q),r+z*(-e*c*w+b*d*q),C+z*(b*c*B+e*d*A),D+z*(e*c*B-b*d*A),C,D],g[v]}function b(a,b,f,e){a=Math.atan2(b,a);f=Math.atan2(e,f);return f>=a?f-a:2*
Math.PI-(a-f)}function a(a,b,e,c,g,d,x,y){var z=h.call(arguments);if(f[z])return f[z];var t,r,v,q,w,A,B,C=Math.sqrt,D=Math.min,E=Math.max,F=Math.abs,G=[],H=[[],[]];r=6*a-12*e+6*g;t=-3*a+9*e-9*g+3*x;v=3*e-3*a;for(var K=0;2>K;++K)(0<K&&(r=6*b-12*c+6*d,t=-3*b+9*c-9*d+3*y,v=3*c-3*b),1E-12>F(t))?1E-12>F(r)||(q=-v/r,0<q&&1>q&&G.push(q)):(q=r*r-4*v*t,0>q||(B=C(q),w=(-r+B)/(2*t),0<w&&1>w&&G.push(w),A=(-r-B)/(2*t),0<A&&1>A&&G.push(A)));for(r=t=G.length;t--;)q=G[t],w=1-q,v=w*w*w*a+3*w*w*q*e+3*w*q*q*g+q*q*q*
x,H[0][t]=v,q=w*w*w*b+3*w*w*q*c+3*w*q*q*d+q*q*q*y,H[1][t]=q;H[0][r]=a;H[1][r]=b;H[0][r+1]=x;H[1][r+1]=y;D=[{x:D.apply(null,H[0]),y:D.apply(null,H[1])},{x:E.apply(null,H[0]),y:E.apply(null,H[1])}];return f[z]=D,D}var e={},g={},f={},h=Array.prototype.join;fabric.util.drawArc=function(a,b,f,e){var c=[[],[],[],[]];e=d(e[5]-b,e[6]-f,e[0],e[1],e[3],e[4],e[2]);for(var g=0,h=e.length;h>g;g++)c[g][0]=e[g][0]+b,c[g][1]=e[g][1]+f,c[g][2]=e[g][2]+b,c[g][3]=e[g][3]+f,c[g][4]=e[g][4]+b,c[g][5]=e[g][5]+f,a.bezierCurveTo.apply(a,
c[g])};fabric.util.getBoundsOfArc=function(b,f,e,c,g,h,x,y,z){var t=0,r=0,v=[],q=[];e=d(y-b,z-f,e,c,h,x,g);c=[[],[]];g=0;for(h=e.length;h>g;g++)v=a(t,r,e[g][0],e[g][1],e[g][2],e[g][3],e[g][4],e[g][5]),c[0].x=v[0].x+b,c[0].y=v[0].y+f,c[1].x=v[1].x+b,c[1].y=v[1].y+f,q.push(c[0]),q.push(c[1]),t=e[g][4],r=e[g][5];return q};fabric.util.getBoundsOfCurve=a})();
(function(){function d(b,a,e){if(b&&0!==b.length){var c=b.length-1,f=a?b[c][a]:b[c];if(a)for(;c--;)e(b[c][a],f)&&(f=b[c][a]);else for(;c--;)e(b[c],f)&&(f=b[c]);return f}}var c=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(b){if(void 0===this||null===this)throw new TypeError;var a=Object(this),e=a.length>>>0;if(0===e)return-1;var c=0;if(0<arguments.length&&(c=Number(arguments[1]),c!==c?c=0:0!==c&&c!==Number.POSITIVE_INFINITY&&c!==Number.NEGATIVE_INFINITY&&(c=(0<c||
-1)*Math.floor(Math.abs(c)))),c>=e)return-1;for(c=0<=c?c:Math.max(e-Math.abs(c),0);e>c;c++)if(c in a&&a[c]===b)return c;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(b,a){for(var e=0,c=this.length>>>0;c>e;e++)e in this&&b.call(a,this[e],e,this)});Array.prototype.map||(Array.prototype.map=function(b,a){for(var e=[],c=0,f=this.length>>>0;f>c;c++)c in this&&(e[c]=b.call(a,this[c],c,this));return e});Array.prototype.every||(Array.prototype.every=function(b,a){for(var e=0,c=this.length>>>
0;c>e;e++)if(e in this&&!b.call(a,this[e],e,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(b,a){for(var e=0,c=this.length>>>0;c>e;e++)if(e in this&&b.call(a,this[e],e,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(b,a){for(var e,c=[],f=0,h=this.length>>>0;h>f;f++)f in this&&(e=this[f],b.call(a,e,f,this)&&c.push(e));return c});Array.prototype.reduce||(Array.prototype.reduce=function(b){var a,e=this.length>>>0,c=0;if(1<arguments.length)a=
arguments[1];else for(;;){if(c in this){a=this[c++];break}if(++c>=e)throw new TypeError;}for(;e>c;c++)c in this&&(a=b.call(null,a,this[c],c,this));return a});fabric.util.array={invoke:function(b,a){for(var e=c.call(arguments,2),g=[],f=0,h=b.length;h>f;f++)g[f]=e.length?b[f][a].apply(b[f],e):b[f][a].call(b[f]);return g},min:function(b,a){return d(b,a,function(a,b){return b>a})},max:function(b,a){return d(b,a,function(a,b){return a>=b})}}})();
(function(){function d(c,b){for(var a in b)c[a]=b[a];return c}fabric.util.object={extend:d,clone:function(c){return d({},c)}}})();
(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:function(d){return d.replace(/-+(.)?/g,function(c,b){return b?b.toUpperCase():""})},capitalize:function(d,c){return d.charAt(0).toUpperCase()+(c?d.slice(1):d.slice(1).toLowerCase())},escapeXml:function(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();
(function(){var d=Array.prototype.slice,c=Function.prototype.apply,b=function(){};Function.prototype.bind||(Function.prototype.bind=function(a){var e,g=this,f=d.call(arguments,1);return e=f.length?function(){return c.call(g,this instanceof b?this:a,f.concat(d.call(arguments)))}:function(){return c.call(g,this instanceof b?this:a,arguments)},b.prototype=this.prototype,e.prototype=new b,e})})();
(function(){function d(){}function c(a){var e=this.constructor.superclass.prototype[a];return 1<arguments.length?e.apply(this,b.call(arguments,1)):e.call(this)}var b=Array.prototype.slice,a=function(){},e=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),g=function(a,b,c){for(var g in b)g in a.prototype&&"function"==typeof a.prototype[g]&&-1<(b[g]+"").indexOf("callSuper")?a.prototype[g]=function(a){return function(){var f=this.constructor.superclass;this.constructor.superclass=
c;var e=b[a].apply(this,arguments);return this.constructor.superclass=f,"initialize"!==a?e:void 0}}(g):a.prototype[g]=b[g],e&&(b.toString!==Object.prototype.toString&&(a.prototype.toString=b.toString),b.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=b.valueOf))};fabric.util.createClass=function(){function f(){this.initialize.apply(this,arguments)}var e=null,k=b.call(arguments,0);"function"==typeof k[0]&&(e=k.shift());f.superclass=e;f.subclasses=[];e&&(d.prototype=e.prototype,f.prototype=
new d,e.subclasses.push(f));for(var l=0,p=k.length;p>l;l++)g(f,k[l],e);return f.prototype.initialize||(f.prototype.initialize=a),f.prototype.constructor=f,f.prototype.callSuper=c,f}})();
(function(){function d(a){var b,f,e=Array.prototype.slice.call(arguments,1),c=e.length;for(f=0;c>f;f++)if(b=typeof a[e[f]],!/^(?:function|object|unknown)$/.test(b))return!1;return!0}function c(a,b){return function(f){b.call(e(a),f||fabric.window.event)}}function b(a,b){return function(f){if(n[a]&&n[a][b])for(var e=n[a][b],c=0,g=e.length;g>c;c++)e[c].call(this,f||fabric.window.event)}}function a(a,b,f){var e="touchend"===a.type?"changedTouches":"touches";return a[e]&&a[e][0]?a[e][0][b]-(a[e][0][b]-
a[e][0][f])||a[f]:a[f]}var e,g,f=function(){var a=0;return function(b){return b.__uniqueID||(b.__uniqueID="uniqueID__"+a++)}}();!function(){var a={};e=function(b){return a[b]};g=function(b,f){a[b]=f}}();var h,k,l=d(fabric.document.documentElement,"addEventListener","removeEventListener")&&d(fabric.window,"addEventListener","removeEventListener"),p=d(fabric.document.documentElement,"attachEvent","detachEvent")&&d(fabric.window,"attachEvent","detachEvent"),m={},n={};l?(h=function(a,b,f){a.addEventListener(b,
f,!1)},k=function(a,b,f){a.removeEventListener(b,f,!1)}):p?(h=function(a,b,e){var h=f(a);g(h,a);m[h]||(m[h]={});m[h][b]||(m[h][b]=[]);e={handler:e,wrappedHandler:c(h,e)};m[h][b].push(e);a.attachEvent("on"+b,e.wrappedHandler)},k=function(a,b,e){var c,g=f(a);if(m[g]&&m[g][b])for(var h=0,d=m[g][b].length;d>h;h++)(c=m[g][b][h])&&c.handler===e&&(a.detachEvent("on"+b,c.wrappedHandler),m[g][b][h]=null)}):(h=function(a,e,c){var g=f(a);if(n[g]||(n[g]={}),!n[g][e]){n[g][e]=[];var h=a["on"+e];h&&n[g][e].push(h);
a["on"+e]=b(g,e)}n[g][e].push(c)},k=function(a,b,e){a=f(a);if(n[a]&&n[a][b]){b=n[a][b];a=0;for(var c=b.length;c>a;a++)b[a]===e&&b.splice(a,1)}});fabric.util.addListener=h;fabric.util.removeListener=k;var u=function(a){return"unknown"!==typeof a.clientX?a.clientX:0},x=function(a){return"unknown"!==typeof a.clientY?a.clientY:0};fabric.isTouchSupported&&(u=function(b){return a(b,"pageX","clientX")},x=function(b){return a(b,"pageY","clientY")});fabric.util.getPointer=function(a){a||(a=fabric.window.event);
var b=fabric.util.getScrollLeftTop(a.target||("unknown"!==typeof a.srcElement?a.srcElement:null));return{x:u(a)+b.left,y:x(a)+b.top}};fabric.util.object.extend(fabric.util,fabric.Observable)})();
(function(){var d=fabric.document.createElement("div"),c="string"==typeof d.style.filter,b=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,a=function(a){return a};"string"==typeof d.style.opacity?a=function(a,b){return a.style.opacity=b,a}:c&&(a=function(a,c){var f=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(f.zoom=1),b.test(f.filter)?(c=.9999<=c?"":"alpha(opacity="+100*c+")",f.filter=f.filter.replace(b,c)):f.filter+=" alpha(opacity="+100*c+")",a});fabric.util.setStyle=function(b,c){var f=
b.style;if(!f)return b;if("string"==typeof c)return b.style.cssText+=";"+c,-1<c.indexOf("opacity")?a(b,c.match(/opacity:\s*(\d?\.?\d*)/)[1]):b;for(var h in c)"opacity"===h?a(b,c[h]):f["float"===h||"cssFloat"===h?"undefined"==typeof f.styleFloat?"cssFloat":"styleFloat":h]=c[h];return b}})();
(function(){function d(a,b){var e=fabric.document.createElement(a),c;for(c in b)"class"===c?e.className=b[c]:"for"===c?e.htmlFor=b[c]:e.setAttribute(c,b[c]);return e}function c(a){for(var b=0,e=0,c=fabric.document.documentElement,g=fabric.document.body||{scrollLeft:0,scrollTop:0};a&&(a.parentNode||a.host)&&(a=a.parentNode||a.host,a===fabric.document?(b=g.scrollLeft||c.scrollLeft||0,e=g.scrollTop||c.scrollTop||0):(b+=a.scrollLeft||0,e+=a.scrollTop||0),1!==a.nodeType||"fixed"!==fabric.util.getElementStyle(a,
"position")););return{left:b,top:e}}var b,a=Array.prototype.slice,e=function(b){return a.call(b,0)};try{b=e(fabric.document.childNodes)instanceof Array}catch(f){}b||(e=function(a){for(var b=Array(a.length),e=a.length;e--;)b[e]=a[e];return b});var g;g=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(a,b){var e=fabric.document.defaultView.getComputedStyle(a,null);return e?e[b]:void 0}:function(a,b){var e=a.style[b];return!e&&a.currentStyle&&(e=a.currentStyle[b]),e};
(function(){var a=fabric.document.documentElement.style,b="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(a){return"undefined"!=typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction),b?a.style[b]="none":"string"==typeof a.unselectable&&(a.unselectable="on"),a};fabric.util.makeElementSelectable=function(a){return"undefined"!=typeof a.onselectstart&&
(a.onselectstart=null),b?a.style[b]="":"string"==typeof a.unselectable&&(a.unselectable=""),a}})();(function(){fabric.util.getScript=function(a,b){var e=fabric.document.getElementsByTagName("head")[0],c=fabric.document.createElement("script"),g=!0;c.onload=c.onreadystatechange=function(a){!g||"string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(g=!1,b(a||fabric.window.event),c=c.onload=c.onreadystatechange=null)};c.src=a;e.appendChild(c)}})();fabric.util.getById=
function(a){return"string"==typeof a?fabric.document.getElementById(a):a};fabric.util.toArray=e;fabric.util.makeElement=d;fabric.util.addClass=function(a,b){a&&-1===(" "+a.className+" ").indexOf(" "+b+" ")&&(a.className+=(a.className?" ":"")+b)};fabric.util.wrapElement=function(a,b,e){return"string"==typeof b&&(b=d(b,e)),a.parentNode&&a.parentNode.replaceChild(b,a),b.appendChild(a),b};fabric.util.getScrollLeftTop=c;fabric.util.getElementOffset=function(a){var b,e,d=a&&a.ownerDocument,p={left:0,top:0},
m={left:0,top:0},n={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!d)return m;for(var u in n)m[n[u]]+=parseInt(g(a,u),10)||0;return b=d.documentElement,"undefined"!=typeof a.getBoundingClientRect&&(p=a.getBoundingClientRect()),e=c(a),{left:p.left+e.left-(b.clientLeft||0)+m.left,top:p.top+e.top-(b.clientTop||0)+m.top}};fabric.util.getElementStyle=g})();
(function(){function d(a,b){return a+(/\?/.test(a)?"&":"?")+b}function c(){}var b=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],b=a.length;b--;)try{if(a[b]())return a[b]}catch(c){}}();fabric.util.request=function(a,e){e||(e={});var g,f=e.method?e.method.toUpperCase():"GET",h=e.onComplete||function(){},k=b();return k.onreadystatechange=
function(){4===k.readyState&&(h(k),k.onreadystatechange=c)},"GET"===f&&(g=null,"string"==typeof e.parameters&&(a=d(a,e.parameters))),k.open(f,a,!0),("POST"===f||"PUT"===f)&&k.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),k.send(g),k}})();fabric.log=function(){};fabric.warn=function(){};"undefined"!=typeof console&&["log","warn"].forEach(function(d){"undefined"!=typeof console[d]&&"function"==typeof console[d].apply&&(fabric[d]=function(){return console[d].apply(console,arguments)})});
(function(){function d(){return c.apply(fabric.window,arguments)}var c=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(b){fabric.window.setTimeout(b,1E3/60)};fabric.util.animate=function(b){d(function(a){b||(b={});var e,c=a||+new Date,f=b.duration||500,h=c+f,k=b.onChange||function(){},l=b.abort||function(){return!1},p=b.easing||function(a,b,
f,e){return-f*Math.cos(a/e*(Math.PI/2))+f+b},m="startValue"in b?b.startValue:0;a="endValue"in b?b.endValue:100;var n=b.byValue||a-m;b.onStart&&b.onStart();(function x(a){e=a||+new Date;a=e>h?f:e-c;return l()?void(b.onComplete&&b.onComplete()):(k(p(a,m,n,f)),e>h?void(b.onComplete&&b.onComplete()):void d(x))})(c)})};fabric.util.requestAnimFrame=d})();
(function(){function d(a,b,f,c){return a<Math.abs(b)?(a=b,c=f/4):c=f/(2*Math.PI)*Math.asin(b/a),{a:a,c:b,p:f,s:c}}function c(a,b,f){return a.a*Math.pow(2,10*--b)*Math.sin(2*(b*f-a.s)*Math.PI/a.p)}function b(b,c,f,h){return f-a(h-b,0,f,h)+c}function a(a,b,f,c){return(a/=c)<1/2.75?7.5625*f*a*a+b:2/2.75>a?f*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?f*(7.5625*(a-=2.25/2.75)*a+.9375)+b:f*(7.5625*(a-=2.625/2.75)*a+.984375)+b}fabric.util.ease={easeInQuad:function(a,b,f,c){return f*(a/=c)*a+b},easeOutQuad:function(a,
b,f,c){return-f*(a/=c)*(a-2)+b},easeInOutQuad:function(a,b,f,c){return a/=c/2,1>a?f/2*a*a+b:-f/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,f,c){return f*(a/=c)*a*a+b},easeOutCubic:function(a,b,f,c){return f*((a=a/c-1)*a*a+1)+b},easeInOutCubic:function(a,b,f,c){return a/=c/2,1>a?f/2*a*a*a+b:f/2*((a-=2)*a*a+2)+b},easeInQuart:function(a,b,f,c){return f*(a/=c)*a*a*a+b},easeOutQuart:function(a,b,c,h){return-c*((a=a/h-1)*a*a*a-1)+b},easeInOutQuart:function(a,b,c,h){return a/=h/2,1>a?c/2*a*a*a*a+b:-c/2*
((a-=2)*a*a*a-2)+b},easeInQuint:function(a,b,c,h){return c*(a/=h)*a*a*a*a+b},easeOutQuint:function(a,b,c,h){return c*((a=a/h-1)*a*a*a*a+1)+b},easeInOutQuint:function(a,b,c,h){return a/=h/2,1>a?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},easeInSine:function(a,b,c,h){return-c*Math.cos(a/h*(Math.PI/2))+c+b},easeOutSine:function(a,b,c,h){return c*Math.sin(a/h*(Math.PI/2))+b},easeInOutSine:function(a,b,c,h){return-c/2*(Math.cos(Math.PI*a/h)-1)+b},easeInExpo:function(a,b,c,h){return 0===a?b:c*Math.pow(2,
10*(a/h-1))+b},easeOutExpo:function(a,b,c,h){return a===h?b+c:c*(-Math.pow(2,-10*a/h)+1)+b},easeInOutExpo:function(a,b,c,h){return 0===a?b:a===h?b+c:(a/=h/2,1>a?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b)},easeInCirc:function(a,b,c,h){return-c*(Math.sqrt(1-(a/=h)*a)-1)+b},easeOutCirc:function(a,b,c,h){return c*Math.sqrt(1-(a=a/h-1)*a)+b},easeInOutCirc:function(a,b,c,h){return a/=h/2,1>a?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b},easeInElastic:function(a,b,f,h){var k=
0;if(0===a)return b;if(a/=h,1===a)return b+f;k||(k=.3*h);f=d(f,f,k,1.70158);return-c(f,a,h)+b},easeOutElastic:function(a,b,c,h){var k=0;if(0===a)return b;if(a/=h,1===a)return b+c;k||(k=.3*h);c=d(c,c,k,1.70158);return c.a*Math.pow(2,-10*a)*Math.sin(2*(a*h-c.s)*Math.PI/c.p)+c.c+b},easeInOutElastic:function(a,b,f,h){var k=0;if(0===a)return b;if(a/=h/2,2===a)return b+f;k||(k=.3*h*1.5);f=d(f,f,k,1.70158);return 1>a?-.5*c(f,a,h)+b:f.a*Math.pow(2,-10*--a)*Math.sin(2*(a*h-f.s)*Math.PI/f.p)*.5+f.c+b},easeInBack:function(a,
b,c,h,d){return void 0===d&&(d=1.70158),c*(a/=h)*a*((d+1)*a-d)+b},easeOutBack:function(a,b,c,h,d){return void 0===d&&(d=1.70158),c*((a=a/h-1)*a*((d+1)*a+d)+1)+b},easeInOutBack:function(a,b,c,h,d){return void 0===d&&(d=1.70158),a/=h/2,1>a?c/2*a*a*(((d*=1.525)+1)*a-d)+b:c/2*((a-=2)*a*(((d*=1.525)+1)*a+d)+2)+b},easeInBounce:b,easeOutBounce:a,easeInOutBounce:function(c,g,f,h){return h/2>c?.5*b(2*c,0,f,h)+g:.5*a(2*c-h,0,f,h)+.5*f+g}}})();
(function(d){function c(a){return a in A?A[a]:a}function b(a,b,c,f){var e,g="[object Array]"===Object.prototype.toString.call(b);return"fill"!==a&&"stroke"!==a||"none"!==b?"strokeDashArray"===a?b=b.replace(/,/g," ").split(/\s+/).map(function(a){return parseFloat(a)}):"transformMatrix"===a?b=c&&c.transformMatrix?t(c.transformMatrix,m.parseTransformAttribute(b)):m.parseTransformAttribute(b):"visible"===a?(b="none"===b||"hidden"===b?!1:!0,c&&!1===c.visible&&(b=!1)):"originX"===a?b="start"===b?"left":
"end"===b?"right":"center":e=g?b.map(z):z(b,f):b="",!g&&isNaN(e)?b:e}function a(a){for(var b in B)if("undefined"!=typeof a[B[b]]){if(!a[b]){if(!m.Object.prototype[b])continue;a[b]=m.Object.prototype[b]}if(0!==a[b].indexOf("url(")){var c=new m.Color(a[b]);a[b]=c.setAlpha(y(c.getAlpha()*a[B[b]],2)).toRgba()}}return a}function e(a,f){var e,g;a.replace(/;\s*$/,"").split(";").forEach(function(a){a=a.split(":");e=c(a[0].trim().toLowerCase());g=b(e,a[1].trim());f[e]=g})}function g(a,b){var c={},e;for(e in m.cssRules[b]){var g=
a,h=e.split(" "),d=void 0,k=!0;if((d=f(g,h.pop()))&&h.length){for(var k=h,l=void 0,p=!0;g.parentNode&&1===g.parentNode.nodeType&&k.length;)p&&(l=k.pop()),g=g.parentNode,p=f(g,l);k=0===k.length}if(d&&k&&0===h.length)for(var n in m.cssRules[b][e])c[n]=m.cssRules[b][e][n]}return c}function f(a,b){var c,f=a.nodeName,e=a.getAttribute("class"),g=a.getAttribute("id");if(c=new RegExp("^"+f,"i"),b=b.replace(c,""),g&&b.length&&(c=new RegExp("#"+g+"(?![a-zA-Z\\-]+)","i"),b=b.replace(c,"")),e&&b.length)for(e=
e.split(" "),f=e.length;f--;)c=new RegExp("\\."+e[f]+"(?![a-zA-Z\\-]+)","i"),b=b.replace(c,"");return 0===b.length}function h(a){for(var b=a.getElementsByTagName("use"),c=0;b.length&&c<b.length;){var f,e,g,h,d=b[c];g=d.getAttribute("xlink:href").substr(1);f=d.getAttribute("x")||0;e=d.getAttribute("y")||0;var l;a:if(l=a,h=void 0,l.getElementById&&(h=l.getElementById(g)),h)l=h;else{var p=h=void 0;l=l.getElementsByTagName("*");for(p=0;p<l.length;p++)if(h=l[p],g===h.getAttribute("id")){l=h;break a}l=
void 0}l=l.cloneNode(!0);var p=(l.getAttribute("transform")||"")+" translate("+f+", "+e+")",m=b.length;if(k(l),/^svg$/i.test(l.nodeName)){var n=l.ownerDocument.createElement("g");e=0;g=l.attributes;for(h=g.length;h>e;e++)f=g.item(e),n.setAttribute(f.nodeName,f.nodeValue);for(;null!=l.firstChild;)n.appendChild(l.firstChild);l=n}e=0;g=d.attributes;for(h=g.length;h>e;e++)f=g.item(e),"x"!==f.nodeName&&"y"!==f.nodeName&&"xlink:href"!==f.nodeName&&("transform"===f.nodeName?p=f.nodeValue+" "+p:l.setAttribute(f.nodeName,
f.nodeValue));l.setAttribute("transform",p);l.setAttribute("instantiated_by_use","1");l.removeAttribute("id");d.parentNode.replaceChild(l,d);b.length===m&&c++}}function k(a){var b,c,f,e=a.getAttribute("viewBox"),g=1,h=1,d=0,k=0,l=a.getAttribute("width"),p=a.getAttribute("height"),n=a.getAttribute("x")||0,u=a.getAttribute("y")||0,x=a.getAttribute("preserveAspectRatio")||"",r=!e||!v.test(a.tagName)||!(e=e.match(C)),t=!l||!p||"100%"===l||"100%"===p,y=r&&t,q={};f="";if(q.width=0,q.height=0,q.toBeParsed=
y,y)return q;if(r)return q.width=z(l),q.height=z(p),q;if(d=-parseFloat(e[1]),k=-parseFloat(e[2]),b=parseFloat(e[3]),c=parseFloat(e[4]),t?(q.width=b,q.height=c):(q.width=z(l),q.height=z(p),g=q.width/b,h=q.height/c),x=m.util.parsePreserveAspectRatioAttribute(x),"none"!==x.alignX&&(h=g=g>h?h:g),1===g&&1===h&&0===d&&0===k&&0===n&&0===u)return q;if((n||u)&&(f=" translate("+z(n)+" "+z(u)+") "),b=f+" matrix("+g+" 0 0 "+h+" "+d*g+" "+k*h+") ","svg"===a.tagName){for(f=a.ownerDocument.createElement("g");null!=
a.firstChild;)f.appendChild(a.firstChild);a.appendChild(f)}else f=a,b=f.getAttribute("transform")+b;return f.setAttribute("transform",b),q}function l(a){var b=a.objects;a=a.options;return b=b.map(function(a){return m[u(a.type)].fromObject(a)}),{objects:b,options:a}}function p(a,b,c){b[c]&&b[c].toSVG&&a.push('\t<pattern x="0" y="0" id="',c,'Pattern" ','width="',b[c].source.width,'" height="',b[c].source.height,'" patternUnits="userSpaceOnUse">\n','\t\t<image x="0" y="0" ','width="',b[c].source.width,
'" height="',b[c].source.height,'" xlink:href="',b[c].source.src,'"></image>\n\t</pattern>\n')}var m=d.fabric||(d.fabric={}),n=m.util.object.extend,u=m.util.string.capitalize,x=m.util.object.clone,y=m.util.toFixed,z=m.util.parseUnit,t=m.util.multiplyTransformMatrices,r=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,v=/^(symbol|image|marker|pattern|view|svg)$/i,q=/^(?:pattern|defs|symbol|metadata)$/i,w=/^(symbol|g|a|svg)$/i,A={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",
visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},B={stroke:"strokeOpacity",fill:"fillOpacity"};
m.cssRules={};m.gradientDefs={};m.parseTransformAttribute=function(){function a(b,c){var f=c[0],e=3===c.length?c[1]:0,g=3===c.length?c[2]:0;b[0]=Math.cos(f);b[1]=Math.sin(f);b[2]=-Math.sin(f);b[3]=Math.cos(f);b[4]=e-(b[0]*e+b[2]*g);b[5]=g-(b[1]*e+b[3]*g)}function b(a,c){var f=2===c.length?c[1]:c[0];a[0]=c[0];a[3]=f}function c(a,b){a[4]=b[0];2===b.length&&(a[5]=b[1])}var f=[1,0,0,1,0,0],e=m.reNum,g="(?:"+("(?:(matrix)\\s*\\(\\s*("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+
e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+e+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+e+")\\s*\\))")+")",h=new RegExp("^\\s*(?:"+("(?:"+g+"(?:(?:\\s+,?\\s*|,\\s*)"+g+")*)")+"?)\\s*$"),
d=new RegExp(g,"g");return function(e){var k=f.concat(),l=[];if(!e||e&&!h.test(e))return k;e.replace(d,function(e){var h=(new RegExp(g)).exec(e).filter(function(a){return""!==a&&null!=a});e=h[1];h=h.slice(2).map(parseFloat);switch(e){case "translate":c(k,h);break;case "rotate":h[0]=m.util.degreesToRadians(h[0]);a(k,h);break;case "scale":b(k,h);break;case "skewX":k[2]=Math.tan(m.util.degreesToRadians(h[0]));break;case "skewY":k[1]=Math.tan(m.util.degreesToRadians(h[0]));break;case "matrix":k=h}l.push(k.concat());
k=f.concat()});for(e=l[0];1<l.length;)l.shift(),e=m.util.multiplyTransformMatrices(e,l[0]);return e}}();var C=new RegExp("^\\s*("+m.reNum+"+)\\s*,?\\s*("+m.reNum+"+)\\s*,?\\s*("+m.reNum+"+)\\s*,?\\s*("+m.reNum+"+)\\s*$");m.parseSVGDocument=function(){return function(a,b,c){if(a){h(a);var f=new Date,e=m.Object.__uid++,g=k(a),d=m.util.toArray(a.getElementsByTagName("*"));if(g.svgUid=e,0===d.length&&m.isLikelyNode){for(var d=a.selectNodes('//*[name(.)!="svg"]'),l=[],p=0,n=d.length;n>p;p++)l[p]=d[p];
d=l}d=d.filter(function(a){k(a);var b;if(b=r.test(a.tagName)){a:{for(;a&&(a=a.parentNode);)if(q.test(a.nodeName)&&!a.getAttribute("instantiated_by_use")){a=!0;break a}a=!1}b=!a}return b});if(!d||d&&!d.length)return void(b&&b([],{}));m.gradientDefs[e]=m.getGradientDefs(a);m.cssRules[e]=m.getCSSRules(a);m.parseElements(d,function(a){m.documentParsingTime=new Date-f;b&&b(a,g)},x(g),c)}}}();var D={has:function(a,b){b(!1)},get:function(){},set:function(){}},E=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+
m.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+m.reNum+"))?\\s+(.*)");n(m,{parseFontDeclaration:function(a,b){var c=a.match(E);if(c){var f=c[1],e=c[3],g=c[4],h=c[5],c=c[6];f&&(b.fontStyle=f);e&&(b.fontWeight=isNaN(parseFloat(e))?e:parseFloat(e));g&&(b.fontSize=z(g));c&&(b.fontFamily=c);h&&(b.lineHeight="normal"===h?1:h)}},getGradientDefs:function(a){var b,c,f;b=a.getElementsByTagName("linearGradient");var e=a.getElementsByTagName("radialGradient"),g=0,h=[];a={};var d={};h.length=b.length+e.length;
for(c=b.length;c--;)h[g++]=b[c];for(c=e.length;c--;)h[g++]=e[c];for(;g--;)b=h[g],c=b.getAttribute("xlink:href"),f=b.getAttribute("id"),c&&(d[f]=c.substr(1)),a[f]=b;for(f in d)for(g=a[d[f]].cloneNode(!0),b=a[f];g.firstChild;)b.appendChild(g.firstChild);return a},parseAttributes:function(f,e,h){if(f){var d,k,l={};"undefined"==typeof h&&(h=f.getAttribute("svgUid"));f.parentNode&&w.test(f.parentNode.nodeName)&&(l=m.parseAttributes(f.parentNode,e,h));k=l&&l.fontSize||f.getAttribute("font-size")||m.Text.DEFAULT_SVG_FONT_SIZE;
e=e.reduce(function(a,e){return d=f.getAttribute(e),d&&(e=c(e),d=b(e,d,l,k),a[e]=d),a},{});return e=n(e,n(g(f,h),m.parseStyleAttribute(f))),e.font&&m.parseFontDeclaration(e.font,e),a(n(l,e))}},parseElements:function(a,b,c,f){(new m.ElementsParser(a,b,c,f)).parse()},parseStyleAttribute:function(a){var f={};if(a=a.getAttribute("style"))if("string"==typeof a)e(a,f);else{var g,h,d;for(d in a)"undefined"!=typeof a[d]&&(g=c(d.toLowerCase()),h=b(g,a[d]),f[g]=h)}return f},parsePointsAttribute:function(a){if(!a)return null;
a=a.replace(/,/g," ").trim();a=a.split(/\s+/);var b,c,f=[];b=0;for(c=a.length;c>b;b+=2)f.push({x:parseFloat(a[b]),y:parseFloat(a[b+1])});return f},getCSSRules:function(a){var f;a=a.getElementsByTagName("style");for(var e={},g=0,h=a.length;h>g;g++){var d=a[g].textContent,d=d.replace(/\/\*[\s\S]*?\*\//g,"");""!==d.trim()&&(f=d.match(/[^{]*\{[\s\S]*?\}/g),f=f.map(function(a){return a.trim()}),f.forEach(function(a){a=a.match(/([\s\S]*?)\s*\{([^}]*)\}/);for(var f={},g=a[2].trim().replace(/;$/,"").split(/\s*;\s*/),
h=0,d=g.length;d>h;h++){var k=g[h].split(/\s*:\s*/),l=c(k[0]),k=b(l,k[1],k[0]);f[l]=k}a=a[1];a.split(",").forEach(function(a){a=a.replace(/^svg/i,"").trim();""!==a&&(e[a]=m.util.object.clone(f))})}))}return e},loadSVGFromURL:function(a,b,c){function f(e){var g=e.responseXML;g&&!g.documentElement&&m.window.ActiveXObject&&e.responseText&&(g=new ActiveXObject("Microsoft.XMLDOM"),g.async="false",g.loadXML(e.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));g&&g.documentElement&&m.parseSVGDocument(g.documentElement,
function(c,f){D.set(a,{objects:m.util.array.invoke(c,"toObject"),options:f});b(c,f)},c)}a=a.replace(/^\n\s*/,"").trim();D.has(a,function(c){c?D.get(a,function(a){a=l(a);b(a.objects,a.options)}):new m.util.request(a,{method:"get",onComplete:f})})},loadSVGFromString:function(a,b,c){a=a.trim();var f;if("undefined"!=typeof DOMParser){var e=new DOMParser;e&&e.parseFromString&&(f=e.parseFromString(a,"text/xml"))}else m.window.ActiveXObject&&(f=new ActiveXObject("Microsoft.XMLDOM"),f.async="false",f.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,
"")));m.parseSVGDocument(f.documentElement,function(a,c){b(a,c)},c)},createSVGFontFacesMarkup:function(a){for(var b="",c=0,f=a.length;f>c;c++)"text"===a[c].type&&a[c].path&&(b+=["@font-face {font-family: ",a[c].fontFamily,"; src: url('",a[c].path,"')}\n"].join(""));return b&&(b=['\t<style type="text/css"><![CDATA[',b,"]]\x3e</style>\n"].join("")),b},createSVGRefElementsMarkup:function(a){var b=[];return p(b,a,"backgroundColor"),p(b,a,"overlayColor"),b.join("")}})})("undefined"!=typeof exports?exports:
this);fabric.ElementsParser=function(d,c,b,a){this.elements=d;this.callback=c;this.options=b;this.reviver=a;this.svgUid=b&&b.svgUid||0};fabric.ElementsParser.prototype.parse=function(){this.instances=Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};
fabric.ElementsParser.prototype.createObjects=function(){for(var d=0,c=this.elements.length;c>d;d++)this.elements[d].setAttribute("svgUid",this.svgUid),function(b,a){setTimeout(function(){b.createObject(b.elements[a],a)},0)}(this,d)};fabric.ElementsParser.prototype.createObject=function(d,c){var b=fabric[fabric.util.string.capitalize(d.tagName)];if(b&&b.fromElement)try{this._createObject(b,d,c)}catch(a){fabric.log(a)}else this.checkIfDone()};
fabric.ElementsParser.prototype._createObject=function(d,c,b){d.async?d.fromElement(c,this.createCallback(b,c),this.options):(d=d.fromElement(c,this.options),this.resolveGradient(d,"fill"),this.resolveGradient(d,"stroke"),this.reviver&&this.reviver(c,d),this.instances[b]=d,this.checkIfDone())};fabric.ElementsParser.prototype.createCallback=function(d,c){var b=this;return function(a){b.resolveGradient(a,"fill");b.resolveGradient(a,"stroke");b.reviver&&b.reviver(c,a);b.instances[d]=a;b.checkIfDone()}};
fabric.ElementsParser.prototype.resolveGradient=function(d,c){var b=d.get(c);/^url\(/.test(b)&&(b=b.slice(5,b.length-1),fabric.gradientDefs[this.svgUid][b]&&d.set(c,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][b],d)))};fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(d){return null!=d}),this.callback(this.instances))};
(function(d){function c(b,a){this.x=b;this.y=a}d=d.fabric||(d.fabric={});return d.Point?void d.warn("fabric.Point is already defined"):(d.Point=c,void(c.prototype={constructor:c,add:function(b){return new c(this.x+b.x,this.y+b.y)},addEquals:function(b){return this.x+=b.x,this.y+=b.y,this},scalarAdd:function(b){return new c(this.x+b,this.y+b)},scalarAddEquals:function(b){return this.x+=b,this.y+=b,this},subtract:function(b){return new c(this.x-b.x,this.y-b.y)},subtractEquals:function(b){return this.x-=
b.x,this.y-=b.y,this},scalarSubtract:function(b){return new c(this.x-b,this.y-b)},scalarSubtractEquals:function(b){return this.x-=b,this.y-=b,this},multiply:function(b){return new c(this.x*b,this.y*b)},multiplyEquals:function(b){return this.x*=b,this.y*=b,this},divide:function(b){return new c(this.x/b,this.y/b)},divideEquals:function(b){return this.x/=b,this.y/=b,this},eq:function(b){return this.x===b.x&&this.y===b.y},lt:function(b){return this.x<b.x&&this.y<b.y},lte:function(b){return this.x<=b.x&&
this.y<=b.y},gt:function(b){return this.x>b.x&&this.y>b.y},gte:function(b){return this.x>=b.x&&this.y>=b.y},lerp:function(b,a){return new c(this.x+(b.x-this.x)*a,this.y+(b.y-this.y)*a)},distanceFrom:function(b){var a=this.x-b.x;b=this.y-b.y;return Math.sqrt(a*a+b*b)},midPointFrom:function(b){return new c(this.x+(b.x-this.x)/2,this.y+(b.y-this.y)/2)},min:function(b){return new c(Math.min(this.x,b.x),Math.min(this.y,b.y))},max:function(b){return new c(Math.max(this.x,b.x),Math.max(this.y,b.y))},toString:function(){return this.x+
","+this.y},setXY:function(b,a){this.x=b;this.y=a},setFromPoint:function(b){this.x=b.x;this.y=b.y},swap:function(b){var a=this.x,c=this.y;this.x=b.x;this.y=b.y;b.x=a;b.y=c}}))})("undefined"!=typeof exports?exports:this);
(function(d){function c(a){this.status=a;this.points=[]}var b=d.fabric||(d.fabric={});return b.Intersection?void b.warn("fabric.Intersection is already defined"):(b.Intersection=c,b.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},b.Intersection.intersectLineLine=function(a,e,g,f){var h,d=(f.x-g.x)*(a.y-g.y)-(f.y-g.y)*(a.x-g.x),l=(e.x-a.x)*(a.y-g.y)-(e.y-a.y)*(a.x-g.x);g=(f.y-g.y)*(e.x-a.x)-(f.x-g.x)*(e.y-a.y);0!==g?
(d/=g,l/=g,0<=d&&1>=d&&0<=l&&1>=l?(h=new c("Intersection"),h.points.push(new b.Point(a.x+d*(e.x-a.x),a.y+d*(e.y-a.y)))):h=new c):h=new c(0===d||0===l?"Coincident":"Parallel");return h},b.Intersection.intersectLinePolygon=function(a,b,g){for(var f=new c,h=g.length,d=0;h>d;d++){var l=c.intersectLineLine(a,b,g[d],g[(d+1)%h]);f.appendPoints(l.points)}return 0<f.points.length&&(f.status="Intersection"),f},b.Intersection.intersectPolygonPolygon=function(a,b){for(var g=new c,f=a.length,h=0;f>h;h++){var d=
c.intersectLinePolygon(a[h],a[(h+1)%f],b);g.appendPoints(d.points)}return 0<g.points.length&&(g.status="Intersection"),g},void(b.Intersection.intersectPolygonRectangle=function(a,e,g){var f=e.min(g),h=e.max(g);g=new b.Point(h.x,f.y);var d=new b.Point(f.x,h.y);e=c.intersectLinePolygon(f,g,a);g=c.intersectLinePolygon(g,h,a);h=c.intersectLinePolygon(h,d,a);a=c.intersectLinePolygon(d,f,a);f=new c;return f.appendPoints(e.points),f.appendPoints(g.points),f.appendPoints(h.points),f.appendPoints(a.points),
0<f.points.length&&(f.status="Intersection"),f}))})("undefined"!=typeof exports?exports:this);
(function(d){function c(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function b(a,b,c){return 0>c&&(c+=1),1<c&&--c,1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var a=d.fabric||(d.fabric={});return a.Color?void a.warn("fabric.Color is already defined."):(a.Color=c,a.Color.prototype={_tryParsingColor:function(a){var b;return a in c.colorNameMap&&(a=c.colorNameMap[a]),"transparent"===a?void this.setSource([255,255,255,0]):(b=c.sourceFromHex(a),b||(b=c.sourceFromRgb(a)),b||(b=c.sourceFromHsl(a)),
void(b&&this.setSource(b)))},_rgbToHsl:function(b,c,f){b/=255;c/=255;f/=255;var h,d,l,p=a.util.array.max([b,c,f]);d=a.util.array.min([b,c,f]);if(l=(p+d)/2,p===d)h=d=0;else{var m=p-d;switch(d=.5<l?m/(2-p-d):m/(p+d),p){case b:h=(c-f)/m+(f>c?6:0);break;case c:h=(f-b)/m+2;break;case f:h=(b-c)/m+4}h/=6}return[Math.round(360*h),Math.round(100*d),Math.round(100*l)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+
a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a,b,c,h=this.getSource();return a=h[0].toString(16),a=1===a.length?"0"+a:a,b=h[1].toString(16),b=1===b.length?"0"+b:b,c=h[2].toString(16),
c=1===c.length?"0"+c:c,a.toUpperCase()+b.toUpperCase()+c.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();return b[3]=a,this.setSource(b),this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10);return this.setSource([b,b,b,a[3]]),this},toBlackWhite:function(a){var b=this.getSource(),c=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),b=b[3];return a=a||127,c=Number(c)<Number(a)?0:255,this.setSource([c,
c,c,b]),this},overlayWith:function(a){a instanceof c||(a=new c(a));var b=[],f=this.getAlpha(),h=this.getSource();a=a.getSource();for(var d=0;3>d;d++)b.push(Math.round(.5*h[d]+.5*a[d]));return b[3]=f,this.setSource(b),this}},a.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,a.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,a.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,
a.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},a.Color.fromRgb=function(a){return c.fromSource(c.sourceFromRgb(a))},a.Color.sourceFromRgb=function(a){if(a=a.match(c.reRGBa)){var b=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),f=parseInt(a[2],
10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),h=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(b,10),parseInt(f,10),parseInt(h,10),a[4]?parseFloat(a[4]):1]}},a.Color.fromRgba=c.fromRgb,a.Color.fromHsl=function(a){return c.fromSource(c.sourceFromHsl(a))},a.Color.sourceFromHsl=function(a){if(a=a.match(c.reHSLa)){var g,f,h;h=(parseFloat(a[1])%360+360)%360/360;f=parseFloat(a[2])/(/%$/.test(a[2])?100:1);g=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===f)g=f=h=
g;else{var d=.5>=g?g*(f+1):g+f-g*f,l=2*g-d;g=b(l,d,h+1/3);f=b(l,d,h);h=b(l,d,h-1/3)}return[Math.round(255*g),Math.round(255*f),Math.round(255*h),a[4]?parseFloat(a[4]):1]}},a.Color.fromHsla=c.fromHsl,a.Color.fromHex=function(a){return c.fromSource(c.sourceFromHex(a))},a.Color.sourceFromHex=function(a){if(a.match(c.reHex)){var b=a.slice(a.indexOf("#")+1),f=3===b.length;a=f?b.charAt(0)+b.charAt(0):b.substring(0,2);var h=f?b.charAt(1)+b.charAt(1):b.substring(2,4),b=f?b.charAt(2)+b.charAt(2):b.substring(4,
6);return[parseInt(a,16),parseInt(h,16),parseInt(b,16),1]}},void(a.Color.fromSource=function(a){var b=new c;return b.setSource(a),b}))})("undefined"!=typeof exports?exports:this);
(function(){function d(b){var a,c,g,f=b.getAttribute("style"),h=b.getAttribute("offset")||0;if(h=parseFloat(h)/(/%$/.test(h)?100:1),h=0>h?0:1<h?1:h,f){f=f.split(/\s*;\s*/);""===f[f.length-1]&&f.pop();for(var d=f.length;d--;){var l=f[d].split(/\s*:\s*/),p=l[0].trim(),l=l[1].trim();"stop-color"===p?a=l:"stop-opacity"===p&&(g=l)}}return a||(a=b.getAttribute("stop-color")||"rgb(0,0,0)"),g||(g=b.getAttribute("stop-opacity")),a=new fabric.Color(a),c=a.getAlpha(),g=isNaN(parseFloat(g))?1:parseFloat(g),g*=
c,{offset:h,color:a.toRgb(),opacity:g}}function c(b,a,c){var g,f=0,h=1,d="",l;for(l in a)g=parseFloat(a[l],10),h="string"==typeof a[l]&&/^\d+%$/.test(a[l])?.01:1,"x1"===l||"x2"===l||"r2"===l?(h*="objectBoundingBox"===c?b.width:1,f="objectBoundingBox"===c?b.left||0:0):("y1"===l||"y2"===l)&&(h*="objectBoundingBox"===c?b.height:1,f="objectBoundingBox"===c?b.top||0:0),a[l]=g*h+f;"ellipse"===b.type&&null!==a.r2&&"objectBoundingBox"===c&&b.rx!==b.ry&&(b=b.ry/b.rx,d=" scale(1, "+b+")",a.y1&&(a.y1/=b),a.y2&&
(a.y2/=b));return d}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(b){b||(b={});var a={};this.id=fabric.Object.__uid++;this.type=b.type||"linear";a={x1:b.coords.x1||0,y1:b.coords.y1||0,x2:b.coords.x2||0,y2:b.coords.y2||0};"radial"===this.type&&(a.r1=b.coords.r1||0,a.r2=b.coords.r2||0);this.coords=a;this.colorStops=b.colorStops.slice();b.gradientTransform&&(this.gradientTransform=b.gradientTransform);this.offsetX=b.offsetX||this.offsetX;this.offsetY=b.offsetY||this.offsetY},
addColorStop:function(b){for(var a in b){var c=new fabric.Color(b[a]);this.colorStops.push({offset:a,color:c.toRgb(),opacity:c.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform}},toSVG:function(b){var a,c=fabric.util.object.clone(this.coords);if(this.colorStops.sort(function(a,b){return a.offset-b.offset}),
!b.group||"path-group"!==b.group.type)for(var g in c)"x1"===g||"x2"===g||"r2"===g?c[g]+=this.offsetX-b.width/2:("y1"===g||"y2"===g)&&(c[g]+=this.offsetY-b.height/2);b='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"';this.gradientTransform&&(b+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" ');"linear"===this.type?a=["<linearGradient ",b,' x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'">\n']:"radial"===this.type&&(a=["<radialGradient ",b,' cx="',c.x2,'" cy="',c.y2,
'" r="',c.r2,'" fx="',c.x1,'" fy="',c.y1,'">\n']);for(c=0;c<this.colorStops.length;c++)a.push("<stop ",'offset="',100*this.colorStops[c].offset+"%",'" style="stop-color:',this.colorStops[c].color,null!=this.colorStops[c].opacity?";stop-opacity: "+this.colorStops[c].opacity:";",'"/>\n');return a.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),a.join("")},toLive:function(b,a){var c,g,f=fabric.util.object.clone(this.coords);if(this.type){if(a.group&&"path-group"===a.group.type)for(g in f)"x1"===
g||"x2"===g?f[g]+=-this.offsetX+a.width/2:("y1"===g||"y2"===g)&&(f[g]+=-this.offsetY+a.height/2);"linear"===this.type?c=b.createLinearGradient(f.x1,f.y1,f.x2,f.y2):"radial"===this.type&&(c=b.createRadialGradient(f.x1,f.y1,f.r1,f.x2,f.y2,f.r2));g=0;for(f=this.colorStops.length;f>g;g++){var h=this.colorStops[g].color,d=this.colorStops[g].opacity,l=this.colorStops[g].offset;"undefined"!=typeof d&&(h=(new fabric.Color(h)).setAlpha(d).toRgba());c.addColorStop(parseFloat(l),h)}return c}}});fabric.util.object.extend(fabric.Gradient,
{fromElement:function(b,a){var e;e=b.getElementsByTagName("stop");var g="linearGradient"===b.nodeName?"linear":"radial",f=b.getAttribute("gradientUnits")||"objectBoundingBox",h=b.getAttribute("gradientTransform"),k=[],l={};"linear"===g?l={x1:b.getAttribute("x1")||0,y1:b.getAttribute("y1")||0,x2:b.getAttribute("x2")||"100%",y2:b.getAttribute("y2")||0}:"radial"===g&&(l={x1:b.getAttribute("fx")||b.getAttribute("cx")||"50%",y1:b.getAttribute("fy")||b.getAttribute("cy")||"50%",r1:0,x2:b.getAttribute("cx")||
"50%",y2:b.getAttribute("cy")||"50%",r2:b.getAttribute("r")||"50%"});for(var p=e.length;p--;)k.push(d(e[p]));e=c(a,l,f);g=new fabric.Gradient({type:g,coords:l,colorStops:k,offsetX:-a.left,offsetY:-a.top});return(h||""!==e)&&(g.gradientTransform=fabric.parseTransformAttribute((h||"")+e)),g},forObject:function(b,a){return a||(a={}),c(b,a.coords,"userSpaceOnUse"),new fabric.Gradient(a)}})})();
fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(d){if(d||(d={}),this.id=fabric.Object.__uid++,d.source)if("string"==typeof d.source)if("undefined"!=typeof fabric.util.getFunctionBody(d.source))this.source=new Function(fabric.util.getFunctionBody(d.source));else{var c=this;this.source=fabric.util.createImage();fabric.util.loadImage(d.source,function(b){c.source=b})}else this.source=d.source;d.repeat&&(this.repeat=d.repeat);d.offsetX&&(this.offsetX=d.offsetX);
d.offsetY&&(this.offsetY=d.offsetY)},toObject:function(){var d;return"function"==typeof this.source?d=String(this.source):"string"==typeof this.source.src?d=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(d=this.source.toDataURL()),{source:d,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(d){var c="function"==typeof this.source?this.source():this.source,b=c.width/d.getWidth(),a=c.height/d.getHeight(),e=this.offsetX/d.getWidth();d=this.offsetY/d.getHeight();
var g="";return("repeat-x"===this.repeat||"no-repeat"===this.repeat)&&(a=1),("repeat-y"===this.repeat||"no-repeat"===this.repeat)&&(b=1),c.src?g=c.src:c.toDataURL&&(g=c.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+e+'" y="'+d+'" width="'+b+'" height="'+a+'">\n<image x="0" y="0" width="'+c.width+'" height="'+c.height+'" xlink:href="'+g+'"></image>\n</pattern>\n'},toLive:function(d){var c="function"==typeof this.source?this.source():this.source;return c&&("undefined"==typeof c.src||c.complete&&
0!==c.naturalWidth&&0!==c.naturalHeight)?d.createPattern(c,this.repeat):""}});
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.toFixed;return c.Shadow?void c.warn("fabric.Shadow is already defined."):(c.Shadow=c.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(a){"string"==typeof a&&(a=this._parseShadow(a));for(var b in a)this[b]=a[b];this.id=c.Object.__uid++},_parseShadow:function(a){a=a.trim();var b=c.Shadow.reOffsetsAndBlur.exec(a)||[];return{color:(a.replace(c.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),
offsetX:parseInt(b[1],10)||0,offsetY:parseInt(b[2],10)||0,blur:parseInt(b[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var e=40,g=40,f=c.Object.NUM_FRACTION_DIGITS,h=c.util.rotateVector({x:this.offsetX,y:this.offsetY},c.util.degreesToRadians(-a.angle));return a.width&&a.height&&(e=100*b((Math.abs(h.x)+this.blur)/a.width,f)+20,g=100*b((Math.abs(h.y)+this.blur)/a.height,f)+20),'<filter id="SVGID_'+this.id+'" y="-'+g+'%" height="'+
(100+2*g)+'%" x="-'+e+'%" width="'+(100+2*e)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+b(this.blur?this.blur/2:0,f)+'"></feGaussianBlur>\n\t<feOffset dx="'+b(h.x,f)+'" dy="'+b(h.y,f)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+this.color+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,
blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var a={},b=c.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(c){this[c]!==b[c]&&(a[c]=this[c])},this),a}}),void(c.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))})("undefined"!=typeof exports?exports:this);
(function(){if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var d=fabric.util.object.extend,c=fabric.util.getElementOffset,b=fabric.util.removeFromArray,a=fabric.util.toFixed,e=Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(a,b){b||(b={});this._initStatic(a,b);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,
stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},enableRetinaScaling:!0,_initStatic:function(a,b){this._objects=[];this._createLowerCanvas(a);this._initOptions(b);this._setImageSmoothing();this.interactive||this._initRetinaScaling();b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this));b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,
this.renderAll.bind(this));b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,this.renderAll.bind(this));b.overlayColor&&this.setOverlayColor(b.overlayColor,this.renderAll.bind(this));this.calcOffset()},_initRetinaScaling:function(){1!==fabric.devicePixelRatio&&this.enableRetinaScaling&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,
fabric.devicePixelRatio))},calcOffset:function(){return this._offset=c(this.lowerCanvasEl),this},setOverlayImage:function(a,b,c){return this.__setBgOverlayImage("overlayImage",a,b,c)},setBackgroundImage:function(a,b,c){return this.__setBgOverlayImage("backgroundImage",a,b,c)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();
return"undefined"!=typeof a.imageSmoothingEnabled?void(a.imageSmoothingEnabled=this.imageSmoothingEnabled):(a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled,a.mozImageSmoothingEnabled=this.imageSmoothingEnabled,a.msImageSmoothingEnabled=this.imageSmoothingEnabled,void(a.oImageSmoothingEnabled=this.imageSmoothingEnabled))},__setBgOverlayImage:function(a,b,c,e){return"string"==typeof b?fabric.util.loadImage(b,function(b){this[a]=new fabric.Image(b,e);c&&c()},this,e&&e.crossOrigin):(e&&b.setOptions(e),
this[a]=b,c&&c()),this},__setBgOverlayColor:function(a,b,c){if(b&&b.source){var e=this;fabric.util.loadImage(b.source,function(d){e[a]=new fabric.Pattern({source:d,repeat:b.repeat,offsetX:b.offsetX,offsetY:b.offsetY});c&&c()})}else this[a]=b,c&&c();return this},_createCanvasElement:function(){var a=fabric.document.createElement("canvas");if(a.style||(a.style={}),!a)throw e;return this._initCanvasElement(a),a},_initCanvasElement:function(a){if(fabric.util.createCanvasElement(a),"undefined"==typeof a.getContext)throw e;
},_initOptions:function(a){for(var b in a)this[b]=a[b];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||
this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){var c;b=b||{};for(var e in a)c=
a[e],b.cssOnly||(this._setBackstoreDimension(e,a[e]),c+="px"),b.backstoreOnly||this._setCssDimension(e,c);return this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),b.cssOnly||this.renderAll(),this},_setBackstoreDimension:function(a,b){return this.lowerCanvasEl[a]=b,this.upperCanvasEl&&(this.upperCanvasEl[a]=b),this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b),this[a]=b,this},_setCssDimension:function(a,b){return this.lowerCanvasEl.style[a]=b,this.upperCanvasEl&&(this.upperCanvasEl.style[a]=
b),this.wrapperEl&&(this.wrapperEl.style[a]=b),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(a){var b=this.getActiveGroup();this.viewportTransform=a;this.renderAll();a=0;for(var c=this._objects.length;c>a;a++)this._objects[a].setCoords();return b&&b.setCoords(),this},zoomToPoint:function(a,b){var c=a;a=fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=b;this.viewportTransform[3]=
b;var e=fabric.util.transformPoint(a,this.viewportTransform);this.viewportTransform[4]+=c.x-e.x;this.viewportTransform[5]+=c.y-e.y;this.renderAll();c=0;for(e=this._objects.length;e>c;c++)this._objects[c].setCoords();return this},setZoom:function(a){return this.zoomToPoint(new fabric.Point(0,0),a),this},absolutePan:function(a){this.viewportTransform[4]=-a.x;this.viewportTransform[5]=-a.y;this.renderAll();a=0;for(var b=this._objects.length;b>a;a++)this._objects[a].setCoords();return this},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-
this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_onObjectAdded:function(a){this.stateful&&a.setupState();a._set("canvas",this);a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared"));
this.fire("object:removed",{target:a});a.fire("removed")},clearContext:function(a){return a.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},_chooseObjectsToRender:function(){var a,
b=this.getActiveGroup(),c=[],e=[];if(b&&!this.preserveObjectStacking){for(var d=0,p=this._objects.length;p>d;d++)a=this._objects[d],b.contains(a)?e.push(a):c.push(a);b._set("_objects",e)}else c=this._objects;return c},renderAll:function(){var a,b=this.contextContainer;return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),this.clearContext(b),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,b),this._renderBackground(b),b.save(),a=this._chooseObjectsToRender(),
b.transform.apply(b,this.viewportTransform),this._renderObjects(b,a),this.preserveObjectStacking||this._renderObjects(b,[this.getActiveGroup()]),b.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(b),this.clipTo&&b.restore(),this._renderOverlay(b),this.controlsAboveOverlay&&this.interactive&&this.drawControls(b),this.fire("after:render"),b.restore(),this},_renderObjects:function(a,b){for(var c=0,e=b.length;e>c;++c)b[c]&&b[c].render(a)},_renderBackgroundOrOverlay:function(a,
b){var c=this[b+"Color"];c&&(a.fillStyle=c.toLive?c.toLive(a):c,a.fillRect(c.offsetX||0,c.offsetY||0,this.width,this.height));(c=this[b+"Image"])&&c.render(a)},_renderBackground:function(a){this._renderBackgroundOrOverlay(a,"background")},_renderOverlay:function(a){this._renderBackgroundOrOverlay(a,"overlay")},renderTop:function(){return this.clearContext(this.contextTop||this.contextContainer),this.selection&&this._groupSelector&&this._drawSelection(),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/
2,left:this.getWidth()/2}},centerObjectH:function(a){return this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(a){return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(a){var b=this.getCenter();return this._centerObject(a,new fabric.Point(b.left,b.top)),this.renderAll(),this},_centerObject:function(a,b){return a.setPositionByOrigin(b,"center",
"center"),this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,b){var c={objects:this._toObjects(a,b)};return d(c,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,c,b),c},_toObjects:function(a,b){return this.getObjects().map(function(c){return this._toObject(c,a,b)},this)},_toObject:function(a,b,
c){var e;this.includeDefaultValues||(e=a.includeDefaultValues,a.includeDefaultValues=!1);var d=this._realizeGroupTransformOnObject(a);b=a[b](c);return this.includeDefaultValues||(a.includeDefaultValues=e),this._unwindGroupTransformOnObject(a,d),b},_realizeGroupTransformOnObject:function(a){var b="angle flipX flipY height left scaleX scaleY top width".split(" ");if(a.group&&a.group===this.getActiveGroup()){var c={};return b.forEach(function(b){c[b]=a[b]}),this.getActiveGroup().realizeTransform(a),
c}return null},_unwindGroupTransformOnObject:function(a,b){b&&a.set(b)},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(a.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(a.overlayImage=this.overlayImage.toObject()),a},svgViewportTransformation:!0,
toSVG:function(a,b){a||(a={});var c=[];return this._setSVGPreamble(c,a),this._setSVGHeader(c,a),this._setSVGBgOverlayColor(c,"backgroundColor"),this._setSVGBgOverlayImage(c,"backgroundImage"),this._setSVGObjects(c,b),this._setSVGBgOverlayColor(c,"overlayColor"),this._setSVGBgOverlayImage(c,"overlayImage"),c.push("</svg>"),c.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',
'"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(b,c){var e,d=c.width||this.width,l=c.height||this.height,p='viewBox="0 0 '+this.width+" "+this.height+'" ',m=fabric.Object.NUM_FRACTION_DIGITS;c.viewBox?p='viewBox="'+c.viewBox.x+" "+c.viewBox.y+" "+c.viewBox.width+" "+c.viewBox.height+'" ':this.svgViewportTransformation&&(e=this.viewportTransform,p='viewBox="'+a(-e[4]/e[0],m)+" "+a(-e[5]/e[3],m)+" "+a(this.width/e[0],m)+" "+a(this.height/e[3],m)+'" ');b.push("<svg ",
'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',d,'" ','height="',l,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,p,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>\n")},_setSVGObjects:function(a,b){for(var c=0,e=this.getObjects(),
d=e.length;d>c;c++){var p=e[c],m=this._realizeGroupTransformOnObject(p);a.push(p.toSVG(b));this._unwindGroupTransformOnObject(p,m)}},_setSVGBgOverlayImage:function(a,b){this[b]&&this[b].toSVG&&a.push(this[b].toSVG())},_setSVGBgOverlayColor:function(a,b){this[b]&&this[b].source?a.push('<rect x="',this[b].offsetX,'" y="',this[b].offsetY,'" ','width="',"repeat-y"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.width:this.width,'" height="',"repeat-x"===this[b].repeat||"no-repeat"===this[b].repeat?
this[b].source.height:this.height,'" fill="url(#'+b+'Pattern)"',"></rect>\n"):this[b]&&"overlayColor"===b&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>\n")},sendToBack:function(a){return b(this._objects,a),this._objects.unshift(a),this.renderAll&&this.renderAll()},bringToFront:function(a){return b(this._objects,a),this._objects.push(a),this.renderAll&&this.renderAll()},sendBackwards:function(a,c){var e=this._objects.indexOf(a);0!==e&&(e=
this._findNewLowerIndex(a,e,c),b(this._objects,a),this._objects.splice(e,0,a),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,b,c){if(c)for(c=b,--b;0<=b;--b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){c=b;break}}else c=b-1;return c},bringForward:function(a,c){var e=this._objects.indexOf(a);e!==this._objects.length-1&&(e=this._findNewUpperIndex(a,e,c),b(this._objects,a),this._objects.splice(e,
0,a),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(a,b,c){if(c)for(c=b,b+=1;b<this._objects.length;++b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){c=b;break}}else c=b+1;return c},moveTo:function(a,c){return b(this._objects,a),this._objects.splice(c,0,a),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+
this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});d(fabric.StaticCanvas.prototype,fabric.Observable);d(fabric.StaticCanvas.prototype,fabric.Collection);d(fabric.StaticCanvas.prototype,fabric.DataURLExporter);d(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=fabric.util.createCanvasElement();if(!b||!b.getContext)return null;var c=b.getContext("2d");if(!c)return null;switch(a){case "getImageData":return"undefined"!=typeof c.getImageData;
case "setLineDash":return"undefined"!=typeof c.setLineDash;case "toDataURL":return"undefined"!=typeof b.toDataURL;case "toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(e){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject})();
fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(d){return this.shadow=new fabric.Shadow(d),this},_setBrushStyles:function(){var d=this.canvas.contextTop;d.strokeStyle=this.color;d.lineWidth=this.width;d.lineCap=this.strokeLineCap;d.lineJoin=this.strokeLineJoin;this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&d.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var d=
this.canvas.contextTop;d.shadowColor=this.shadow.color;d.shadowBlur=this.shadow.blur;d.shadowOffsetX=this.shadow.offsetX;d.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var d=this.canvas.contextTop;d.shadowColor="";d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0}});
(function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(d){this.canvas=d;this._points=[]},onMouseDown:function(d){this._prepareForDrawing(d);this._captureDrawingPath(d);this._render()},onMouseMove:function(d){this._captureDrawingPath(d);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(d){d=new fabric.Point(d.x,d.y);this._reset();this._addPoint(d);this.canvas.contextTop.moveTo(d.x,
d.y)},_addPoint:function(d){this._points.push(d)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(d){d=new fabric.Point(d.x,d.y);this._addPoint(d)},_render:function(){var d=this.canvas.contextTop,c=this.canvas.viewportTransform,b=this._points[0],a=this._points[1];d.save();d.transform(c[0],c[1],c[2],c[3],c[4],c[5]);d.beginPath();2===this._points.length&&b.x===a.x&&b.y===a.y&&(b.x-=.5,a.x+=.5);d.moveTo(b.x,b.y);for(var c=1,e=this._points.length;e>
c;c++)a=b.midPointFrom(a),d.quadraticCurveTo(b.x,b.y,a.x,a.y),b=this._points[c],a=this._points[c+1];d.lineTo(b.x,b.y);d.stroke();d.restore()},convertPointsToSVGPath:function(d){var c=[],b=new fabric.Point(d[0].x,d[0].y),a=new fabric.Point(d[1].x,d[1].y);c.push("M ",d[0].x," ",d[0].y," ");for(var e=1,g=d.length;g>e;e++){var f=b.midPointFrom(a);c.push("Q ",b.x," ",b.y," ",f.x," ",f.y," ");b=new fabric.Point(d[e].x,d[e].y);e+1<d.length&&(a=new fabric.Point(d[e+1].x,d[e+1].y))}return c.push("L ",b.x,
" ",b.y," "),c},createPath:function(d){d=new fabric.Path(d,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,d.setShadow(this.shadow)),d},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var d=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===d)return void this.canvas.renderAll();
d=this.createPath(d);this.canvas.add(d);d.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire("path:created",{path:d})}})})();
fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(d){this.canvas=d;this.points=[]},drawDot:function(d){d=this.addPoint(d);var c=this.canvas.contextTop,b=this.canvas.viewportTransform;c.save();c.transform(b[0],b[1],b[2],b[3],b[4],b[5]);c.fillStyle=d.fill;c.beginPath();c.arc(d.x,d.y,d.radius,0,2*Math.PI,!1);c.closePath();c.fill();c.restore()},onMouseDown:function(d){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(d)},
onMouseMove:function(d){this.drawDot(d)},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var c=[],b=0,a=this.points.length;a>b;b++){var e=this.points[b],e=new fabric.Circle({radius:e.radius,left:e.x,top:e.y,originX:"center",originY:"center",fill:e.fill});this.shadow&&e.setShadow(this.shadow);c.push(e)}c=new fabric.Group(c,{originX:"center",originY:"center"});c.canvas=this.canvas;this.canvas.add(c);this.canvas.fire("path:created",{path:c});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.renderAll()},addPoint:function(d){d=new fabric.Point(d.x,d.y);var c=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,b=(new fabric.Color(this.color)).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return d.radius=c,d.fill=b,this.points.push(d),d}});
fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(d){this.canvas=d;this.sprayChunks=[]},onMouseDown:function(d){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(d);this.render()},onMouseMove:function(d){this.addSprayChunk(d);this.render()},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=
!1;for(var c=[],b=0,a=this.sprayChunks.length;a>b;b++)for(var e=this.sprayChunks[b],g=0,f=e.length;f>g;g++){var h=new fabric.Rect({width:e[g].width,height:e[g].width,left:e[g].x+1,top:e[g].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&h.setShadow(this.shadow);c.push(h)}this.optimizeOverlapping&&(c=this._getOptimizedRects(c));c=new fabric.Group(c,{originX:"center",originY:"center"});c.canvas=this.canvas;this.canvas.add(c);this.canvas.fire("path:created",{path:c});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.renderAll()},_getOptimizedRects:function(d){for(var c,b={},a=0,e=d.length;e>a;a++)c=d[a].left+""+d[a].top,b[c]||(b[c]=d[a]);d=[];for(c in b)d.push(b[c]);return d},render:function(){var d=this.canvas.contextTop;d.fillStyle=this.color;var c=this.canvas.viewportTransform;d.save();d.transform(c[0],c[1],c[2],c[3],c[4],c[5]);for(var c=0,b=this.sprayChunkPoints.length;b>c;c++){var a=this.sprayChunkPoints[c];"undefined"!=typeof a.opacity&&(d.globalAlpha=
a.opacity);d.fillRect(a.x,a.y,a.width,a.width)}d.restore()},addSprayChunk:function(d){this.sprayChunkPoints=[];for(var c,b,a,e=this.width/2,g=0;g<this.density;g++)c=fabric.util.getRandomInt(d.x-e,d.x+e),b=fabric.util.getRandomInt(d.y-e,d.y+e),a=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,c=new fabric.Point(c,b),c.width=a,this.randomOpacity&&(c.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(c);
this.sprayChunks.push(this.sprayChunkPoints)}});
fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var d=fabric.document.createElement("canvas"),c=d.getContext("2d");return d.width=d.height=25,c.fillStyle=this.color,c.beginPath(),c.arc(10,10,10,0,2*Math.PI,!1),c.closePath(),c.fill(),d},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");
this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(d){d=this.callSuper("createPath",d);return d.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),d}});
(function(){var d=fabric.util.getPointer,c=fabric.util.degreesToRadians,b=fabric.util.radiansToDegrees,a=Math.atan2,e=Math.abs;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,b){b||(b={});this._initStatic(a,b);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",
selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);
this.calcOffset()},_resetCurrentTransform:function(){var a=this._currentTransform;a.target.set({scaleX:a.original.scaleX,scaleY:a.original.scaleY,skewX:a.original.skewX,skewY:a.original.skewY,left:a.original.left,top:a.original.top});this._shouldCenterTransform(a.target)?"rotate"===a.action?this._setOriginToCenter(a.target):("center"!==a.originX&&("right"===a.originX?a.mouseXSign=-1:a.mouseXSign=1),"center"!==a.originY&&("bottom"===a.originY?a.mouseYSign=-1:a.mouseYSign=1),a.originX="center",a.originY=
"center"):(a.originX=a.original.originX,a.originY=a.original.originY)},containsPoint:function(a,b){var c=this.getPointer(a,!0),e=this._normalizePointer(b,c);return b.containsPoint(e)||b._findTargetCorner(c)},_normalizePointer:function(a,b){var c,e=this.getActiveGroup(),d=b.x,g=b.y;return e&&"group"!==a.type&&e.contains(a)&&(c=fabric.util.transformPoint(e.getCenterPoint(),this.viewportTransform,!0),d-=c.x,g-=c.y,d/=e.scaleX,g/=e.scaleY),{x:d,y:g}},isTargetTransparent:function(a,b,c){var e=a.hasBorders,
d=a.transparentCorners;a.hasBorders=a.transparentCorners=!1;a.render(this.contextCache);a._renderControls(this.contextCache);a.hasBorders=e;a.transparentCorners=d;a=fabric.util.isTransparent(this.contextCache,b,c,this.targetFindTolerance);return this.clearContext(this.contextCache),a},_shouldClearSelection:function(a,b){var c=this.getActiveGroup(),e=this.getActiveObject();return!b||b&&c&&!c.contains(b)&&c!==b&&!a.shiftKey||b&&!b.evented||b&&!b.selectable&&e&&e!==b},_shouldCenterTransform:function(a){if(a){var b,
c=this._currentTransform;return"scale"===c.action||"scaleX"===c.action||"scaleY"===c.action?b=this.centeredScaling||a.centeredScaling:"rotate"===c.action&&(b=this.centeredRotation||a.centeredRotation),b?!c.altKey:c.altKey}},_getOriginFromCorner:function(a,b){var c={x:a.originX,y:a.originY};return"ml"===b||"tl"===b||"bl"===b?c.x="right":("mr"===b||"tr"===b||"br"===b)&&(c.x="left"),"tl"===b||"mt"===b||"tr"===b?c.y="bottom":("bl"===b||"mb"===b||"br"===b)&&(c.y="top"),c},_getActionFromCorner:function(a,
b,c){if(!b)return"drag";switch(b){case "mtr":return"rotate";case "ml":case "mr":return c.shiftKey?"skewY":"scaleX";case "mt":case "mb":return c.shiftKey?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(a,b){if(b){var e=this.getPointer(a),d=b._findTargetCorner(this.getPointer(a,!0)),g=this._getActionFromCorner(b,d,a),m=this._getOriginFromCorner(b,d);this._currentTransform={target:b,action:g,corner:d,scaleX:b.scaleX,scaleY:b.scaleY,skewX:b.skewX,skewY:b.skewY,offsetX:e.x-b.left,
offsetY:e.y-b.top,originX:m.x,originY:m.y,ex:e.x,ey:e.y,lastX:e.x,lastY:e.y,left:b.left,top:b.top,theta:c(b.angle),width:b.width*b.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:a.shiftKey,altKey:a.altKey};this._currentTransform.original={left:b.left,top:b.top,scaleX:b.scaleX,scaleY:b.scaleY,skewX:b.skewX,skewY:b.skewY,originX:m.x,originY:m.y};this._resetCurrentTransform()}},_translateObject:function(a,b){var c=this._currentTransform.target;c.get("lockMovementX")||c.set("left",a-this._currentTransform.offsetX);
c.get("lockMovementY")||c.set("top",b-this._currentTransform.offsetY)},_changeSkewTransformOrigin:function(a,b,c){var e="originX",d={0:"center"},g=b.target.skewX,n="left",u="right",x="mt"===b.corner||"ml"===b.corner?1:-1,y=1;a=0<a?1:-1;"y"===c&&(g=b.target.skewY,n="top",u="bottom",e="originY");d[-1]=n;d[1]=u;b.target.flipX&&(y*=-1);b.target.flipY&&(y*=-1);0===g?(b.skewSign=-x*a*y,b[e]=d[-a]):(g=0<g?1:-1,b.skewSign=g,b[e]=d[g*x*y])},_skewObject:function(a,b,c){var e=this._currentTransform,d=e.target,
g=d.get("lockSkewingX"),n=d.get("lockSkewingY");if(!(g&&"x"===c||n&&"y"===c)){var u,n=d.getCenterPoint();u=d.toLocalPoint(new fabric.Point(a,b),"center","center")[c];var x=d.toLocalPoint(new fabric.Point(e.lastX,e.lastY),"center","center")[c],g=d._getTransformedDimensions();this._changeSkewTransformOrigin(u-x,e,c);u=d.toLocalPoint(new fabric.Point(a,b),e.originX,e.originY)[c];n=d.translateToOriginPoint(n,e.originX,e.originY);this._setObjectSkew(u,e,c,g);e.lastX=a;e.lastY=b;d.setPositionByOrigin(n,
e.originX,e.originY)}},_setObjectSkew:function(a,b,c,e){var d,g,n,u,x,y,z,t=b.target;b=b.skewSign;"x"===c?(u="y",x="Y",y="X",n=0,z=t.skewY):(u="x",x="X",y="Y",n=t.skewX,z=0);n=t._getTransformedDimensions(n,z);a=2*Math.abs(a)-n[c];2>=a?d=0:(d=b*Math.atan(a/t["scale"+y]/(n[u]/t["scale"+x])),d=fabric.util.radiansToDegrees(d));t.set("skew"+y,d);0!==t["skew"+x]&&(g=t._getTransformedDimensions(),d=e[u]/g[u]*t["scale"+x],t.set("scale"+x,d))},_scaleObject:function(a,b,c){var e=this._currentTransform,d=e.target,
g=d.get("lockScalingX"),n=d.get("lockScalingY"),u=d.get("lockScalingFlip");if(!g||!n){var x=d.translateToOriginPoint(d.getCenterPoint(),e.originX,e.originY);a=d.toLocalPoint(new fabric.Point(a,b),e.originX,e.originY);b=d._getTransformedDimensions();this._setLocalMouse(a,e);this._setObjectScale(a,e,g,n,c,u,b);d.setPositionByOrigin(x,e.originX,e.originY)}},_setObjectScale:function(a,b,c,e,d,g,n){var u=b.target,x=!1,y=!1;b.newScaleX=a.x*u.scaleX/n.x;b.newScaleY=a.y*u.scaleY/n.y;g&&0>=b.newScaleX&&b.newScaleX<
u.scaleX&&(x=!0);g&&0>=b.newScaleY&&b.newScaleY<u.scaleY&&(y=!0);"equally"!==d||c||e?d?"x"!==d||u.get("lockUniScaling")?"y"!==d||u.get("lockUniScaling")||y||e||u.set("scaleY",b.newScaleY):x||c||u.set("scaleX",b.newScaleX):(x||c||u.set("scaleX",b.newScaleX),y||e||u.set("scaleY",b.newScaleY)):x||y||this._scaleObjectEqually(a,u,b,n);x||y||this._flipObject(b,d)},_scaleObjectEqually:function(a,b,c,e){a=a.y+a.x;e=e.y*c.original.scaleY/b.scaleY+e.x*c.original.scaleX/b.scaleX;c.newScaleX=c.original.scaleX*
a/e;c.newScaleY=c.original.scaleY*a/e;b.set("scaleX",c.newScaleX);b.set("scaleY",c.newScaleY)},_flipObject:function(a,b){0>a.newScaleX&&"y"!==b&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left"));0>a.newScaleY&&"x"!==b&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(a,b){var c=b.target;"right"===b.originX?a.x*=-1:"center"===b.originX&&(a.x=2*a.x*b.mouseXSign,0>a.x&&(b.mouseXSign=-b.mouseXSign));"bottom"===b.originY?
a.y*=-1:"center"===b.originY&&(a.y=2*a.y*b.mouseYSign,0>a.y&&(b.mouseYSign=-b.mouseYSign));e(a.x)>c.padding?0>a.x?a.x+=c.padding:a.x-=c.padding:a.x=0;e(a.y)>c.padding?0>a.y?a.y+=c.padding:a.y-=c.padding:a.y=0},_rotateObject:function(c,e){var d=this._currentTransform;if(!d.target.get("lockRotation")){var g=a(d.ey-d.top,d.ex-d.left),p=a(e-d.top,c-d.left),g=b(p-g+d.theta);0>g&&(g=360+g);d.target.angle=g%360}},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=
1;a.scaleY=1;a.skewX=0;a.skewY=0;a.setAngle(0)},_drawSelection:function(){var a=this.contextTop,b=this._groupSelector,c=b.left,d=b.top,g=e(c),m=e(d);(a.fillStyle=this.selectionColor,a.fillRect(b.ex-(0<c?0:-c),b.ey-(0<d?0:-d),g,m),a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,1<this.selectionDashArray.length)?(c=b.ex+.5-(0<c?0:g),b=b.ey+.5-(0<d?0:m),a.beginPath(),fabric.util.drawDashedLine(a,c,b,c+g,b,this.selectionDashArray),fabric.util.drawDashedLine(a,c,b+m-1,c+g,b+
m-1,this.selectionDashArray),fabric.util.drawDashedLine(a,c,b,c,b+m,this.selectionDashArray),fabric.util.drawDashedLine(a,c+g-1,b,c+g-1,b+m,this.selectionDashArray),a.closePath(),a.stroke()):a.strokeRect(b.ex+.5-(0<c?0:g),b.ey+.5-(0<d?0:m),g,m)},_isLastRenderedObject:function(a){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a,
!0))},findTarget:function(a,b){if(!this.skipTargetFind){if(this._isLastRenderedObject(a))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();if(c&&!b&&this.containsPoint(a,c))return c;c=this._searchPossibleTargets(a,b);return this._fireOverOutEvents(c,a),c}},_fireOverOutEvents:function(a,b){a?this._hoveredTarget!==a&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:b}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:a,e:b}),
a.fire("mouseover"),this._hoveredTarget=a):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:b}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(a,b,c){if(b&&b.visible&&b.evented&&this.containsPoint(a,b)&&(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing||!this.isTargetTransparent(b,c.x,c.y)))return!0},_searchPossibleTargets:function(a,b){for(var c,e=this.getPointer(a,!0),d=this._objects.length;d--;)if((!this._objects[d].group||
b)&&this._checkTarget(a,this._objects[d],e)){this.relatedTarget=this._objects[d];c=this._objects[d];break}return c},getPointer:function(a,b,c){c||(c=this.upperCanvasEl);var e;a=d(a);var g=c.getBoundingClientRect(),m=g.width||0,n=g.height||0;return m&&n||("top"in g&&"bottom"in g&&(n=Math.abs(g.top-g.bottom)),"right"in g&&"left"in g&&(m=Math.abs(g.right-g.left))),this.calcOffset(),a.x-=this._offset.left,a.y-=this._offset.top,b||(a=fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform))),
e=0===m||0===n?{width:1,height:1}:{width:c.width/m,height:c.height/n},{x:a.x*e.width,y:a.y*e.height}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},
_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},
_applyCanvasStyle:function(a){var b=this.getWidth()||a.width,c=this.getHeight()||a.height;fabric.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0});a.width=b;a.height=c;fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=
a;a.set("active",!0)},setActiveObject:function(a,b){return this._setActiveObject(a),this.renderAll(),this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(a){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:a}),this},_setActiveGroup:function(a){(this._activeGroup=
a)&&a.set("active",!0)},setActiveGroup:function(a,b){return this._setActiveGroup(a),a&&(this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy();this.setActiveGroup(null)},discardActiveGroup:function(a){return this._discardActiveGroup(),this.fire("selection:cleared",{e:a}),this},deactivateAll:function(){for(var a=this.getObjects(),b=0,c=a.length;c>b;b++)a[b].set("active",
!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(a){var b=this.getActiveGroup()||this.getActiveObject();return b&&this.fire("before:selection:cleared",{target:b,e:a}),this.deactivateAll(),b&&this.fire("selection:cleared",{e:a}),this},drawControls:function(a){var b=this.getActiveGroup();b?b._renderControls(a):this._drawObjectsControls(a)},_drawObjectsControls:function(a){for(var b=0,c=this._objects.length;c>b;++b)this._objects[b]&&this._objects[b].active&&
(this._objects[b]._renderControls(a),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[b])}});for(var g in fabric.StaticCanvas)"prototype"!==g&&(fabric.Canvas[g]=fabric.StaticCanvas[g]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas})();
(function(){var d={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},c=fabric.util.addListener,b=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),_initEventListeners:function(){this._bindEvents();c(fabric.window,"resize",this._onResize);c(this.upperCanvasEl,"mousedown",this._onMouseDown);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"mousewheel",this._onMouseWheel);
c(this.upperCanvasEl,"touchstart",this._onMouseDown);c(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);
this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){b(fabric.window,"resize",this._onResize);b(this.upperCanvasEl,"mousedown",
this._onMouseDown);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(this.upperCanvasEl,"mousewheel",this._onMouseWheel);b(this.upperCanvasEl,"touchstart",this._onMouseDown);b(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,
"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a,b){this.__onMouseWheel&&this.__onMouseWheel(a,b)},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&
this.__onLongPress(a,b)},_onMouseDown:function(a){this.__onMouseDown(a);c(fabric.document,"touchend",this._onMouseUp);c(fabric.document,"touchmove",this._onMouseMove);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(this.upperCanvasEl,"touchmove",this._onMouseMove);"touchstart"===a.type?b(this.upperCanvasEl,"mousedown",this._onMouseDown):(c(fabric.document,"mouseup",this._onMouseUp),c(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(a){if(this.__onMouseUp(a),b(fabric.document,
"mouseup",this._onMouseUp),b(fabric.document,"touchend",this._onMouseUp),b(fabric.document,"mousemove",this._onMouseMove),b(fabric.document,"touchmove",this._onMouseMove),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===a.type){var e=this;setTimeout(function(){c(e.upperCanvasEl,"mousedown",e._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},
_shouldRender:function(a,b){var c=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==c)||!a&&c||!a&&!c&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},__onMouseUp:function(a){var b;if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(a);this._currentTransform?(this._finalizeCurrentTransform(),b=this._currentTransform.target):b=this.findTarget(a,!0);var c=this._shouldRender(b,
this.getPointer(a));this._maybeGroupObjects(a);b&&(b.isMoving=!1);c&&this.renderAll();this._handleCursorAndEvent(a,b)},_handleCursorAndEvent:function(a,b){this._setCursorFromEvent(a,b);var c=this;setTimeout(function(){c._setCursorFromEvent(a,b)},50);this.fire("mouse:up",{target:b,e:a});b&&b.fire("mouseup",{e:a})},_finalizeCurrentTransform:function(){var a=this._currentTransform.target;a._scaling&&(a._scaling=!1);a.setCoords();this.stateful&&a.hasStateChanged()&&(this.fire("object:modified",{target:a}),
a.fire("modified"));this._restoreOriginXY(a)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null}},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0;this.discardActiveObject(a).renderAll();this.clipTo&&fabric.util.clipContext(this,
this.contextTop);var b=fabric.util.invertTransform(this.viewportTransform),b=fabric.util.transformPoint(this.getPointer(a,!0),b);this.freeDrawingBrush.onMouseDown(b);this.fire("mouse:down",{e:a});b=this.findTarget(a);"undefined"!=typeof b&&b.fire("mousedown",{e:a,target:b})},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=fabric.util.invertTransform(this.viewportTransform),b=fabric.util.transformPoint(this.getPointer(a,!0),b);this.freeDrawingBrush.onMouseMove(b)}this.setCursor(this.freeDrawingCursor);
this.fire("mouse:move",{e:a});b=this.findTarget(a);"undefined"!=typeof b&&b.fire("mousemove",{e:a,target:b})},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:a});var b=this.findTarget(a);"undefined"!=typeof b&&b.fire("mouseup",{e:a,target:b})},__onMouseDown:function(a){if(("which"in a?1===a.which:0===a.button)||fabric.isTouchSupported){if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(a);
if(!this._currentTransform){var b=this.findTarget(a),c=this.getPointer(a,!0);this._previousPointer=c;var f=this._shouldRender(b,c),d=this._shouldGroup(a,b);this._shouldClearSelection(a,b)?this._clearSelection(a,b,c):d&&(this._handleGrouping(a,b),b=this.getActiveGroup());b&&b.selectable&&(b.__corner||!d)&&(this._beforeTransform(a,b),this._setupCurrentTransform(a,b));f&&this.renderAll();this.fire("mouse:down",{target:b,e:a});b&&b.fire("mousedown",{e:a})}}},_beforeTransform:function(a,b){this.stateful&&
b.saveState();b._findTargetCorner(this.getPointer(a))&&this.onBeforeScaleRotate(b);b!==this.getActiveGroup()&&b!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(b,a))},_clearSelection:function(a,b,c){this.deactivateAllWithDispatch(a);b&&b.selectable?this.setActiveObject(b,a):this.selection&&(this._groupSelector={ex:c.x,ey:c.y,top:0,left:0})},_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;
var b=a.getCenterPoint();a.originX="center";a.originY="center";a.left=b.x;a.top=b.y;this._currentTransform.left=a.left;this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null},__onMouseMove:function(a){var b,c;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(a);
if(!("undefined"!=typeof a.touches&&1<a.touches.length)){var f=this._groupSelector;f?(c=this.getPointer(a,!0),f.left=c.x-f.ex,f.top=c.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(b=this.findTarget(a),!b||b&&!b.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(a,b));this.fire("mouse:move",{target:b,e:a});b&&b.fire("mousemove",{e:a})}},_transformObject:function(a){var b=this.getPointer(a),c=this._currentTransform;c.reset=!1;c.target.isMoving=!0;this._beforeScaleTransform(a,
c);this._performTransformAction(a,c,b);this.renderAll()},_performTransformAction:function(a,b,c){var f=c.x;c=c.y;var d=b.target,k=b.action;"rotate"===k?(this._rotateObject(f,c),this._fire("rotating",d,a)):"scale"===k?(this._onScale(a,b,f,c),this._fire("scaling",d,a)):"scaleX"===k?(this._scaleObject(f,c,"x"),this._fire("scaling",d,a)):"scaleY"===k?(this._scaleObject(f,c,"y"),this._fire("scaling",d,a)):"skewX"===k?(this._skewObject(f,c,"x"),this._fire("skewing",d,a)):"skewY"===k?(this._skewObject(f,
c,"y"),this._fire("skewing",d,a)):(this._translateObject(f,c),this._fire("moving",d,a),this.setCursor(this.moveCursor))},_fire:function(a,b,c){this.fire("object:"+a,{target:b,e:c});b.fire(a,{e:c})},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action){var c=this._shouldCenterTransform(b.target);(c&&("center"!==b.originX||"center"!==b.originY)||!c&&"center"===b.originX&&"center"===b.originY)&&(this._resetCurrentTransform(),b.reset=!0)}},_onScale:function(a,
b,c,f){!a.shiftKey&&!this.uniScaleTransform||b.target.get("lockUniScaling")?(b.reset||"scale"!==b.currentAction||this._resetCurrentTransform(),b.currentAction="scaleEqually",this._scaleObject(c,f,"equally")):(b.currentAction="scale",this._scaleObject(c,f))},_setCursorFromEvent:function(a,b){if(!b||!b.selectable)return this.setCursor(this.defaultCursor),!1;var c=this.getActiveGroup(),c=b._findTargetCorner&&(!c||!c.contains(b))&&b._findTargetCorner(this.getPointer(a,!0));return c?this._setCornerCursor(c,
b,a):this.setCursor(b.hoverCursor||this.hoverCursor),!0},_setCornerCursor:function(a,b,c){if(a in d)this.setCursor(this._getRotatedCornerCursor(a,b,c));else{if("mtr"!==a||!b.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(a,b,c){b=Math.round(b.getAngle()%360/45);return 0>b&&(b+=8),b+=d[a],c.shiftKey&&0===d[a]%2&&(b+=2),b%=8,this.cursorMap[b]}})})();
(function(){var d=Math.min,c=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(b,a){var c=this.getActiveObject();return b.shiftKey&&a&&a.selectable&&(this.getActiveGroup()||c&&c!==a)&&this.selection},_handleGrouping:function(b,a){(a!==this.getActiveGroup()||(a=this.findTarget(b,!0),a&&!a.isType("group")))&&(this.getActiveGroup()?this._updateActiveGroup(a,b):this._createActiveGroup(a,b),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(b,
a){var c=this.getActiveGroup();if(c.contains(b)){if(c.removeWithUpdate(b),b.set("active",!1),1===c.size())return this.discardActiveGroup(a),void this.setActiveObject(c.item(0))}else c.addWithUpdate(b);this.fire("selection:created",{target:c,e:a});c.set("active",!0)},_createActiveGroup:function(b,a){if(this._activeObject&&b!==this._activeObject){var c=this._createGroup(b);c.addWithUpdate();this.setActiveGroup(c);this._activeObject=null;this.fire("selection:created",{target:c,e:a})}b.set("active",!0)},
_createGroup:function(b){var a=this.getObjects();b=a.indexOf(this._activeObject)<a.indexOf(b)?[this._activeObject,b]:[b,this._activeObject];return new fabric.Group(b,{canvas:this})},_groupSelectedObjects:function(b){var a=this._collectObjects();1===a.length?this.setActiveObject(a[0],b):1<a.length&&(a=new fabric.Group(a.reverse(),{canvas:this}),a.addWithUpdate(),this.setActiveGroup(a,b),a.saveCoords(),this.fire("selection:created",{target:a}),this.renderAll())},_collectObjects:function(){for(var b,
a=[],e=this._groupSelector.ex,g=this._groupSelector.ey,f=e+this._groupSelector.left,h=g+this._groupSelector.top,k=new fabric.Point(d(e,f),d(g,h)),l=new fabric.Point(c(e,f),c(g,h)),e=e===f&&g===h,g=this._objects.length;g--&&(b=this._objects[g],!(b&&b.selectable&&b.visible&&(b.intersectsWithRect(k,l)||b.isContainedWithinRect(k,l)||b.containsPoint(k)||b.containsPoint(l))&&(b.set("active",!0),a.push(b),e))););return a},_maybeGroupObjects:function(b){this.selection&&this._groupSelector&&this._groupSelectedObjects(b);
(b=this.getActiveGroup())&&(b.setObjectsCoords().setCoords(),b.isMoving=!1,this.setCursor(this.defaultCursor));this._currentTransform=this._groupSelector=null}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(d){d||(d={});var c=d.format||"png",b=d.quality||1,a=d.multiplier||1;d={left:d.left,top:d.top,width:d.width,height:d.height};return 1!==a?this.__toDataURLWithMultiplier(c,b,d,a):this.__toDataURL(c,b,d)},__toDataURL:function(d,c,b){this.renderAll();var a=this.lowerCanvasEl;b=this.__getCroppedCanvas(a,b);"jpg"===d&&(d="jpeg");return fabric.StaticCanvas.supports("toDataURLWithQuality")?(b||a).toDataURL("image/"+d,c):(b||a).toDataURL("image/"+
d)},__getCroppedCanvas:function(d,c){var b,a;return("left"in c||"top"in c||"width"in c||"height"in c)&&(b=fabric.util.createCanvasElement(),a=b.getContext("2d"),b.width=c.width||this.width,b.height=c.height||this.height,a.drawImage(d,-c.left||0,-c.top||0)),b},__toDataURLWithMultiplier:function(d,c,b,a){var e=this.getWidth(),g=this.getHeight(),f=e*a,h=g*a,k=this.getActiveObject(),l=this.getActiveGroup(),p=this.contextContainer;1<a&&this.setWidth(f).setHeight(h);p.scale(a,a);b.left&&(b.left*=a);b.top&&
(b.top*=a);b.width?b.width*=a:1>a&&(b.width=f);b.height?b.height*=a:1>a&&(b.height=h);l?this._tempRemoveBordersControlsFromGroup(l):k&&this.deactivateAll&&this.deactivateAll();d=this.__toDataURL(d,c,b);return this.width=e,this.height=g,p.scale(1/a,1/a),this.setWidth(e).setHeight(g),l?this._restoreBordersControlsOnGroup(l):k&&this.setActiveObject&&this.setActiveObject(k),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),d},toDataURLWithMultiplier:function(d,c,b){return this.toDataURL({format:d,
multiplier:c,quality:b})},_tempRemoveBordersControlsFromGroup:function(d){d.origHasControls=d.hasControls;d.origBorderColor=d.borderColor;d.hasControls=!0;d.borderColor="rgba(0,0,0,0)";d.forEachObject(function(c){c.origBorderColor=c.borderColor;c.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(d){d.hideControls=d.origHideControls;d.borderColor=d.origBorderColor;d.forEachObject(function(c){c.borderColor=c.origBorderColor;delete c.origBorderColor})}});
fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(d,c,b){return this.loadFromJSON(d,c,b)},loadFromJSON:function(d,c,b){if(d){var a="string"==typeof d?JSON.parse(d):d;this.clear();var e=this;return this._enlivenObjects(a.objects,function(){e._setBgOverlay(a,c)},b),this}},_setBgOverlay:function(d,c){var b=this,a={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!(d.backgroundImage||d.overlayImage||d.background||d.overlay))return void(c&&
c());var e=function(){a.backgroundImage&&a.overlayImage&&a.backgroundColor&&a.overlayColor&&(b.renderAll(),c&&c())};this.__setBgOverlay("backgroundImage",d.backgroundImage,a,e);this.__setBgOverlay("overlayImage",d.overlayImage,a,e);this.__setBgOverlay("backgroundColor",d.background,a,e);this.__setBgOverlay("overlayColor",d.overlay,a,e);e()},__setBgOverlay:function(d,c,b,a){var e=this;return c?void("backgroundImage"===d||"overlayImage"===d?fabric.Image.fromObject(c,function(c){e[d]=c;b[d]=!0;a&&a()}):
this["set"+fabric.util.string.capitalize(d,!0)](c,function(){b[d]=!0;a&&a()})):void(b[d]=!0)},_enlivenObjects:function(d,c,b){var a=this;if(!d||0===d.length)return void(c&&c());var e=this.renderOnAddRemove;this.renderOnAddRemove=!1;fabric.util.enlivenObjects(d,function(b){b.forEach(function(b,c){a.insertAt(b,c,!0)});a.renderOnAddRemove=e;c&&c()},null,b)},_toDataURL:function(d,c){this.clone(function(b){c(b.toDataURL(d))})},_toDataURLWithMultiplier:function(d,c,b){this.clone(function(a){b(a.toDataURLWithMultiplier(d,
c))})},clone:function(d,c){var b=JSON.stringify(this.toJSON(c));this.cloneWithoutData(function(a){a.loadFromJSON(b,function(){d&&d(a)})})},cloneWithoutData:function(d){var c=fabric.document.createElement("canvas");c.width=this.getWidth();c.height=this.getHeight();var b=new fabric.Canvas(c);b.clipTo=this.clipTo;this.backgroundImage?(b.setBackgroundImage(this.backgroundImage.src,function(){b.renderAll();d&&d(b)}),b.backgroundImageOpacity=this.backgroundImageOpacity,b.backgroundImageStretch=this.backgroundImageStretch):
d&&d(b)}});
(function(d){var c=d.fabric||(d.fabric={});d=c.util.object.extend;var b=c.util.toFixed,a=c.util.string.capitalize,e=c.util.degreesToRadians,g=c.StaticCanvas.supports("setLineDash");c.Object||(c.Object=c.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,
centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,
lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor alignX alignY meetOrSlice skewX skewY".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(a){!a.fill||
!a.fill.colorStops||a.fill instanceof c.Gradient||this.set("fill",new c.Gradient(a.fill));!a.stroke||!a.stroke.colorStops||a.stroke instanceof c.Gradient||this.set("stroke",new c.Gradient(a.stroke))},_initPattern:function(a){!a.fill||!a.fill.source||a.fill instanceof c.Pattern||this.set("fill",new c.Pattern(a.fill));!a.stroke||!a.stroke.source||a.stroke instanceof c.Pattern||this.set("stroke",new c.Pattern(a.stroke))},_initClipping:function(a){a.clipTo&&"string"==typeof a.clipTo&&(a=c.util.getFunctionBody(a.clipTo),
"undefined"!=typeof a&&(this.clipTo=new Function("ctx",a)))},setOptions:function(a){for(var b in a)this.set(b,a[b]);this._initGradient(a);this._initPattern(a);this._initClipping(a)},transform:function(a,b){this.group&&this.canvas.preserveObjectStacking&&this.group===this.canvas._activeGroup&&this.group.transform(a);var c=b?this._getLeftTopCoords():this.getCenterPoint();a.translate(c.x,c.y);a.rotate(e(this.angle));a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1));a.transform(1,0,
Math.tan(e(this.skewX)),1,0,0);a.transform(1,Math.tan(e(this.skewY)),0,1,0,0)},toObject:function(a){var e=c.Object.NUM_FRACTION_DIGITS,e={type:this.type,originX:this.originX,originY:this.originY,left:b(this.left,e),top:b(this.top,e),width:b(this.width,e),height:b(this.height,e),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:b(this.strokeWidth,e),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():
this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:b(this.strokeMiterLimit,e),scaleX:b(this.scaleX,e),scaleY:b(this.scaleY,e),angle:b(this.getAngle(),e),flipX:this.flipX,flipY:this.flipY,opacity:b(this.opacity,e),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,
transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:b(this.skewX,e),skewY:b(this.skewY,e)};return this.includeDefaultValues||(e=this._removeDefaultValues(e)),c.util.populateWithProperties(this,e,a),e},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var b=c.util.getKlass(a.type).prototype;return b.stateProperties.forEach(function(c){a[c]===b[c]&&delete a[c];"[object Array]"===Object.prototype.toString.call(a[c])&&"[object Array]"===
Object.prototype.toString.call(b[c])&&0===a[c].length&&0===b[c].length&&delete a[c]}),a},toString:function(){return"#<fabric."+a(this.type)+">"},get:function(a){return this[a]},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,b){return"object"==typeof a?this._setObject(a):"function"==typeof b&&"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b),this},_set:function(a,e){return("scaleX"===a||"scaleY"===a)&&(e=this._constrainScale(e)),"scaleX"===a&&0>e?(this.flipX=!this.flipX,
e*=-1):"scaleY"===a&&0>e?(this.flipY=!this.flipY,e*=-1):"width"===a||"height"===a?this.minScaleLimit=b(Math.min(.1,1/Math.max(this.width,this.height)),2):"shadow"!==a||!e||e instanceof c.Shadow||(e=new c.Shadow(e)),this[a]=e,this},setOnGroup:function(){},toggle:function(a){var b=this.get(a);return"boolean"==typeof b&&this.set(a,!b),this},setSourcePath:function(a){return this.sourcePath=a,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:
[1,0,0,1,0,0]},render:function(a,b){0===this.width&&0===this.height||!this.visible||(a.save(),this._setupCompositeOperation(a),b||this.transform(a),this._setStrokeStyles(a),this._setFillStyles(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this._setOpacity(a),this._setShadow(a),this.clipTo&&c.util.clipContext(this,a),this._render(a,b),this.clipTo&&a.restore(),a.restore())},_setOpacity:function(a){this.group&&this.group._setOpacity(a);a.globalAlpha*=this.opacity},_setStrokeStyles:function(a){this.stroke&&
(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke)},_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill)},_renderControls:function(a,b){if(this.active&&!b){var d;d=this.getViewportTransform();var g=this.calcTransformMatrix(),g=c.util.multiplyTransformMatrices(d,g);d=c.util.qrDecompose(g);a.save();a.translate(d.translateX,
d.translateY);this.group&&this.group===this.canvas.getActiveGroup()?(a.rotate(e(d.angle)),this.drawBordersInGroup(a,d)):(a.rotate(e(this.angle)),this.drawBorders(a));this.drawControls(a);a.restore()}},_setShadow:function(a){if(this.shadow){var b=this.canvas&&this.canvas.viewportTransform[0]||1,c=this.canvas&&this.canvas.viewportTransform[3]||1;a.shadowColor=this.shadow.color;a.shadowBlur=this.shadow.blur*(b+c)*(this.scaleX+this.scaleY)/4;a.shadowOffsetX=this.shadow.offsetX*b*this.scaleX;a.shadowOffsetY=
this.shadow.offsetY*c*this.scaleY}},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_renderFill:function(a){this.fill&&((a.save(),this.fill.gradientTransform)&&a.transform.apply(a,this.fill.gradientTransform),this.fill.toLive&&a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore())},_renderStroke:function(a){this.stroke&&0!==this.strokeWidth&&((this.shadow&&
!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this.strokeDashArray)?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):(this.stroke.gradientTransform&&a.transform.apply(a,this.stroke.gradientTransform),this._stroke?this._stroke(a):a.stroke()),a.restore())},clone:function(a,b){return this.constructor.fromObject?
this.constructor.fromObject(this.toObject(b),a):new c.Object(this.toObject(b))},cloneAsImage:function(a){var b=this.toDataURL();return c.util.loadImage(b,function(b){a&&a(new c.Image(b))}),this},toDataURL:function(a){a||(a={});var b=c.util.createCanvasElement(),e=this.getBoundingRect();b.width=e.width;b.height=e.height;c.util.wrapElement(b,"div");e=new c.StaticCanvas(b);"jpg"===a.format&&(a.format="jpeg");"jpeg"===a.format&&(e.backgroundColor="#fff");var d={active:this.get("active"),left:this.getLeft(),
top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new c.Point(b.width/2,b.height/2),"center","center");b=this.canvas;e.add(this);a=e.toDataURL(a);return this.set(d).setCoords(),this.canvas=b,e.dispose(),a},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,b){b||(b={});var e={colorStops:[]};e.type=b.type||(b.r1||b.r2?"radial":"linear");e.coords={x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2};(b.r1||b.r2)&&(e.coords.r1=
b.r1,e.coords.r2=b.r2);b.gradientTransform&&(e.gradientTransform=b.gradientTransform);for(var d in b.colorStops){var g=new c.Color(b.colorStops[d]);e.colorStops.push({offset:d,color:g.toRgb(),opacity:g.getAlpha()})}return this.set(a,c.Gradient.forObject(this,e))},setPatternFill:function(a){return this.set("fill",new c.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new c.Shadow(a):null)},setColor:function(a){return this.set("fill",a),this},setAngle:function(a){var b=("center"!==this.originX||
"center"!==this.originY)&&this.centeredRotation;return b&&this._setOriginToCenter(),this.set("angle",a),b&&this._resetOrigin(),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(a,b){b=b||this.canvas.getPointer(a);var e=new c.Point(b.x,b.y),d=this._getLeftTopCoords();return this.angle&&
(e=c.util.rotatePoint(e,d,c.util.degreesToRadians(-this.angle))),{x:e.x-d.x,y:e.y-d.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(a.globalCompositeOperation=this.globalCompositeOperation)}}),c.util.createAccessors(c.Object),c.Object.prototype.rotate=c.Object.prototype.setAngle,d(c.Object.prototype,c.Observable),c.Object.NUM_FRACTION_DIGITS=2,c.Object.__uid=0)})("undefined"!=typeof exports?exports:this);
(function(){var d=fabric.util.degreesToRadians,c={left:-.5,center:0,right:.5},b={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(a,e,d,f,h){var k,l=a.x,p=a.y;e=c[f]-c[e];d=b[h]-b[d];return(e||d)&&(k=this._getTransformedDimensions(),l=a.x+e*k.x,p=a.y+d*k.y),new fabric.Point(l,p)},translateToCenterPoint:function(a,b,c){b=this.translateToGivenOrigin(a,b,c,"center","center");return this.angle?fabric.util.rotatePoint(b,a,d(this.angle)):b},
translateToOriginPoint:function(a,b,c){b=this.translateToGivenOrigin(a,"center","center",b,c);return this.angle?fabric.util.rotatePoint(b,a,d(this.angle)):b},getCenterPoint:function(){var a=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,b){var c=this.getCenterPoint();return this.translateToOriginPoint(c,a,b)},toLocalPoint:function(a,b,c){var f,h,k=this.getCenterPoint();return f=b&&c?this.translateToGivenOrigin(k,"center",
"center",b,c):new fabric.Point(this.left,this.top),h=new fabric.Point(a.x,a.y),this.angle&&(h=fabric.util.rotatePoint(h,k,-d(this.angle))),h.subtractEquals(f)},setPositionByOrigin:function(a,b,c){a=this.translateToCenterPoint(a,b,c);a=this.translateToOriginPoint(a,this.originX,this.originY);this.set("left",a.x);this.set("top",a.y)},adjustPosition:function(a){var b=d(this.angle),g=this.getWidth(),f=Math.sin(b)*g;this.left+=Math.cos(b)*g*(c[a]-c[this.originX]);this.top+=f*(c[a]-c[this.originX]);this.setCoords();
this.originX=a},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originY=this.originX="center";this.left=a.x;this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=a.x;this.top=a.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),
"left","top")}})})();
(function(){function d(a){return[new fabric.Point(a.tl.x,a.tl.y),new fabric.Point(a.tr.x,a.tr.y),new fabric.Point(a.br.x,a.br.y),new fabric.Point(a.bl.x,a.bl.y)]}var c=fabric.util.degreesToRadians,b=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(a,b){var c=d(this.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(c,a,b).status},intersectsWithObject:function(a){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(d(this.oCoords),
d(a.oCoords)).status},isContainedWithinObject:function(a){var b=a.getBoundingRect();a=new fabric.Point(b.left,b.top);b=new fabric.Point(b.left+b.width,b.top+b.height);return this.isContainedWithinRect(a,b)},isContainedWithinRect:function(a,b){var c=this.getBoundingRect();return c.left>=a.x&&c.left+c.width<=b.x&&c.top>=a.y&&c.top+c.height<=b.y},containsPoint:function(a){var b=this._getImageLines(this.oCoords);a=this._findCrossPoints(a,b);return 0!==a&&1===a%2},_getImageLines:function(a){return{topline:{o:a.tl,
d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,b){var c,d,h,k,l,p=0,m;for(m in b)if(l=b[m],!(l.o.y<a.y&&l.d.y<a.y||l.o.y>=a.y&&l.d.y>=a.y||(l.o.x===l.d.x&&l.o.x>=a.x?k=l.o.x:(c=(l.d.y-l.o.y)/(l.d.x-l.o.x),d=a.y-0*a.x,h=l.o.y-c*l.o.x,k=-(d-h)/(0-c)),k>=a.x&&(p+=1),2!==p)))break;return p},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){return this.oCoords||
this.setCoords(),fabric.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?0>a?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){return a=this._constrainScale(a),0>a&&(this.flipX=!this.flipX,this.flipY=!this.flipY,a*=-1),this.scaleX=a,this.scaleY=a,this.setCoords(),
this},scaleToWidth:function(a){var b=this.getBoundingRect().width/this.getWidth();return this.scale(a/this.width/b)},scaleToHeight:function(a){var b=this.getBoundingRect().height/this.getHeight();return this.scale(a/this.height/b)},setCoords:function(){var a=c(this.angle),b=this.getViewportTransform(),d=this._calculateCurrentDimensions(),f=d.x,h=d.y;0>f&&(f=Math.abs(f));var d=Math.sin(a),k=Math.cos(a),l=0<f?Math.atan(h/f):0,p=f/Math.cos(l)/2,m=Math.cos(l+a)*p,a=Math.sin(l+a)*p,l=fabric.util.transformPoint(this.getCenterPoint(),
b),b=new fabric.Point(l.x-m,l.y-a),f=new fabric.Point(b.x+f*k,b.y+f*d),h=new fabric.Point(b.x-h*d,b.y+h*k),m=new fabric.Point(l.x+m,l.y+a),a=new fabric.Point((b.x+h.x)/2,(b.y+h.y)/2),l=new fabric.Point((f.x+b.x)/2,(f.y+b.y)/2),p=new fabric.Point((m.x+f.x)/2,(m.y+f.y)/2),n=new fabric.Point((m.x+h.x)/2,(m.y+h.y)/2),d=new fabric.Point(l.x+d*this.rotatingPointOffset,l.y-k*this.rotatingPointOffset);return this.oCoords={tl:b,tr:f,br:m,bl:h,ml:a,mt:l,mr:p,mb:n,mtr:d},this._setCornerCoords&&this._setCornerCoords(),
this},_calcRotateMatrix:function(){if(this.angle){var a=c(this.angle),b=Math.cos(a),a=Math.sin(a);return[b,a,-a,b,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var a=this.getCenterPoint(),a=[1,0,0,1,a.x,a.y],c=this._calcRotateMatrix(),d=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),f=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0];return f=b(f,a),f=b(f,c),b(f,d)},_calcDimensionsTransformMatrix:function(a,e,d){a=[1,0,Math.tan(c(a)),1];e=[1,Math.tan(c(e)),0,1];d=
b([this.scaleX*(d&&this.flipX?-1:1),0,0,this.scaleY*(d&&this.flipY?-1:1)],a,!0);return b(d,e,!0)}})})();
fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(d){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,d):this.canvas.sendBackwards(this,d),this},bringForward:function(d){return this.group?
fabric.StaticCanvas.prototype.bringForward.call(this.group,this,d):this.canvas.bringForward(this,d),this},moveTo:function(d){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,d):this.canvas.moveTo(this,d),this}});
fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var d=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",c=this.fillRule,b=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",a=this.strokeWidth?this.strokeWidth:"0",e=this.strokeDashArray?this.strokeDashArray.join(" "):"none",g=this.strokeLineCap?this.strokeLineCap:"butt",f=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:
"4",k="undefined"!=typeof this.opacity?this.opacity:"1",l=this.visible?"":" visibility: hidden;",p=this.getSvgFilter();return["stroke: ",b,"; stroke-width: ",a,"; stroke-dasharray: ",e,"; stroke-linecap: ",g,"; stroke-linejoin: ",f,"; stroke-miterlimit: ",h,"; fill: ",d,"; fill-rule: ",c,"; opacity: ",k,";",p,l].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var d=
fabric.util.toFixed,c=this.getAngle(),b=this.getSkewX()%360,a=this.getSkewY()%360,e=this.getCenterPoint(),g=fabric.Object.NUM_FRACTION_DIGITS,e="path-group"===this.type?"":"translate("+d(e.x,g)+" "+d(e.y,g)+")",c=0!==c?" rotate("+d(c,g)+")":"",f=1===this.scaleX&&1===this.scaleY?"":" scale("+d(this.scaleX,g)+" "+d(this.scaleY,g)+")",b=0!==b?" skewX("+d(b,g)+")":"",d=0!==a?" skewY("+d(a,g)+")":"",a="path-group"===this.type?this.width:0,g="path-group"===this.type?this.height:0;return[e,c,f,this.flipX?
" matrix(-1 0 0 1 "+a+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+g+")":"",b,d].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var d=[];return this.fill&&this.fill.toLive&&d.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&d.push(this.stroke.toSVG(this,!1)),this.shadow&&d.push(this.shadow.toSVG(this)),d}});
fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(d){return this.get(d)!==this.originalState[d]},this)},saveState:function(d){return this.stateProperties.forEach(function(c){this.originalState[c]=this.get(c)},this),d&&d.stateProperties&&d.stateProperties.forEach(function(c){this.originalState[c]=this.get(c)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}});
(function(){var d=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(c){if(!this.hasControls||!this.active)return!1;var b,a,e=c.x;c=c.y;this.__corner=0;for(var d in this.oCoords)if(this.isControlVisible(d)&&("mtr"!==d||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==d&&"mr"!==d&&"mb"!==d&&"ml"!==d)&&(a=this._getImageLines(this.oCoords[d].corner),b=this._findCrossPoints({x:e,y:c},a),0!==b&&1===b%2))return this.__corner=
d,d;return!1},_setCornerCoords:function(){var c,b,a=this.oCoords;c=d(45-this.angle);b=.707106*this.cornerSize;var e=b*Math.cos(c),g=b*Math.sin(c),f;for(f in a)c=a[f].x,b=a[f].y,a[f].corner={tl:{x:c-g,y:b-e},tr:{x:c+e,y:b-g},bl:{x:c-e,y:b+g},br:{x:c+g,y:b+e}}},_getNonTransformedDimensions:function(){var c=this.strokeWidth,b=this.width,a=this.height,e=!0,d=!0;return"line"===this.type&&"butt"===this.strokeLineCap&&(d=b,e=a),d&&(a+=0>a?-c:c),e&&(b+=0>b?-c:c),{x:b,y:a}},_getTransformedDimensions:function(c,
b){"undefined"==typeof c&&(c=this.skewX);"undefined"==typeof b&&(b=this.skewY);var a,e,d=this._getNonTransformedDimensions();a=d.x/2;var d=d.y/2,d=[{x:-a,y:-d},{x:a,y:-d},{x:-a,y:d},{x:a,y:d}],f=this._calcDimensionsTransformMatrix(c,b,!1);for(a=0;a<d.length;a++)d[a]=fabric.util.transformPoint(d[a],f);return e=fabric.util.makeBoundingBoxFromPoints(d),{x:e.width,y:e.height}},_calculateCurrentDimensions:function(){var c=this.getViewportTransform(),b=this._getTransformedDimensions(),a=b.x,b=b.y;return a+=
2*this.padding,b+=2*this.padding,fabric.util.transformPoint(new fabric.Point(a,b),c,!0)},drawBorders:function(c){if(!this.hasBorders)return this;var b=this._calculateCurrentDimensions(),a=1/this.borderScaleFactor,e=b.x+a,b=b.y+a;if(c.save(),c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,c.strokeStyle=this.borderColor,c.lineWidth=a,c.strokeRect(-e/2,-b/2,e,b),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls)a=-b/2,c.beginPath(),c.moveTo(0,
a),c.lineTo(0,a-this.rotatingPointOffset),c.closePath(),c.stroke();return c.restore(),this},drawBordersInGroup:function(c,b){if(!this.hasBorders)return this;var a=this._getNonTransformedDimensions(),e=fabric.util.customTransformMatrix(b.scaleX,b.scaleY,b.skewX),d=fabric.util.transformPoint(a,e),a=1/this.borderScaleFactor,e=d.x+a+2*this.padding,d=d.y+a+2*this.padding;return c.save(),c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,c.strokeStyle=this.borderColor,c.lineWidth=a,c.strokeRect(-e/
2,-d/2,e,d),c.restore(),this},drawControls:function(c){if(!this.hasControls)return this;var b=this._calculateCurrentDimensions(),a=b.x,b=b.y,e=this.cornerSize,d=-(a+e)/2,e=-(b+e)/2,f=this.transparentCorners?"strokeRect":"fillRect";return c.save(),c.lineWidth=1,c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,c.strokeStyle=c.fillStyle=this.cornerColor,this._drawControl("tl",c,f,d,e),this._drawControl("tr",c,f,d+a,e),this._drawControl("bl",c,f,d,e+b),this._drawControl("br",c,f,d+a,e+b),this.get("lockUniScaling")||
(this._drawControl("mt",c,f,d+a/2,e),this._drawControl("mb",c,f,d+a/2,e+b),this._drawControl("mr",c,f,d+a,e+b/2),this._drawControl("ml",c,f,d,e+b/2)),this.hasRotatingPoint&&this._drawControl("mtr",c,f,d+a/2,e-this.rotatingPointOffset),c.restore(),this},_drawControl:function(c,b,a,e,d){this.isControlVisible(c)&&(c=this.cornerSize,"undefined"!=typeof G_vmlCanvasManager||this.transparentCorners||b.clearRect(e,d,c,c),b[a](e,d,c,c))},isControlVisible:function(c){return this._getControlsVisibility()[c]},
setControlVisible:function(c,b){return this._getControlsVisibility()[c]=b,this},setControlsVisibility:function(c){c||(c={});for(var b in c)this.setControlVisible(b,c[b]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(d,c){c=c||{};var b=function(){},a=c.onComplete||b,e=c.onChange||b,g=this;return fabric.util.animate({startValue:d.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(a){d.set("left",a);g.renderAll();e()},onComplete:function(){d.setCoords();a()}}),this},fxCenterObjectV:function(d,c){c=c||{};var b=function(){},a=c.onComplete||b,e=c.onChange||b,g=this;return fabric.util.animate({startValue:d.get("top"),
endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(a){d.set("top",a);g.renderAll();e()},onComplete:function(){d.setCoords();a()}}),this},fxRemove:function(d,c){c=c||{};var b=function(){},a=c.onComplete||b,e=c.onChange||b,g=this;return fabric.util.animate({startValue:d.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){d.set("active",!1)},onChange:function(a){d.set("opacity",a);g.renderAll();e()},onComplete:function(){g.remove(d);a()}}),this}});
fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var d,c,b=[];for(d in arguments[0])b.push(d);for(var a=0,e=b.length;e>a;a++)d=b[a],c=a!==e-1,this._animate(d,arguments[0][d],arguments[1],c)}else this._animate.apply(this,arguments);return this},_animate:function(d,c,b,a){var e,g=this;c=c.toString();b=b?fabric.util.object.clone(b):{};~d.indexOf(".")&&(e=d.split("."));var f=e?this.get(e[0])[e[1]]:this.get(d);"from"in b||(b.from=f);
c=~c.indexOf("=")?f+parseFloat(c.replace("=","")):parseFloat(c);fabric.util.animate({startValue:b.from,endValue:c,byValue:b.by,easing:b.easing,duration:b.duration,abort:b.abort&&function(){return b.abort.call(g)},onChange:function(c){e?g[e[0]][e[1]]=c:g.set(d,c);a||b.onChange&&b.onChange()},onComplete:function(){a||(g.setCoords(),b.onComplete&&b.onComplete())}})}});
(function(d){function c(a,b){var c=a.origin,e=a.axis1,d=a.axis2,g=a.dimension,n=b.nearest,u=b.center,x=b.farthest;return function(){switch(this.get(c)){case n:return Math.min(this.get(e),this.get(d));case u:return Math.min(this.get(e),this.get(d))+.5*this.get(g);case x:return Math.max(this.get(e),this.get(d))}}}var b=d.fabric||(d.fabric={}),a=b.util.object.extend,e={x1:1,x2:1,y1:1,y2:1},g=b.StaticCanvas.supports("setLineDash");return b.Line?void b.warn("fabric.Line is already defined"):(b.Line=b.util.createClass(b.Object,
{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{};a||(a=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,b){return this.callSuper("_set",a,b),"undefined"!=
typeof e[a]&&this._setWidthHeight(),this},_getLeftToOriginX:c({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:c({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,b){if(a.beginPath(),b){var c=this.getCenterPoint();a.translate(c.x-this.strokeWidth/2,c.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&g)c=this.calcLinePoints(),
a.moveTo(c.x1,c.y1),a.lineTo(c.x2,c.y2);a.lineWidth=this.strokeWidth;c=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=c},_renderDashedStroke:function(a){var c=this.calcLinePoints();a.beginPath();b.util.drawDashedLine(a,c.x1,c.y1,c.x2,c.y2,this.strokeDashArray);a.closePath()},toObject:function(b){return a(this.callSuper("toObject",b),this.calcLinePoints())},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=this.y2?-1:1;return{x1:a*
this.width*.5,x2:a*this.width*-.5,y1:b*this.height*.5,y2:b*this.height*-.5}},toSVG:function(a){var b=this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(c=this.calcLinePoints()),b.push("<line ",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},complexity:function(){return 1}}),b.Line.ATTRIBUTE_NAMES=
b.SHARED_ATTRIBUTES.concat(["x1","y1","x2","y2"]),b.Line.fromElement=function(c,e){var d=b.parseAttributes(c,b.Line.ATTRIBUTE_NAMES);return new b.Line([d.x1||0,d.y1||0,d.x2||0,d.y2||0],a(d,e))},void(b.Line.fromObject=function(a){return new b.Line([a.x1,a.y1,a.x2,a.y2],a)}))})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=Math.PI,a=c.util.object.extend;return c.Circle?void c.warn("fabric.Circle is already defined."):(c.Circle=c.util.createClass(c.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*b,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0);this.startAngle=a.startAngle||this.startAngle;this.endAngle=a.endAngle||this.endAngle},_set:function(a,b){return this.callSuper("_set",a,b),"radius"===a&&this.setRadius(b),this},toObject:function(b){return a(this.callSuper("toObject",
b),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(a){var c=this._createBaseSVGMarkup(),d=0,h=0,k=(this.endAngle-this.startAngle)%(2*b);0===k?(this.group&&"path-group"===this.group.type&&(d=this.left+this.radius,h=this.top+this.radius),c.push("<circle ",'cx="'+d+'" cy="'+h+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')):c.push('<path d="M '+Math.cos(this.startAngle)*
this.radius+" "+Math.sin(this.startAngle)*this.radius," A "+this.radius+" "+this.radius," 0 ",+(k>b?1:0)+" 1"," "+Math.cos(this.endAngle)*this.radius+" "+Math.sin(this.endAngle)*this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(c.join("")):c.join("")},_render:function(a,b){a.beginPath();a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(a);this._renderStroke(a)},
getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){return this.radius=a,this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),c.Circle.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),c.Circle.fromElement=function(b,d){d||(d={});var f=c.parseAttributes(b,c.Circle.ATTRIBUTE_NAMES);if(!("radius"in f&&0<=f.radius))throw Error("value of `r` attribute is required and can not be negative");
f.left=f.left||0;f.top=f.top||0;f=new c.Circle(a(f,d));return f.left-=f.radius,f.top-=f.radius,f},void(c.Circle.fromObject=function(a){return new c.Circle(a)}))})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={});return c.Triangle?void c.warn("fabric.Triangle is already defined"):(c.Triangle=c.util.createClass(c.Object,{type:"triangle",initialize:function(b){b=b||{};this.callSuper("initialize",b);this.set("width",b.width||100).set("height",b.height||100)},_render:function(b){var a=this.width/2,c=this.height/2;b.beginPath();b.moveTo(-a,c);b.lineTo(0,-c);b.lineTo(a,c);b.closePath();this._renderFill(b);this._renderStroke(b)},_renderDashedStroke:function(b){var a=this.width/
2,e=this.height/2;b.beginPath();c.util.drawDashedLine(b,-a,e,0,-e,this.strokeDashArray);c.util.drawDashedLine(b,0,-e,a,e,this.strokeDashArray);c.util.drawDashedLine(b,a,e,-a,e,this.strokeDashArray);b.closePath()},toSVG:function(b){var a=this._createBaseSVGMarkup(),c=this.width/2,d=this.height/2,c=[-c+" "+d,"0 "+-d,c+" "+d].join();return a.push("<polygon ",'points="',c,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),b?b(a.join("")):a.join("")},complexity:function(){return 1}}),
void(c.Triangle.fromObject=function(b){return new c.Triangle(b)}))})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=2*Math.PI,a=c.util.object.extend;return c.Ellipse?void c.warn("fabric.Ellipse is already defined."):(c.Ellipse=c.util.createClass(c.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0)},_set:function(a,b){switch(this.callSuper("_set",a,b),a){case "rx":this.rx=b;this.set("width",2*b);break;case "ry":this.ry=b,this.set("height",2*b)}return this},getRx:function(){return this.get("rx")*
this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(b){return a(this.callSuper("toObject",b),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,d=0;return this.group&&"path-group"===this.group.type&&(c=this.left+this.rx,d=this.top+this.ry),b.push("<ellipse ",'cx="',c,'" cy="',d,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),
'"/>\n'),a?a(b.join("")):b.join("")},_render:function(a,c){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(c?this.left+this.rx:0,c?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,b,!1);a.restore();this._renderFill(a);this._renderStroke(a)},complexity:function(){return 1}}),c.Ellipse.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),c.Ellipse.fromElement=function(b,d){d||(d={});var f=c.parseAttributes(b,c.Ellipse.ATTRIBUTE_NAMES);f.left=f.left||0;f.top=f.top||0;f=
new c.Ellipse(a(f,d));return f.top-=f.ry,f.left-=f.rx,f},void(c.Ellipse.fromObject=function(a){return new c.Ellipse(a)}))})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;if(c.Rect)return void c.warn("fabric.Rect is already defined");d=c.Object.prototype.stateProperties.concat();d.push("rx","ry","x","y");c.Rect=c.util.createClass(c.Object,{stateProperties:d,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(a){a=a||{};this.callSuper("initialize",a);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a,b){if(1===this.width&&
1===this.height)return void a.fillRect(0,0,1,1);var c=this.rx?Math.min(this.rx,this.width/2):0,d=this.ry?Math.min(this.ry,this.height/2):0,h=this.width,k=this.height,l=b?this.left:-this.width/2,p=b?this.top:-this.height/2,m=0!==c||0!==d;a.beginPath();a.moveTo(l+c,p);a.lineTo(l+h-c,p);m&&a.bezierCurveTo(l+h-.4477152502*c,p,l+h,p+.4477152502*d,l+h,p+d);a.lineTo(l+h,p+k-d);m&&a.bezierCurveTo(l+h,p+k-.4477152502*d,l+h-.4477152502*c,p+k,l+h-c,p+k);a.lineTo(l+c,p+k);m&&a.bezierCurveTo(l+.4477152502*c,p+
k,l,p+k-.4477152502*d,l,p+k-d);a.lineTo(l,p+d);m&&a.bezierCurveTo(l,p+.4477152502*d,l+.4477152502*c,p,l+c,p);a.closePath();this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(a){var b=-this.width/2,d=-this.height/2,f=this.width,h=this.height;a.beginPath();c.util.drawDashedLine(a,b,d,b+f,d,this.strokeDashArray);c.util.drawDashedLine(a,b+f,d,b+f,d+h,this.strokeDashArray);c.util.drawDashedLine(a,b+f,d+h,b,d+h,this.strokeDashArray);c.util.drawDashedLine(a,b,d+h,b,d,this.strokeDashArray);
a.closePath()},toObject:function(a){a=b(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0});return this.includeDefaultValues||this._removeDefaultValues(a),a},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this.left,d=this.top;return this.group&&"path-group"===this.group.type||(c=-this.width/2,d=-this.height/2),b.push("<rect ",'x="',c,'" y="',d,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),
'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},complexity:function(){return 1}});c.Rect.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" "));c.Rect.fromElement=function(a,d){if(!a)return null;d=d||{};var g=c.parseAttributes(a,c.Rect.ATTRIBUTE_NAMES);g.left=g.left||0;g.top=g.top||0;g=new c.Rect(b(d?c.util.object.clone(d):{},g));return g.visible=0<g.width&&0<g.height,g};c.Rect.fromObject=function(a){return new c.Rect(a)}})("undefined"!=
typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={});return c.Polyline?void c.warn("fabric.Polyline is already defined"):(c.Polyline=c.util.createClass(c.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(b,a){return c.Polygon.prototype.initialize.call(this,b,a)},_calcDimensions:function(){return c.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return c.Polygon.prototype._applyPointOffset.call(this)},toObject:function(b){return c.Polygon.prototype.toObject.call(this,b)},
toSVG:function(b){return c.Polygon.prototype.toSVG.call(this,b)},_render:function(b){c.Polygon.prototype.commonRender.call(this,b)&&(this._renderFill(b),this._renderStroke(b))},_renderDashedStroke:function(b){var a,d;b.beginPath();for(var g=0,f=this.points.length;f>g;g++)a=this.points[g],d=this.points[g+1]||a,c.util.drawDashedLine(b,a.x,a.y,d.x,d.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),c.Polyline.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polyline.fromElement=
function(b,a){if(!b)return null;a||(a={});var d=c.parsePointsAttribute(b.getAttribute("points")),g=c.parseAttributes(b,c.Polyline.ATTRIBUTE_NAMES);return new c.Polyline(d,c.util.object.extend(g,a))},void(c.Polyline.fromObject=function(b){return new c.Polyline(b.points,b,!0)}))})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend,a=c.util.array.min,e=c.util.array.max,g=c.util.toFixed;return c.Polygon?void c.warn("fabric.Polygon is already defined"):(c.Polygon=c.util.createClass(c.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.points=a||[];this.callSuper("initialize",b);this._calcDimensions();"top"in b||(this.top=this.minY);"left"in b||(this.left=this.minX)},_calcDimensions:function(){var b=this.points,c=a(b,"x"),d=a(b,
"y"),g=e(b,"x"),b=e(b,"y");this.width=g-c||0;this.height=b-d||0;this.minX=c||0;this.minY=d||0},_applyPointOffset:function(){this.points.forEach(function(a){a.x-=this.minX+this.width/2;a.y-=this.minY+this.height/2},this)},toObject:function(a){return b(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d=0,e=this.points.length;e>d;d++)b.push(g(this.points[d].x,2),",",g(this.points[d].y,2)," ");return c.push("<",this.type," ",'points="',
b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),a?a(c.join("")):c.join("")},_render:function(a){this.commonRender(a)&&(this._renderFill(a),(this.stroke||this.strokeDashArray)&&(a.closePath(),this._renderStroke(a)))},commonRender:function(a){var b,c=this.points.length;if(!c||isNaN(this.points[c-1].y))return!1;a.beginPath();this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=
null);a.moveTo(this.points[0].x,this.points[0].y);for(var d=0;c>d;d++)b=this.points[d],a.lineTo(b.x,b.y);return!0},_renderDashedStroke:function(a){c.Polyline.prototype._renderDashedStroke.call(this,a);a.closePath()},complexity:function(){return this.points.length}}),c.Polygon.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polygon.fromElement=function(a,d){if(!a)return null;d||(d={});var e=c.parsePointsAttribute(a.getAttribute("points")),g=c.parseAttributes(a,c.Polygon.ATTRIBUTE_NAMES);return new c.Polygon(e,
b(g,d))},void(c.Polygon.fromObject=function(a){return new c.Polygon(a.points,a,!0)}))})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.array.min,a=c.util.array.max,e=c.util.object.extend,g=Object.prototype.toString,f=c.util.drawArc,h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},k={m:"l",M:"L"};return c.Path?void c.warn("fabric.Path is already defined"):(c.Path=c.util.createClass(c.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.setOptions(b);a||(a=[]);var c="[object Array]"===g.call(a);(this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))&&
(c||(this.path=this._parsePath()),this._setPositionDimensions(b),b.sourcePath&&this.setSourcePath(b.sourcePath))},_setPositionDimensions:function(a){var b=this._parseDimensions();this.minX=b.left;this.minY=b.top;this.width=b.width;this.height=b.height;"undefined"==typeof a.left&&(this.left=b.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0));"undefined"==typeof a.top&&(this.top=b.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0));this.pathOffset=
this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(a){var b,c,d,e=null,g=0,h=0,k=0,t=0,r=0,v=0,q=-this.pathOffset.x,w=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(q=0,w=0);a.beginPath();for(var A=0,B=this.path.length;B>A;++A){switch(b=this.path[A],b[0]){case "l":k+=b[1];t+=b[2];a.lineTo(k+q,t+w);break;case "L":k=b[1];t=b[2];a.lineTo(k+q,t+w);break;case "h":k+=b[1];a.lineTo(k+q,t+w);break;case "H":k=b[1];a.lineTo(k+q,t+w);break;case "v":t+=b[1];
a.lineTo(k+q,t+w);break;case "V":t=b[1];a.lineTo(k+q,t+w);break;case "m":k+=b[1];t+=b[2];g=k;h=t;a.moveTo(k+q,t+w);break;case "M":k=b[1];t=b[2];g=k;h=t;a.moveTo(k+q,t+w);break;case "c":c=k+b[5];d=t+b[6];r=k+b[3];v=t+b[4];a.bezierCurveTo(k+b[1]+q,t+b[2]+w,r+q,v+w,c+q,d+w);k=c;t=d;break;case "C":k=b[5];t=b[6];r=b[3];v=b[4];a.bezierCurveTo(b[1]+q,b[2]+w,r+q,v+w,k+q,t+w);break;case "s":c=k+b[3];d=t+b[4];null===e[0].match(/[CcSs]/)?(r=k,v=t):(r=2*k-r,v=2*t-v);a.bezierCurveTo(r+q,v+w,k+b[1]+q,t+b[2]+w,
c+q,d+w);r=k+b[1];v=t+b[2];k=c;t=d;break;case "S":c=b[3];d=b[4];null===e[0].match(/[CcSs]/)?(r=k,v=t):(r=2*k-r,v=2*t-v);a.bezierCurveTo(r+q,v+w,b[1]+q,b[2]+w,c+q,d+w);k=c;t=d;r=b[1];v=b[2];break;case "q":c=k+b[3];d=t+b[4];r=k+b[1];v=t+b[2];a.quadraticCurveTo(r+q,v+w,c+q,d+w);k=c;t=d;break;case "Q":c=b[3];d=b[4];a.quadraticCurveTo(b[1]+q,b[2]+w,c+q,d+w);k=c;t=d;r=b[1];v=b[2];break;case "t":c=k+b[1];d=t+b[2];null===e[0].match(/[QqTt]/)?(r=k,v=t):(r=2*k-r,v=2*t-v);a.quadraticCurveTo(r+q,v+w,c+q,d+w);
k=c;t=d;break;case "T":c=b[1];d=b[2];null===e[0].match(/[QqTt]/)?(r=k,v=t):(r=2*k-r,v=2*t-v);a.quadraticCurveTo(r+q,v+w,c+q,d+w);k=c;t=d;break;case "a":f(a,k+q,t+w,[b[1],b[2],b[3],b[4],b[5],b[6]+k+q,b[7]+t+w]);k+=b[6];t+=b[7];break;case "A":f(a,k+q,t+w,[b[1],b[2],b[3],b[4],b[5],b[6]+q,b[7]+w]);k=b[6];t=b[7];break;case "z":case "Z":k=g,t=h,a.closePath()}e=b}this._renderFill(a);this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+
this.left+" }>"},toObject:function(a){a=e(this.callSuper("toObject",a),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(a.sourcePath=this.sourcePath),this.transformMatrix&&(a.transformMatrix=this.transformMatrix),a},toDatalessObject:function(a){a=this.toObject(a);return this.sourcePath&&(a.path=this.sourcePath),delete a.sourcePath,a},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d="",e=0,f=this.path.length;f>e;e++)b.push(this.path[e].join(" "));
b=b.join(" ");return this.group&&"path-group"===this.group.type||(d=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),c.push("<path ",'d="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),d,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a,b,c,d=[],e=[],f=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,g=0,z=this.path.length;z>g;g++){a=
this.path[g];c=a.slice(1).trim();for(e.length=0;b=f.exec(c);)e.push(b[0]);a=[a.charAt(0)];c=0;for(var t=e.length;t>c;c++)b=parseFloat(e[c]),isNaN(b)||a.push(b);b=a[0];c=h[b.toLowerCase()];t=k[b]||b;if(a.length-1>c)for(var r=1,v=a.length;v>r;r+=c)d.push([b].concat(a.slice(r,r+c))),b=t;else d.push(a)}return d},_parseDimensions:function(){for(var d,e,f,g,h=[],k=[],y=null,z=0,t=0,r=0,v=0,q=0,w=0,A=0,B=this.path.length;B>A;++A){switch(d=this.path[A],d[0]){case "l":r+=d[1];v+=d[2];g=[];break;case "L":r=
d[1];v=d[2];g=[];break;case "h":r+=d[1];g=[];break;case "H":r=d[1];g=[];break;case "v":v+=d[1];g=[];break;case "V":v=d[1];g=[];break;case "m":r+=d[1];v+=d[2];z=r;t=v;g=[];break;case "M":r=d[1];v=d[2];z=r;t=v;g=[];break;case "c":e=r+d[5];f=v+d[6];q=r+d[3];w=v+d[4];g=c.util.getBoundsOfCurve(r,v,r+d[1],v+d[2],q,w,e,f);r=e;v=f;break;case "C":r=d[5];v=d[6];q=d[3];w=d[4];g=c.util.getBoundsOfCurve(r,v,d[1],d[2],q,w,r,v);break;case "s":e=r+d[3];f=v+d[4];null===y[0].match(/[CcSs]/)?(q=r,w=v):(q=2*r-q,w=2*
v-w);g=c.util.getBoundsOfCurve(r,v,q,w,r+d[1],v+d[2],e,f);q=r+d[1];w=v+d[2];r=e;v=f;break;case "S":e=d[3];f=d[4];null===y[0].match(/[CcSs]/)?(q=r,w=v):(q=2*r-q,w=2*v-w);g=c.util.getBoundsOfCurve(r,v,q,w,d[1],d[2],e,f);r=e;v=f;q=d[1];w=d[2];break;case "q":e=r+d[3];f=v+d[4];q=r+d[1];w=v+d[2];g=c.util.getBoundsOfCurve(r,v,q,w,q,w,e,f);r=e;v=f;break;case "Q":q=d[1];w=d[2];g=c.util.getBoundsOfCurve(r,v,q,w,q,w,d[3],d[4]);r=d[3];v=d[4];break;case "t":e=r+d[1];f=v+d[2];null===y[0].match(/[QqTt]/)?(q=r,w=
v):(q=2*r-q,w=2*v-w);g=c.util.getBoundsOfCurve(r,v,q,w,q,w,e,f);r=e;v=f;break;case "T":e=d[1];f=d[2];null===y[0].match(/[QqTt]/)?(q=r,w=v):(q=2*r-q,w=2*v-w);g=c.util.getBoundsOfCurve(r,v,q,w,q,w,e,f);r=e;v=f;break;case "a":g=c.util.getBoundsOfArc(r,v,d[1],d[2],d[3],d[4],d[5],d[6]+r,d[7]+v);r+=d[6];v+=d[7];break;case "A":g=c.util.getBoundsOfArc(r,v,d[1],d[2],d[3],d[4],d[5],d[6],d[7]);r=d[6];v=d[7];break;case "z":case "Z":r=z,v=t}y=d;g.forEach(function(a){h.push(a.x);k.push(a.y)});h.push(r);k.push(v)}d=
b(h)||0;e=b(k)||0;f=a(h)||0;g=a(k)||0;return{left:d,top:e,width:f-d,height:g-e}}}),c.Path.fromObject=function(a,b){"string"==typeof a.path?c.loadSVGFromURL(a.path,function(d){d=d[0];var e=a.path;delete a.path;c.util.object.extend(d,a);d.setSourcePath(e);b(d)}):b(new c.Path(a.path,a))},c.Path.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["d"]),c.Path.fromElement=function(a,b,d){a=c.parseAttributes(a,c.Path.ATTRIBUTE_NAMES);b&&b(new c.Path(a.d,e(a,d)))},void(c.Path.async=!0))})("undefined"!=typeof exports?
exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend,a=c.util.array.invoke,e=c.Object.prototype.toObject;return c.PathGroup?void c.warn("fabric.PathGroup is already defined"):(c.PathGroup=c.util.createClass(c.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{};this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;b.toBeParsed&&(this.parseDimensionsFromPaths(b),delete b.toBeParsed);this.setOptions(b);this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},parseDimensionsFromPaths:function(a){for(var b,
d,e,l=[],p=[],m=this.paths.length;m--;){b=this.paths[m];d=b.height+b.strokeWidth;e=b.width+b.strokeWidth;b=[{x:b.left,y:b.top},{x:b.left+e,y:b.top},{x:b.left,y:b.top+d},{x:b.left+e,y:b.top+d}];e=this.paths[m].transformMatrix;for(var n=0;n<b.length;n++)d=b[n],e&&(d=c.util.transformPoint(d,e,!1)),l.push(d.x),p.push(d.y)}a.width=Math.max.apply(null,l);a.height=Math.max.apply(null,p)},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,this.transformMatrix);this.transform(a);
this._setShadow(a);this.clipTo&&c.util.clipContext(this,a);a.translate(-this.width/2,-this.height/2);for(var b=0,d=this.paths.length;d>b;++b)this.paths[b].render(a,!0);this.clipTo&&a.restore();a.restore()}},_set:function(a,b){if("fill"===a&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(c){c=b(e.call(this,c),{paths:a(this.getObjects(),"toObject",c)});return this.sourcePath&&(c.sourcePath=this.sourcePath),c},toDatalessObject:function(a){a=
this.toObject(a);return this.sourcePath&&(a.paths=this.sourcePath),a},toSVG:function(a){var b=this.getObjects(),c=this.getPointByOrigin("left","top"),d="translate("+c.x+" "+c.y+")",c=this._createBaseSVGMarkup();c.push("<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),d,this.getSvgTransform(),'" ',">\n");for(var d=0,e=b.length;e>d;d++)c.push("\t",b[d].toSVG(a));return c.push("</g>\n"),a?a(c.join("")):c.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+
"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=this.getObjects()[0].get("fill")||"";return"string"!=typeof a?!1:(a=a.toLowerCase(),this.getObjects().every(function(b){b=b.get("fill")||"";return"string"==typeof b&&b.toLowerCase()===a}))},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),c.PathGroup.fromObject=function(a,b){"string"==typeof a.paths?c.loadSVGFromURL(a.paths,
function(d){var e=a.paths;delete a.paths;d=c.util.groupSVGElements(d,a,e);b(d)}):c.util.enlivenObjects(a.paths,function(d){delete a.paths;b(new c.PathGroup(d,a))})},void(c.PathGroup.async=!0))})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend,a=c.util.array.min,e=c.util.array.max,g=c.util.array.invoke;if(!c.Group){var f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};c.Group=c.util.createClass(c.Object,c.Collection,{type:"group",strokeWidth:0,initialize:function(a,b,c){b=b||{};this._objects=[];c&&this.callSuper("initialize",b);this._objects=a||[];for(a=this._objects.length;a--;)this._objects[a].group=this;this.originalState=
{};b.originX&&(this.originX=b.originX);b.originY&&(this.originY=b.originY);c?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",b));this.setCoords();this.saveCoords()},_updateObjectsCoords:function(a){for(var b=this._objects.length;b--;)this._updateObjectCoords(this._objects[b],a)},_updateObjectCoords:function(a,b){if(a.__origHasControls=a.hasControls,a.hasControls=!1,!b){var c=a.getLeft(),d=a.getTop(),e=this.getCenterPoint();a.set({originalLeft:c,
originalTop:d,left:c-e.x,top:d-e.y});a.setCoords()}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){return this._restoreObjectsState(),c.util.resetObjectTransform(this),a&&(this._objects.push(a),a.group=this,a._set("canvas",this.canvas)),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){return this._restoreObjectsState(),
c.util.resetObjectTransform(this),this.forEachObject(this._setObjectActive,this),this.remove(a),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(a){a.group=this;a._set("canvas",this.canvas)},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){var c=this._objects.length;
if(this.delegatedProperties[a]||"canvas"===a)for(;c--;)this._objects[c].set(a,b);else for(;c--;)this._objects[c].setOnGroup(a,b);this.callSuper("_set",a,b)},toObject:function(a){return b(this.callSuper("toObject",a),{objects:g(this._objects,"toObject",a)})},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,this.transformMatrix);this.transform(a);this._setShadow(a);this.clipTo&&c.util.clipContext(this,a);for(var b=0,d=this._objects.length;d>b;b++)this._renderObject(this._objects[b],
a);this.clipTo&&a.restore();a.restore()}},_renderControls:function(a,b){this.callSuper("_renderControls",a,b);for(var c=0,d=this._objects.length;d>c;c++)this._objects[c]._renderControls(a)},_renderObject:function(a,b){if(a.visible){var c=a.hasRotatingPoint;a.hasRotatingPoint=!1;a.render(b);a.hasRotatingPoint=c}},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(a){var b=a.calcTransformMatrix(),b=c.util.qrDecompose(b),d=new c.Point(b.translateX,
b.translateY);return a.scaleX=b.scaleX,a.scaleY=b.scaleY,a.skewX=b.skewX,a.skewY=b.skewY,a.angle=b.angle,a.flipX=!1,a.flipY=!1,a.setPositionByOrigin(d,"center","center"),a},_restoreObjectState:function(a){return this.realizeTransform(a),a.setCoords(),a.hasControls=a.__origHasControls,delete a.__origHasControls,a.set("active",!1),delete a.group,this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),
this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(a){a.setCoords()}),this},_calcBounds:function(a){for(var b,c,d,e=[],f=[],g=["tr","br","bl","tl"],x=0,y=this._objects.length,z=g.length;y>x;++x)for(b=this._objects[x],b.setCoords(),d=0;z>d;d++)c=g[d],e.push(b.oCoords[c].x),f.push(b.oCoords[c].y);this.set(this._getBounds(e,f,a))},_getBounds:function(b,d,f){var g=c.util.invertTransform(this.getViewportTransform()),
m=c.util.transformPoint(new c.Point(a(b),a(d)),g);b=c.util.transformPoint(new c.Point(e(b),e(d)),g);b={width:b.x-m.x||0,height:b.y-m.y||0};return f||(b.left=m.x||0,b.top=m.y||0,"center"===this.originX&&(b.left+=b.width/2),"right"===this.originX&&(b.left+=b.width),"center"===this.originY&&(b.top+=b.height/2),"bottom"===this.originY&&(b.top+=b.height)),b},toSVG:function(a){var b=this._createBaseSVGMarkup();b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),
'">\n');for(var c=0,d=this._objects.length;d>c;c++)b.push("\t",this._objects[c].toSVG(a));return b.push("</g>\n"),a?a(b.join("")):b.join("")},get:function(a){if(a in f){if(this[a])return this[a];for(var b=0,c=this._objects.length;c>b;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});c.Group.fromObject=function(a,b){c.util.enlivenObjects(a.objects,function(d){delete a.objects;b&&b(new c.Group(d,a,!0))})};c.Group.async=
!0}})("undefined"!=typeof exports?exports:this);
(function(d){var c=fabric.util.object.extend;return d.fabric||(d.fabric={}),d.fabric.Image?void fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,initialize:function(b,a){a||(a={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",a);this._initElement(b,a)},getElement:function(){return this._element},setElement:function(b,
a,c){return this._element=b,this._originalElement=b,this._initConfig(c),0!==this.filters.length?this.applyFilters(a):a&&a(),this},setCrossOrigin:function(b){return this.crossOrigin=b,this._element.crossOrigin=b,this},getOriginalSize:function(){var b=this.getElement();return{width:b.width,height:b.height}},_stroke:function(b){b.save();this._setStrokeStyles(b);b.beginPath();b.strokeRect(-this.width/2,-this.height/2,this.width,this.height);b.closePath();b.restore()},_renderDashedStroke:function(b){var a=
-this.width/2,c=-this.height/2,d=this.width,f=this.height;b.save();this._setStrokeStyles(b);b.beginPath();fabric.util.drawDashedLine(b,a,c,a+d,c,this.strokeDashArray);fabric.util.drawDashedLine(b,a+d,c,a+d,c+f,this.strokeDashArray);fabric.util.drawDashedLine(b,a+d,c+f,a,c+f,this.strokeDashArray);fabric.util.drawDashedLine(b,a,c+f,a,c,this.strokeDashArray);b.closePath();b.restore()},toObject:function(b){var a=[];this.filters.forEach(function(b){b&&a.push(b.toObject())});b=c(this.callSuper("toObject",
b),{src:this._originalElement.src||this._originalElement._src,filters:a,crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice});return 0<this.resizeFilters.length&&(b.resizeFilters=this.resizeFilters.map(function(a){return a&&a.toObject()})),this.includeDefaultValues||this._removeDefaultValues(b),b},toSVG:function(b){var a=this._createBaseSVGMarkup(),c=-this.width/2,d=-this.height/2,f="none";if(this.group&&"path-group"===this.group.type&&(c=this.left,d=this.top),
"none"!==this.alignX&&"none"!==this.alignY&&(f="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),a.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',c,'" y="',d,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',f,'"',"></image>\n"),this.stroke||this.strokeDashArray)f=this.fill,this.fill=null,a.push("<rect ",'x="',c,'" y="',d,'" width="',this.width,'" height="',
this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=f;return a.push("</g>\n"),b?b(a.join("")):a.join("")},getSrc:function(){return this.getElement()?this.getElement().src||this.getElement()._src:void 0},setSrc:function(b,a,c){fabric.util.loadImage(b,function(b){return this.setElement(b,a,c)},this,c&&c.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(b,a){this.constructor.fromObject(this.toObject(a),b)},applyFilters:function(b,a,c,d){if(a=
a||this.filters,c=c||this._originalElement){var f=c,h=fabric.util.createCanvasElement(),k=fabric.util.createImage(),l=this;return h.width=f.width,h.height=f.height,h.getContext("2d").drawImage(f,0,0,f.width,f.height),0===a.length?(this._element=c,b&&b(),h):(a.forEach(function(a){a&&a.applyTo(h,a.scaleX||l.scaleX,a.scaleY||l.scaleY);!d&&a&&"Resize"===a.type&&(l.width*=a.scaleX,l.height*=a.scaleY)}),k.width=h.width,k.height=h.height,fabric.isLikelyNode?(k.src=h.toBuffer(void 0,fabric.Image.pngCompression),
l._element=k,!d&&(l._filteredEl=k),b&&b()):(k.onload=function(){l._element=k;!d&&(l._filteredEl=k);b&&b();k.onload=h=f=null},k.src=h.toDataURL("image/png")),h)}},_render:function(b,a){var c,d,f,h=this._findMargins();c=a?this.left:-this.width/2;d=a?this.top:-this.height/2;"slice"===this.meetOrSlice&&(b.beginPath(),b.rect(c,d,this.width,this.height),b.clip());!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,f=this.applyFilters(null,
this.resizeFilters,this._filteredEl||this._originalElement,!0)):f=this._element;f&&b.drawImage(f,c+h.marginX,d+h.marginY,h.width,h.height);this._renderStroke(b)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var b,a,c=this.width,d=this.height,f=0,h=0;return("none"!==this.alignX||"none"!==this.alignY)&&(b=[this.width/this._element.width,this.height/this._element.height],a="meet"===this.meetOrSlice?Math.min.apply(null,b):Math.max.apply(null,
b),c=this._element.width*a,d=this._element.height*a,"Mid"===this.alignX&&(f=(this.width-c)/2),"Max"===this.alignX&&(f=this.width-c),"Mid"===this.alignY&&(h=(this.height-d)/2),"Max"===this.alignY&&(h=this.height-d)),{width:c,height:d,marginX:f,marginY:h}},_resetWidthHeight:function(){var b=this.getElement();this.set("width",b.width);this.set("height",b.height)},_initElement:function(b,a){this.setElement(fabric.util.getById(b),null,a);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},
_initConfig:function(b){b||(b={});this.setOptions(b);this._setWidthHeight(b);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(b,a){b&&b.length?fabric.util.enlivenObjects(b,function(b){a&&a(b)},"fabric.Image.filters"):a&&a()},_setWidthHeight:function(b){this.width="width"in b?b.width:this.getElement()?this.getElement().width||0:0;this.height="height"in b?b.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS=
"canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(b,a){fabric.util.loadImage(b.src,function(c){fabric.Image.prototype._initFilters.call(b,b.filters,function(d){b.filters=d||[];fabric.Image.prototype._initFilters.call(b,b.resizeFilters,function(d){b.resizeFilters=d||[];d=new fabric.Image(c,b);a&&a(d)})})},null,b.crossOrigin)},fabric.Image.fromURL=function(b,a,c){fabric.util.loadImage(b,function(b){a&&a(new fabric.Image(b,c))},null,c&&c.crossOrigin)},
fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(b,a,d){var g;b=fabric.parseAttributes(b,fabric.Image.ATTRIBUTE_NAMES);b.preserveAspectRatio&&(g=fabric.util.parsePreserveAspectRatioAttribute(b.preserveAspectRatio),c(b,g));fabric.Image.fromURL(b["xlink:href"],a,c(d?fabric.util.object.clone(d):{},b))},fabric.Image.async=!0,void(fabric.Image.pngCompression=1))})("undefined"!=typeof exports?exports:
this);
fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var d=this.getAngle()%360;return 0<d?90*Math.round((d-1)/90):90*Math.round(d/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(d){d=d||{};var c=function(){},b=d.onComplete||c,a=d.onChange||c,e=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(b){e.setAngle(b);a()},
onComplete:function(){e.setCoords();b()},onStart:function(){e.set("active",!1)}}),this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(d){return d.straighten(),this.renderAll(),this},fxStraightenObject:function(d){return d.fxStraighten({onChange:this.renderAll.bind(this)}),this}});fabric.Image.filters=fabric.Image.filters||{};
fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(d){d&&this.setOptions(d)},setOptions:function(d){for(var c in d)this[c]=d[c]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.Brightness=c.util.createClass(c.Image.filters.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{};this.brightness=a.brightness||0},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,d=this.brightness,h=0,k=c.length;k>h;h+=4)c[h]+=d,c[h+1]+=d,c[h+2]+=d;b.putImageData(a,0,0)},toObject:function(){return b(this.callSuper("toObject"),{brightness:this.brightness})}});
c.Image.filters.Brightness.fromObject=function(a){return new c.Image.filters.Brightness(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.Convolute=c.util.createClass(c.Image.filters.BaseFilter,{type:"Convolute",initialize:function(a){a=a||{};this.opaque=a.opaque;this.matrix=a.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(a){var b,c,d,h,k,l,p,m,n,u=this.matrix,x=a.getContext("2d");b=x.getImageData(0,0,a.width,a.height);a=Math.round(Math.sqrt(u.length));for(var y=Math.floor(a/2),z=b.data,t=b.width,r=b.height,v=x.createImageData(t,r),q=v.data,w=this.opaque?
1:0,A=0;r>A;A++)for(var B=0;t>B;B++){k=4*(A*t+B);for(var C=h=d=c=b=0;a>C;C++)for(var D=0;a>D;D++)p=A+C-y,l=B+D-y,0>p||p>r||0>l||l>t||(m=4*(p*t+l),n=u[C*a+D],b+=z[m]*n,c+=z[m+1]*n,d+=z[m+2]*n,h+=z[m+3]*n);q[k]=b;q[k+1]=c;q[k+2]=d;q[k+3]=h+w*(255-h)}x.putImageData(v,0,0)},toObject:function(){return b(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});c.Image.filters.Convolute.fromObject=function(a){return new c.Image.filters.Convolute(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.GradientTransparency=c.util.createClass(c.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(a){a=a||{};this.threshold=a.threshold||100},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,d=this.threshold,h=c.length,k=0,l=c.length;l>k;k+=4)c[k+3]=d+255*(h-k)/h;b.putImageData(a,0,0)},toObject:function(){return b(this.callSuper("toObject"),{threshold:this.threshold})}});
c.Image.filters.GradientTransparency.fromObject=function(a){return new c.Image.filters.GradientTransparency(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Grayscale=c.util.createClass(c.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(b){for(var a=b.getContext("2d"),c=a.getImageData(0,0,b.width,b.height),d=c.data,f=c.width*c.height*4,h=0;f>h;)b=(d[h]+d[h+1]+d[h+2])/3,d[h]=b,d[h+1]=b,d[h+2]=b,h+=4;a.putImageData(c,0,0)}});c.Image.filters.Grayscale.fromObject=function(){return new c.Image.filters.Grayscale}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Invert=c.util.createClass(c.Image.filters.BaseFilter,{type:"Invert",applyTo:function(b){var a=b.getContext("2d"),c=a.getImageData(0,0,b.width,b.height),d=c.data,f=d.length;for(b=0;f>b;b+=4)d[b]=255-d[b],d[b+1]=255-d[b+1],d[b+2]=255-d[b+2];a.putImageData(c,0,0)}});c.Image.filters.Invert.fromObject=function(){return new c.Image.filters.Invert}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.Mask=c.util.createClass(c.Image.filters.BaseFilter,{type:"Mask",initialize:function(a){a=a||{};this.mask=a.mask;this.channel=-1<[0,1,2,3].indexOf(a.channel)?a.channel:0},applyTo:function(a){if(this.mask){var b=a.getContext("2d"),d=b.getImageData(0,0,a.width,a.height),f=d.data,h=this.mask.getElement(),k=c.util.createCanvasElement(),l=this.channel,p=d.width*d.height*4;k.width=a.width;k.height=a.height;k.getContext("2d").drawImage(h,
0,0,a.width,a.height);h=k.getContext("2d").getImageData(0,0,a.width,a.height).data;for(a=0;p>a;a+=4)f[a+3]=h[a+l];b.putImageData(d,0,0)}},toObject:function(){return b(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});c.Image.filters.Mask.fromObject=function(a,b){c.util.loadImage(a.mask.src,function(d){a.mask=new c.Image(d,a.mask);b&&b(new c.Image.filters.Mask(a))})};c.Image.filters.Mask.async=!0})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.Noise=c.util.createClass(c.Image.filters.BaseFilter,{type:"Noise",initialize:function(a){a=a||{};this.noise=a.noise||0},applyTo:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,h=this.noise,k=0,l=d.length;l>k;k+=4)a=(.5-Math.random())*h,d[k]+=a,d[k+1]+=a,d[k+2]+=a;b.putImageData(c,0,0)},toObject:function(){return b(this.callSuper("toObject"),{noise:this.noise})}});c.Image.filters.Noise.fromObject=
function(a){return new c.Image.filters.Noise(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.Pixelate=c.util.createClass(c.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(a){a=a||{};this.blocksize=a.blocksize||4},applyTo:function(a){var b,c,d,h,k,l,p=a.getContext("2d"),m=p.getImageData(0,0,a.width,a.height),n=m.data,u=m.height,x=m.width;for(b=0;u>b;b+=this.blocksize)for(c=0;x>c;c+=this.blocksize){a=4*b*x+4*c;d=n[a];h=n[a+1];k=n[a+2];l=n[a+3];for(var y=b,z=b+this.blocksize;z>y;y++)for(var t=c,r=
c+this.blocksize;r>t;t++)a=4*y*x+4*t,n[a]=d,n[a+1]=h,n[a+2]=k,n[a+3]=l}p.putImageData(m,0,0)},toObject:function(){return b(this.callSuper("toObject"),{blocksize:this.blocksize})}});c.Image.filters.Pixelate.fromObject=function(a){return new c.Image.filters.Pixelate(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.RemoveWhite=c.util.createClass(c.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{};this.threshold=a.threshold||30;this.distance=a.distance||20},applyTo:function(a){for(var b,c,d=a.getContext("2d"),h=d.getImageData(0,0,a.width,a.height),k=h.data,l=this.distance,p=255-this.threshold,m=Math.abs,n=0,u=k.length;u>n;n+=4)a=k[n],b=k[n+1],c=k[n+2],a>p&&b>p&&c>p&&m(a-b)<l&&m(a-c)<l&&m(b-c)<l&&(k[n+3]=
1);d.putImageData(h,0,0)},toObject:function(){return b(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});c.Image.filters.RemoveWhite.fromObject=function(a){return new c.Image.filters.RemoveWhite(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Sepia=c.util.createClass(c.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(b){var a,c=b.getContext("2d"),d=c.getImageData(0,0,b.width,b.height),f=d.data,h=f.length;for(b=0;h>b;b+=4)a=.3*f[b]+.59*f[b+1]+.11*f[b+2],f[b]=a+100,f[b+1]=a+50,f[b+2]=a+255;c.putImageData(d,0,0)}});c.Image.filters.Sepia.fromObject=function(){return new c.Image.filters.Sepia}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Sepia2=c.util.createClass(c.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(b){var a,c,d,f=b.getContext("2d"),h=f.getImageData(0,0,b.width,b.height),k=h.data,l=k.length;for(b=0;l>b;b+=4)a=k[b],c=k[b+1],d=k[b+2],k[b]=(.393*a+.769*c+.189*d)/1.351,k[b+1]=(.349*a+.686*c+.168*d)/1.203,k[b+2]=(.272*a+.534*c+.131*d)/2.14;f.putImageData(h,0,0)}});c.Image.filters.Sepia2.fromObject=function(){return new c.Image.filters.Sepia2}})("undefined"!=
typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.Tint=c.util.createClass(c.Image.filters.BaseFilter,{type:"Tint",initialize:function(a){a=a||{};this.color=a.color||"#000000";this.opacity="undefined"!=typeof a.opacity?a.opacity:(new c.Color(this.color)).getAlpha()},applyTo:function(a){var b,d,f,h,k,l,p,m=a.getContext("2d"),n=m.getImageData(0,0,a.width,a.height),u=n.data,x=u.length;b=(new c.Color(this.color)).getSource();a=b[0]*this.opacity;d=b[1]*this.opacity;f=b[2]*
this.opacity;p=1-this.opacity;for(b=0;x>b;b+=4)h=u[b],k=u[b+1],l=u[b+2],u[b]=a+h*p,u[b+1]=d+k*p,u[b+2]=f+l*p;m.putImageData(n,0,0)},toObject:function(){return b(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});c.Image.filters.Tint.fromObject=function(a){return new c.Image.filters.Tint(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.Multiply=c.util.createClass(c.Image.filters.BaseFilter,{type:"Multiply",initialize:function(a){a=a||{};this.color=a.color||"#000000"},applyTo:function(a){var b,d=a.getContext("2d"),f=d.getImageData(0,0,a.width,a.height),h=f.data,k=h.length;b=(new c.Color(this.color)).getSource();for(a=0;k>a;a+=4)h[a]*=b[0]/255,h[a+1]*=b[1]/255,h[a+2]*=b[2]/255;d.putImageData(f,0,0)},toObject:function(){return b(this.callSuper("toObject"),
{color:this.color})}});c.Image.filters.Multiply.fromObject=function(a){return new c.Image.filters.Multiply(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric;c.Image.filters.Blend=c.util.createClass({type:"Blend",initialize:function(b){b=b||{};this.color=b.color||"#000";this.image=b.image||!1;this.mode=b.mode||"multiply";this.alpha=b.alpha||1},applyTo:function(b){var a,d,g,f,h,k,l,p=b.getContext("2d");b=p.getImageData(0,0,b.width,b.height);var m=b.data,n=!1;this.image?(n=!0,l=c.util.createCanvasElement(),l.width=this.image.width,l.height=this.image.height,l=new c.StaticCanvas(l),l.add(this.image),l=l.getContext("2d").getImageData(0,
0,l.width,l.height).data):(l=(new c.Color(this.color)).getSource(),a=l[0]*this.alpha,d=l[1]*this.alpha,g=l[2]*this.alpha);for(var u=0,x=m.length;x>u;u+=4)switch(f=m[u],h=m[u+1],k=m[u+2],n&&(a=l[u]*this.alpha,d=l[u+1]*this.alpha,g=l[u+2]*this.alpha),this.mode){case "multiply":m[u]=f*a/255;m[u+1]=h*d/255;m[u+2]=k*g/255;break;case "screen":m[u]=1-(1-f)*(1-a);m[u+1]=1-(1-h)*(1-d);m[u+2]=1-(1-k)*(1-g);break;case "add":m[u]=Math.min(255,f+a);m[u+1]=Math.min(255,h+d);m[u+2]=Math.min(255,k+g);break;case "diff":case "difference":m[u]=
Math.abs(f-a);m[u+1]=Math.abs(h-d);m[u+2]=Math.abs(k-g);break;case "subtract":f-=a;h-=d;k-=g;m[u]=0>f?0:f;m[u+1]=0>h?0:h;m[u+2]=0>k?0:k;break;case "darken":m[u]=Math.min(f,a);m[u+1]=Math.min(h,d);m[u+2]=Math.min(k,g);break;case "lighten":m[u]=Math.max(f,a),m[u+1]=Math.max(h,d),m[u+2]=Math.max(k,g)}p.putImageData(b,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});c.Image.filters.Blend.fromObject=function(b){return new c.Image.filters.Blend(b)}})("undefined"!=
typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=Math.pow,a=Math.floor,e=Math.sqrt,g=Math.abs,f=Math.max,h=Math.round,k=Math.sin,l=Math.ceil;c.Image.filters.Resize=c.util.createClass(c.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(a,b,c){this.rcpScaleX=1/b;this.rcpScaleY=1/c;var d,e=a.width,f=a.height;b=h(e*b);c=h(f*c);"sliceHack"===this.resizeType&&(d=this.sliceByTwo(a,e,f,b,c));"hermite"===this.resizeType&&(d=this.hermiteFastResize(a,
e,f,b,c));"bilinear"===this.resizeType&&(d=this.bilinearFiltering(a,e,f,b,c));"lanczos"===this.resizeType&&(d=this.lanczosResize(a,e,f,b,c));a.width=b;a.height=c;a.getContext("2d").putImageData(d,0,0)},sliceByTwo:function(b,d,e,g,h){var k,l=b.getContext("2d"),t=.5,r=.5,v=1,q=1,w=!1,A=!1,B=d,C=e,D=c.util.createCanvasElement(),E=D.getContext("2d");g=a(g);h=a(h);D.width=f(g,d);D.height=f(h,e);g>d&&(t=2,v=-1);h>e&&(r=2,q=-1);k=l.getImageData(0,0,d,e);b.width=f(g,d);b.height=f(h,e);for(l.putImageData(k,
0,0);!w||!A;)d=B,e=C,g*v<a(B*t*v)?B=a(B*t):(B=g,w=!0),h*q<a(C*r*q)?C=a(C*r):(C=h,A=!0),k=l.getImageData(0,0,d,e),E.putImageData(k,0,0),l.clearRect(0,0,B,C),l.drawImage(D,0,0,d,e,0,0,B,C);return l.getImageData(0,0,g,h)},lanczosResize:function(c,d,f,h,x){var y,z,t,r;function v(c){var k,l,p,q,M,S,T,U,V,N,P;t=(c+.5)*D;y=a(t);for(k=0;x>k;k++){r=(k+.5)*E;z=a(r);V=U=T=S=M=0;for(l=y-H;l<=y+H;l++)if(!(0>l||l>=d)){N=a(1E3*g(l-t));I[N]||(I[N]={});for(var O=z-K;O<=z+K;O++)0>O||O>=f||(P=a(1E3*g(O-r)),I[N][P]||
(I[N][P]=C(e(b(N*F,2)+b(P*G,2))/1E3)),p=I[N][P],0<p&&(q=4*(O*d+l),M+=p,S+=p*A[q],T+=p*A[q+1],U+=p*A[q+2],V+=p*A[q+3]))}q=4*(k*h+c);B[q]=S/M;B[q+1]=T/M;B[q+2]=U/M;B[q+3]=V/M}return++c<h?v(c):w}c=c.getContext("2d");var q=c.getImageData(0,0,d,f),w=c.getImageData(0,0,h,x),A=q.data,B=w.data,C=function(a){return function(b){if(b>a)return 0;if(b*=Math.PI,1E-16>g(b))return 1;var c=b/a;return k(b)*k(c)/b/c}}(this.lanczosLobes),D=this.rcpScaleX,E=this.rcpScaleY,F=2/this.rcpScaleX,G=2/this.rcpScaleY,H=l(D*this.lanczosLobes/
2),K=l(E*this.lanczosLobes/2),I={};z=y=r=t=void 0;return v(0)},bilinearFiltering:function(b,c,d,e,f){var g,h,k,l,v,q,w,A,B,C,D=0,E=this.rcpScaleX,F=this.rcpScaleY;w=b.getContext("2d");b=4*(c-1);d=w.getImageData(0,0,c,d).data;var G=w.getImageData(0,0,e,f),H=G.data;for(w=0;f>w;w++)for(A=0;e>A;A++)for(v=a(E*A),q=a(F*w),B=E*A-v,C=F*w-q,q=4*(q*c+v),v=0;4>v;v++)g=d[q+v],h=d[q+4+v],k=d[q+b+v],l=d[q+b+4+v],g=g*(1-B)*(1-C)+h*B*(1-C)+k*C*(1-B)+l*B*C,H[D++]=g;return G},hermiteFastResize:function(b,c,d,f,h){var k=
this.rcpScaleX,z=this.rcpScaleY,t=l(k/2),r=l(z/2);b=b.getContext("2d");d=b.getImageData(0,0,c,d).data;b=b.getImageData(0,0,f,h);for(var v=b.data,q=0;h>q;q++)for(var w=0;f>w;w++){for(var A=4*(w+q*f),B=0,C=0,D=0,E=0,F=0,G=0,H=0,K=(q+.5)*z,I=a(q*z);(q+1)*z>I;I++)for(var Q=g(K-(I+.5))/r,W=(w+.5)*k,Q=Q*Q,R=a(w*k);(w+1)*k>R;R++){var J=g(W-(R+.5))/t,L=e(Q+J*J);1<L&&-1>L||(B=2*L*L*L-3*L*L+1,0<B&&(J=4*(R+I*c),H+=B*d[J+3],D+=B,255>d[J+3]&&(B=B*d[J+3]/250),E+=B*d[J],F+=B*d[J+1],G+=B*d[J+2],C+=B))}v[A]=E/C;v[A+
1]=F/C;v[A+2]=G/C;v[A+3]=H/D}return b},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});c.Image.filters.Resize.fromObject=function(a){return new c.Image.filters.Resize(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend,a=c.util.object.clone,e=c.util.toFixed,g=c.StaticCanvas.supports("setLineDash"),f=c.Object.NUM_FRACTION_DIGITS;if(c.Text)return void c.warn("fabric.Text is already defined");d=c.Object.prototype.stateProperties.concat();d.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor");c.Text=c.util.createClass(c.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,
fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:d,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions()},
_initDimensions:function(a){this.__skipDimension||(a||(a=c.util.createCanvasElement().getContext("2d"),this._setTextStyles(a)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this._cacheLinesWidth="justify"!==this.textAlign,this.width=this._getTextWidth(a),this._cacheLinesWidth=!0,this.height=this._getTextHeight(a))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){this.clipTo&&c.util.clipContext(this,
a);this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextBackground(a);this._setStrokeStyles(a);this._setFillStyles(a);this._renderText(a);this._renderTextDecoration(a);this.clipTo&&a.restore()},_renderText:function(a){this._translateForTextAlign(a);this._renderTextFill(a);this._renderTextStroke(a);this._translateForTextAlign(a,!0)},_translateForTextAlign:function(a,b){if("left"!==this.textAlign&&"justify"!==this.textAlign){var c=b?-1:1;a.translate("center"===this.textAlign?
c*this.width/2:c*this.width,0)}},_setTextStyles:function(a){a.textBaseline="alphabetic";this.skipTextAlign||(a.textAlign=this.textAlign);a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(a){for(var b=this._getLineWidth(a,0),c=1,d=this._textLines.length;d>c;c++){var e=this._getLineWidth(a,c);e>b&&(b=e)}return b},_renderChars:function(a,b,c,d,e){var f=a.slice(0,-4);if(this[f].toLive){var g=-this.width/2+this[f].offsetX||
0,x=-this.height/2+this[f].offsetY||0;b.save();b.translate(g,x);d-=g;e-=x}b[a](c,d,e);this[f].toLive&&b.restore()},_renderTextLine:function(a,b,c,d,e,f){e-=this.fontSize*this._fontSizeFraction;var g=this._getLineWidth(b,f);if("justify"!==this.textAlign||this.width<g)return void this._renderChars(a,b,c,d,e,f);var x,g=c.split(/\s+/),y=0;x=this._getWidthOfWords(b,c,f,0);x=this.width-x;for(var z=g.length-1,z=0<z?x/z:0,t=0,r=0,v=g.length;v>r;r++){for(;" "===c[y]&&y<c.length;)y++;x=g[r];this._renderChars(a,
b,x,d+t,e,f,y);t+=this._getWidthOfWords(b,x,f,y)+z;y+=x.length}},_getWidthOfWords:function(a,b){return a.measureText(b.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a){if(this.fill||this._skipFillStrokeCheck)for(var b=0,c=0,d=this._textLines.length;d>c;c++){var e=this._getHeightOfLine(a,c),f=e/this.lineHeight;this._renderTextLine("fillText",a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+
b+f,c);b+=e}},_renderTextStroke:function(a){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var b=0;this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a);a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g&&a.setLineDash(this.strokeDashArray));a.beginPath();for(var c=0,d=this._textLines.length;d>c;c++){var e=this._getHeightOfLine(a,c),f=e/this.lineHeight;this._renderTextLine("strokeText",
a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+b+f,c);b+=e}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(a){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height))},_renderTextLinesBackground:function(a){if(this.textBackgroundColor){var b,
c,d=0,e=this._getHeightOfLine();a.fillStyle=this.textBackgroundColor;for(var f=0,g=this._textLines.length;g>f;f++)""!==this._textLines[f]&&(b="justify"===this.textAlign?this.width:this._getLineWidth(a,f),c=this._getLineLeftOffset(b),a.fillRect(this._getLeftOffset()+c,this._getTopOffset()+d,b,this.fontSize*this._fontSizeMult)),d+=e}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=
[]},_shouldClearCache:function(){var a=!1;if(this._forceClearCache)return this._forceClearCache=!1,!0;for(var b in this._dimensionAffectingProps)this["__"+b]!==this[b]&&(this["__"+b]=this[b],a=!0);return a},_getLineWidth:function(a,b){if(this.__lineWidths[b])return this.__lineWidths[b];var c,d,e=this._textLines[b];return""===e?c=0:"justify"===this.textAlign&&this._cacheLinesWidth?(d=e.split(/\s+/),c=1<d.length?this.width:a.measureText(e).width):c=a.measureText(e).width,this._cacheLinesWidth&&(this.__lineWidths[b]=
c),c},_renderTextDecoration:function(a){if(this.textDecoration){var b=this.height/2,c=[];-1<this.textDecoration.indexOf("underline")&&c.push(.85);-1<this.textDecoration.indexOf("line-through")&&c.push(.43);-1<this.textDecoration.indexOf("overline")&&c.push(-.12);if(0<c.length){var d,e,f,g,x,y,z,t=0;d=0;for(e=this._textLines.length;e>d;d++){x=this._getLineWidth(a,d);y=this._getLineLeftOffset(x);z=this._getHeightOfLine(a,d);f=0;for(g=c.length;g>f;f++)a.fillRect(this._getLeftOffset()+y,t+(this._fontSizeMult-
1+c[f])*this.fontSize-b,x,this.fontSize/15);t+=z}}}},_getFontDeclaration:function(){return[c.isLikelyNode?this.fontWeight:this.fontStyle,c.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",c.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){this.visible&&(a.save(),this._setTextStyles(a),this._shouldClearCache()&&this._initDimensions(a),b||this.transform(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this.group&&"path-group"===this.group.type&&
a.translate(this.left,this.top),this._render(a),a.restore())},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(a){a=b(this.callSuper("toObject",a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});return this.includeDefaultValues||this._removeDefaultValues(a),
a},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this._getSVGLeftTopOffsets(this.ctx),c=this._getSVGTextAndBg(c.textTop,c.textLeft);return this._wrapSVGTextAndBg(b,c),a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){a=this._getHeightOfLine(a,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:a}},_wrapSVGTextAndBg:function(a,b){a.push('\t<g transform="',this.getSvgTransform(),
this.getSvgTransformMatrix(),'">\n',b.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >\n',b.textSpans.join(""),"\t\t</text>\n","\t</g>\n")},_getSVGTextAndBg:function(a,b){var c=[],
d=[],e=0;this._setSVGBg(d);for(var f=0,g=this._textLines.length;g>f;f++)this.textBackgroundColor&&this._setSVGTextLineBg(d,f,b,a,e),this._setSVGTextLineText(f,c,e,b,a,d),e+=this._getHeightOfLine(this.ctx,f);return{textSpans:c,textBgRects:d}},_setSVGTextLineText:function(a,b,d,g,m){d=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-m+d-this.height/2;return"justify"===this.textAlign?void this._setSVGTextLineJustifed(a,b,d,g):void b.push('\t\t\t<tspan x="',e(g+this._getLineLeftOffset(this._getLineWidth(this.ctx,
a)),f),'" ','y="',e(d,f),'" ',this._getFillAttributes(this.fill),">",c.util.string.escapeXml(this._textLines[a]),"</tspan>\n")},_setSVGTextLineJustifed:function(a,b,d,g){var m=c.util.createCanvasElement().getContext("2d");this._setTextStyles(m);var n;n=this._textLines[a];var u=n.split(/\s+/);n=this._getWidthOfWords(m,n);n=this.width-n;var x=u.length-1,x=0<x?n/x:0,y=this._getFillAttributes(this.fill);g+=this._getLineLeftOffset(this._getLineWidth(m,a));a=0;for(var z=u.length;z>a;a++)n=u[a],b.push('\t\t\t<tspan x="',
e(g,f),'" ','y="',e(d,f),'" ',y,">",c.util.string.escapeXml(n),"</tspan>\n"),g+=this._getWidthOfWords(m,n)+x},_setSVGTextLineBg:function(a,b,c,d,g){a.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',e(c+this._getLineLeftOffset(this._getLineWidth(this.ctx,b)),f),'" y="',e(g-this.height/2,f),'" width="',e(this._getLineWidth(this.ctx,b),f),'" height="',e(this._getHeightOfLine(this.ctx,b)/this.lineHeight,f),'"></rect>\n')},_setSVGBg:function(a){this.backgroundColor&&a.push("\t\t<rect ",
this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,f),'" y="',e(-this.height/2,f),'" width="',e(this.width,f),'" height="',e(this.height,f),'"></rect>\n')},_getFillAttributes:function(a){var b=a&&"string"==typeof a?new c.Color(a):"";return b&&b.getSource()&&1!==b.getAlpha()?'opacity="'+b.getAlpha()+'" fill="'+b.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}});
c.Text.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" "));c.Text.DEFAULT_SVG_FONT_SIZE=16;c.Text.fromElement=function(a,b){if(!a)return null;var d=c.parseAttributes(a,c.Text.ATTRIBUTE_NAMES);b=c.util.object.extend(b?c.util.object.clone(b):{},d);b.top=b.top||0;b.left=b.left||0;"dx"in d&&(b.left+=d.dx);"dy"in d&&(b.top+=d.dy);"fontSize"in b||(b.fontSize=c.Text.DEFAULT_SVG_FONT_SIZE);b.originX||(b.originX="left");
d="";"textContent"in a?d=a.textContent:"firstChild"in a&&null!==a.firstChild&&"data"in a.firstChild&&null!==a.firstChild.data&&(d=a.firstChild.data);var d=d.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),d=new c.Text(d,b),e=0;return"left"===d.originX&&(e=d.getWidth()/2),"right"===d.originX&&(e=-d.getWidth()/2),d.set({left:d.getLeft()+e,top:d.getTop()-d.getHeight()/2+d.fontSize*(.18+d._fontSizeFraction)}),d};c.Text.fromObject=function(b){return new c.Text(b.text,a(b))};c.util.createAccessors(c.Text)})("undefined"!=
typeof exports?exports:this);
(function(){var d=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1E3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!1,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},__widthOfSpace:[],
initialize:function(c,b){this.styles=b?b.styles||{}:{};this.callSuper("initialize",c,b);this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache");this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var c=this.styles,b;for(b in c)for(var a in c[b])for(var d in c[b][a])return!1;return!0},setSelectionStart:function(c){c=Math.max(c,0);this.selectionStart!==c&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionStart=
c);this._updateTextarea()},setSelectionEnd:function(c){c=Math.min(c,this.text.length);this.selectionEnd!==c&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionEnd=c);this._updateTextarea()},getSelectionStyles:function(c,b){if(2===arguments.length){for(var a=[],d=c;b>d;d++)a.push(this.getSelectionStyles(d));return a}a=this.get2DCursorLocation(c);return this._getStyleDeclaration(a.lineIndex,a.charIndex)||{}},setSelectionStyles:function(c){if(this.selectionStart===
this.selectionEnd)this._extendStyles(this.selectionStart,c);else for(var b=this.selectionStart;b<this.selectionEnd;b++)this._extendStyles(b,c);return this._forceClearCache=!0,this},_extendStyles:function(c,b){var a=this.get2DCursorLocation(c);this._getLineStyle(a.lineIndex)||this._setLineStyle(a.lineIndex,{});this._getStyleDeclaration(a.lineIndex,a.charIndex)||this._setStyleDeclaration(a.lineIndex,a.charIndex,{});fabric.util.object.extend(this._getStyleDeclaration(a.lineIndex,a.charIndex),b)},_render:function(c){this.callSuper("_render",
c);this.ctx=c;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var c,b,a=this.text.split("");this.canvas.contextTop?(b=this.canvas.contextTop,b.save(),b.transform.apply(b,this.canvas.viewportTransform),this.transform(b),this.transformMatrix&&b.transform.apply(b,this.transformMatrix)):(b=this.ctx,b.save());this.selectionStart===this.selectionEnd?(c=this._getCursorBoundaries(a,"cursor"),this.renderCursor(c,b)):(c=this._getCursorBoundaries(a,"selection"),
this.renderSelection(a,c,b));b.restore()}},get2DCursorLocation:function(c){"undefined"==typeof c&&(c=this.selectionStart);for(var b=this._textLines.length,a=0;b>a;a++){if(c<=this._textLines[a].length)return{lineIndex:a,charIndex:c};c-=this._textLines[a].length+1}return{lineIndex:a-1,charIndex:this._textLines[a-1].length<c?this._textLines[a-1].length:c}},getCurrentCharStyle:function(c,b){var a=this._getStyleDeclaration(c,0===b?0:b-1);return{fontSize:a&&a.fontSize||this.fontSize,fill:a&&a.fill||this.fill,
textBackgroundColor:a&&a.textBackgroundColor||this.textBackgroundColor,textDecoration:a&&a.textDecoration||this.textDecoration,fontFamily:a&&a.fontFamily||this.fontFamily,fontWeight:a&&a.fontWeight||this.fontWeight,fontStyle:a&&a.fontStyle||this.fontStyle,stroke:a&&a.stroke||this.stroke,strokeWidth:a&&a.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(c,b){var a=this._getStyleDeclaration(c,0===b?0:b-1);return a&&a.fontSize?a.fontSize:this.fontSize},getCurrentCharColor:function(c,b){var a=
this._getStyleDeclaration(c,0===b?0:b-1);return a&&a.fill?a.fill:this.cursorColor},_getCursorBoundaries:function(c,b){var a=Math.round(this._getLeftOffset()),d=this._getTopOffset(),g=this._getCursorBoundariesOffsets(c,b);return{left:a,top:d,leftOffset:g.left+g.lineLeft,topOffset:g.top}},_getCursorBoundariesOffsets:function(c,b){for(var a=0,d=0,g=0,f=0,h=0,k=0;k<this.selectionStart;k++)"\n"===c[k]?(h=0,f+=this._getHeightOfLine(this.ctx,d),d++,g=0):(h+=this._getWidthOfChar(this.ctx,c[k],d,g),g++),a=
this._getLineLeftOffset(this._getLineWidth(this.ctx,d));return"cursor"===b&&(f+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,d)/this.lineHeight-this.getCurrentCharFontSize(d,g)*(1-this._fontSizeFraction)),{top:f,left:h,lineLeft:a}},renderCursor:function(c,b){var a=this.get2DCursorLocation(),d=a.lineIndex,a=a.charIndex,g=this.getCurrentCharFontSize(d,a),f=0===d&&0===a?this._getLineLeftOffset(this._getLineWidth(b,d)):c.leftOffset;b.fillStyle=this.getCurrentCharColor(d,a);b.globalAlpha=
this.__isMousedown?1:this._currentCursorOpacity;b.fillRect(c.left+f,c.top+c.topOffset,this.cursorWidth/this.scaleX,g)},renderSelection:function(c,b,a){a.fillStyle=this.selectionColor;c=this.get2DCursorLocation(this.selectionStart);for(var d=this.get2DCursorLocation(this.selectionEnd),g=c.lineIndex,f=d.lineIndex,h=g;f>=h;h++){var k=this._getLineLeftOffset(this._getLineWidth(a,h))||0,l=this._getHeightOfLine(this.ctx,h),p=0,m=this._textLines[h];if(h===g)for(var n=0,u=m.length;u>n;n++)n>=c.charIndex&&
(h!==f||n<d.charIndex)&&(p+=this._getWidthOfChar(a,m[n],h,n)),n<c.charIndex&&(k+=this._getWidthOfChar(a,m[n],h,n));else if(h>g&&f>h)p+=this._getLineWidth(a,h)||5;else if(h===f)for(n=0,u=d.charIndex;u>n;n++)p+=this._getWidthOfChar(a,m[n],h,n);a.fillRect(b.left+k,b.top+b.topOffset,p,l);b.topOffset+=l}},_renderChars:function(c,b,a,d,g,f,h){if(this.isEmptyStyles())return this._renderCharsFast(c,b,a,d,g);h=h||0;this.skipTextAlign=!0;d-="center"===this.textAlign?this.width/2:"right"===this.textAlign?this.width:
0;var k,l,p=this._getHeightOfLine(b,f);l=this._getLineLeftOffset(this._getLineWidth(b,f));var m="";d+=l||0;b.save();g-=p/this.lineHeight*this._fontSizeFraction;for(var n=h,u=a.length+h;u>=n;n++)k=k||this.getCurrentCharStyle(f,n),l=this.getCurrentCharStyle(f,n+1),(this._hasStyleChanged(k,l)||n===u)&&(this._renderChar(c,b,f,n-1,m,d,g,p),m="",k=l),m+=a[n-h];b.restore()},_renderCharsFast:function(c,b,a,d,g){this.skipTextAlign=!1;"fillText"===c&&this.fill&&this.callSuper("_renderChars",c,b,a,d,g);"strokeText"===
c&&(this.stroke&&0<this.strokeWidth||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",c,b,a,d,g)},_renderChar:function(c,b,a,d,g,f,h,k){var l,p,m,n,u,x=this._getStyleDeclaration(a,d);x?(l=this._getHeightOfChar(b,g,a,d),m=x.stroke,p=x.fill,u=x.textDecoration):l=this.fontSize;m=(m||this.stroke)&&"strokeText"===c;p=(p||this.fill)&&"fillText"===c;x&&b.save();c=this._applyCharStylesGetWidth(b,g,a,d,x||{});u=u||this.textDecoration;p&&b.fillText(g,f,h);m&&b.strokeText(g,f,h);(u||""!==u)&&(n=this._fontSizeFraction*
k/this.lineHeight,this._renderCharDecoration(b,u,f,h,n,c,l));x&&b.restore();b.translate(c,0)},_hasStyleChanged:function(c,b){return c.fill!==b.fill||c.fontSize!==b.fontSize||c.textBackgroundColor!==b.textBackgroundColor||c.textDecoration!==b.textDecoration||c.fontFamily!==b.fontFamily||c.fontWeight!==b.fontWeight||c.fontStyle!==b.fontStyle||c.stroke!==b.stroke||c.strokeWidth!==b.strokeWidth},_renderCharDecoration:function(c,b,a,d,g,f,h){if(b){g=h/15;var k={underline:d+h/10,"line-through":d-h*(this._fontSizeFraction+
this._fontSizeMult-1)+g,overline:d-(this._fontSizeMult-this._fontSizeFraction)*h},l=["underline","line-through","overline"];for(d=0;d<l.length;d++)h=l[d],-1<b.indexOf(h)&&c.fillRect(a,k[h],f,g)}},_renderTextLine:function(c,b,a,d,g,f){this.isEmptyStyles()||(g+=this.fontSize*(this._fontSizeFraction+.03));this.callSuper("_renderTextLine",c,b,a,d,g,f)},_renderTextDecoration:function(c){return this.isEmptyStyles()?this.callSuper("_renderTextDecoration",c):void 0},_renderTextLinesBackground:function(c){if(this.textBackgroundColor||
this.styles){c.save();this.textBackgroundColor&&(c.fillStyle=this.textBackgroundColor);for(var b=0,a=0,d=this._textLines.length;d>a;a++){var g=this._getHeightOfLine(c,a);if(""!==this._textLines[a]){var f=this._getLineWidth(c,a),h=this._getLineLeftOffset(f);if(this.textBackgroundColor&&(c.fillStyle=this.textBackgroundColor,c.fillRect(this._getLeftOffset()+h,this._getTopOffset()+b,f,g/this.lineHeight)),this._getLineStyle(a))for(var f=0,k=this._textLines[a].length;k>f;f++){var l=this._getStyleDeclaration(a,
f);if(l&&l.textBackgroundColor){var p=this._textLines[a][f];c.fillStyle=l.textBackgroundColor;c.fillRect(this._getLeftOffset()+h+this._getWidthOfCharsAt(c,a,f),this._getTopOffset()+b,this._getWidthOfChar(c,p,a,f)+1,g/this.lineHeight)}}}b+=g}c.restore()}},_getCacheProp:function(c,b){return c+b.fontFamily+b.fontSize+b.fontWeight+b.fontStyle+b.shadow},_applyCharStylesGetWidth:function(c,b,a,e,g){var f;a=this._getStyleDeclaration(a,e);g=g||d(a);this._applyFontStyles(g);e=this._getCacheProp(b,g);if(!a&&
this._charWidthsCache[e]&&this.caching)return this._charWidthsCache[e];"string"==typeof g.shadow&&(g.shadow=new fabric.Shadow(g.shadow));a=g.fill||this.fill;return c.fillStyle=a.toLive?a.toLive(c,this):a,g.stroke&&(c.strokeStyle=g.stroke&&g.stroke.toLive?g.stroke.toLive(c,this):g.stroke),c.lineWidth=g.strokeWidth||this.strokeWidth,c.font=this._getFontDeclaration.call(g),this._setShadow.call(g,c),this.caching&&this._charWidthsCache[e]||(f=c.measureText(b).width,this.caching&&(this._charWidthsCache[e]=
f)),this._charWidthsCache[e]},_applyFontStyles:function(c){c.fontFamily||(c.fontFamily=this.fontFamily);c.fontSize||(c.fontSize=this.fontSize);c.fontWeight||(c.fontWeight=this.fontWeight);c.fontStyle||(c.fontStyle=this.fontStyle)},_getStyleDeclaration:function(c,b,a){return a?this.styles[c]&&this.styles[c][b]?d(this.styles[c][b]):{}:this.styles[c]&&this.styles[c][b]?this.styles[c][b]:null},_setStyleDeclaration:function(c,b,a){this.styles[c][b]=a},_deleteStyleDeclaration:function(c,b){delete this.styles[c][b]},
_getLineStyle:function(c){return this.styles[c]},_setLineStyle:function(c,b){this.styles[c]=b},_deleteLineStyle:function(c){delete this.styles[c]},_getWidthOfChar:function(c,b,a,d){if("justify"===this.textAlign&&this._reSpacesAndTabs.test(b))return this._getWidthOfSpace(c,a);var g=this._getStyleDeclaration(a,d,!0);this._applyFontStyles(g);g=this._getCacheProp(b,g);if(this._charWidthsCache[g]&&this.caching)return this._charWidthsCache[g];if(c)return c.save(),b=this._applyCharStylesGetWidth(c,b,a,d),
c.restore(),b},_getHeightOfChar:function(c,b,a){return(c=this._getStyleDeclaration(b,a))&&c.fontSize?c.fontSize:this.fontSize},_getWidthOfCharsAt:function(c,b,a){var d,g,f=0;for(d=0;a>d;d++)g=this._textLines[b][d],f+=this._getWidthOfChar(c,g,b,d);return f},_getLineWidth:function(c,b){return this.__lineWidths[b]?this.__lineWidths[b]:(this.__lineWidths[b]=this._getWidthOfCharsAt(c,b,this._textLines[b].length),this.__lineWidths[b])},_getWidthOfSpace:function(c,b){if(this.__widthOfSpace[b])return this.__widthOfSpace[b];
var a=this._textLines[b],d=this._getWidthOfWords(c,a,b,0),d=this.width-d,a=a.length-a.replace(this._reSpacesAndTabs,"").length,a=d/a;return this.__widthOfSpace[b]=a,a},_getWidthOfWords:function(c,b,a,d){for(var g=0,f=0;f<b.length;f++){var h=b[f];h.match(/\s/)||(g+=this._getWidthOfChar(c,h,a,f+d))}return g},_getHeightOfLine:function(c,b){if(this.__lineHeights[b])return this.__lineHeights[b];for(var a=this._textLines[b],d=this._getHeightOfChar(c,b,0),g=1,a=a.length;a>g;g++){var f=this._getHeightOfChar(c,
b,g);f>d&&(d=f)}return this.__lineHeights[b]=d*this.lineHeight*this._fontSizeMult,this.__lineHeights[b]},_getTextHeight:function(c){for(var b=0,a=0,d=this._textLines.length;d>a;a++)b+=this._getHeightOfLine(c,a);return b},_renderTextBoxBackground:function(c){this.backgroundColor&&(c.save(),c.fillStyle=this.backgroundColor,c.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),c.restore())},toObject:function(c){var b,a,e,g={};for(b in this.styles)for(a in e=this.styles[b],g[b]=
{},e)g[b][a]=d(e[a]);return fabric.util.object.extend(this.callSuper("toObject",c),{styles:g})}});fabric.IText.fromObject=function(c){return new fabric.IText(c.text,d(c))}})();
(function(){var d=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var c=this;setTimeout(function(){c.selected=!0},100)})},initAddedHandler:function(){var c=this;this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers());
c.canvas&&(c.canvas._iTextInstances=c.canvas._iTextInstances||[],c.canvas._iTextInstances.push(c))})},initRemovedHandler:function(){var c=this;this.on("removed",function(){c.canvas&&(c.canvas._iTextInstances=c.canvas._iTextInstances||[],fabric.util.removeFromArray(c.canvas._iTextInstances,c))})},_initCanvasHandlers:function(){var c=this;this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers(c.canvas)});this.canvas.on("mouse:up",function(){c.canvas._iTextInstances&&
c.canvas._iTextInstances.forEach(function(b){b.__isMousedown=!1})});this.canvas.on("object:selected",function(){fabric.IText.prototype.exitEditingOnOthers(c.canvas)})},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(c,b,a,d){var g;return g={isAborted:!1,abort:function(){this.isAborted=!0}},c.animate("_currentCursorOpacity",b,{duration:a,onComplete:function(){g.isAborted||c[d]()},onChange:function(){c.canvas&&(c.canvas.clearContext(c.canvas.contextTop||
c.ctx),c.renderCursorOrSelection())},abort:function(){return g.isAborted}}),g},_onTickComplete:function(){var c=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){c._currentTickCompleteState=c._animateCursor(c,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(c){var b=this;c=c?0:this.cursorDelay;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);
this._currentCursorOpacity=1;this.canvas&&(this.canvas.clearContext(this.canvas.contextTop||this.ctx),this.renderCursorOrSelection());this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){b._tick()},c)},abortCursorAnimation:function(){this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=
0;this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.setSelectionStart(0);this.setSelectionEnd(this.text.length)},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(c){var b=0,a=c-1;if(this._reSpace.test(this.text.charAt(a)))for(;this._reSpace.test(this.text.charAt(a));)b++,a--;for(;/\S/.test(this.text.charAt(a))&&-1<a;)b++,a--;return c-b},findWordBoundaryRight:function(c){var b=0,
a=c;if(this._reSpace.test(this.text.charAt(a)))for(;this._reSpace.test(this.text.charAt(a));)b++,a++;for(;/\S/.test(this.text.charAt(a))&&a<this.text.length;)b++,a++;return c+b},findLineBoundaryLeft:function(c){for(var b=0,a=c-1;!/\n/.test(this.text.charAt(a))&&-1<a;)b++,a--;return c-b},findLineBoundaryRight:function(c){for(var b=0,a=c;!/\n/.test(this.text.charAt(a))&&a<this.text.length;)b++,a++;return c+b},getNumNewLinesInSelectedText:function(){for(var c=this.getSelectedText(),b=0,a=0,d=c.length;d>
a;a++)"\n"===c[a]&&b++;return b},searchWordBoundary:function(c,b){for(var a=this._reSpace.test(this.text.charAt(c))?c-1:c,d=this.text.charAt(a),g=/[ \n\.,;!\?\-]/;!g.test(d)&&0<a&&a<this.text.length;)a+=b,d=this.text.charAt(a);return g.test(d)&&"\n"!==d&&(a+=1===b?0:1),a},selectWord:function(c){var b=this.searchWordBoundary(c,-1);c=this.searchWordBoundary(c,1);this.setSelectionStart(b);this.setSelectionEnd(c)},selectLine:function(c){var b=this.findLineBoundaryLeft(c);c=this.findLineBoundaryRight(c);
this.setSelectionStart(b);this.setSelectionEnd(c)},enterEditing:function(){return!this.isEditing&&this.editable?(this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.renderAll(),this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this):this):void 0},exitEditingOnOthers:function(c){c._iTextInstances&&
c._iTextInstances.forEach(function(b){b.selected=!1;b.isEditing&&b.exitEditing()})},initMouseMoveHandler:function(){var c=this;this.canvas.on("mouse:move",function(b){c.__isMousedown&&c.isEditing&&(b=c.getSelectionStartFromPointer(b.e),b>=c.__selectionStartOnMouseDown?(c.setSelectionStart(c.__selectionStartOnMouseDown),c.setSelectionEnd(b)):(c.setSelectionStart(b),c.setSelectionEnd(c.__selectionStartOnMouseDown)))})},_setEditingProps:function(){this.hoverCursor="text";this.canvas&&(this.canvas.defaultCursor=
this.canvas.moveCursor="text");this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,
hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=
this._savedProps.moveCursor))},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this.canvas&&this.canvas.fire("text:editing:exited",{target:this}),this},_removeExtraneousStyles:function(){for(var c in this.styles)this._textLines[c]||
delete this.styles[c]},_removeCharsFromTo:function(c,b){for(;b!==c;)this._removeSingleCharAndStyle(c+1),b--;this.setSelectionStart(c)},_removeSingleCharAndStyle:function(c){var b="\n"===this.text[c-1];this.removeStyleObject(b,b?c:c-1);this.text=this.text.slice(0,c-1)+this.text.slice(c);this._textLines=this._splitTextIntoLines()},insertChars:function(c,b){var a;if(1<this.selectionEnd-this.selectionStart&&(this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart)),
!b&&this.isEmptyStyles())return void this.insertChar(c,!1);for(var d=0,g=c.length;g>d;d++)b&&(a=fabric.copiedTextStyle[d]),this.insertChar(c[d],g-1>d,a)},insertChar:function(c,b,a){var d="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+c+this.text.slice(this.selectionEnd);this._textLines=this._splitTextIntoLines();this.insertStyleObjects(c,d,a);this.selectionEnd=this.selectionStart+=c.length;b||(this._updateTextarea(),this.canvas&&this.canvas.renderAll(),this.setCoords(),
this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this}))},insertNewlineStyleObject:function(c,b,a){this.shiftLineStyles(c,1);this.styles[c+1]||(this.styles[c+1]={});var e={},g={};if(this.styles[c]&&this.styles[c][b-1]&&(e=this.styles[c][b-1]),a)g[0]=d(e);else for(var f in this.styles[c])parseInt(f,10)>=b&&(g[parseInt(f,10)-b]=this.styles[c][f],delete this.styles[c][f]);this.styles[c+1]=g;this._forceClearCache=!0},insertCharStyleObject:function(c,b,a){var e=this.styles[c],
g=d(e);0!==b||a||(b=1);for(var f in g){var h=parseInt(f,10);h>=b&&(e[h+1]=g[h],g[h-1]||delete e[h])}this.styles[c][b]=a||d(e[b-1]);this._forceClearCache=!0},insertStyleObjects:function(c,b,a){var d=this.get2DCursorLocation(),g=d.lineIndex,d=d.charIndex;this._getLineStyle(g)||this._setLineStyle(g,{});"\n"===c?this.insertNewlineStyleObject(g,d,b):this.insertCharStyleObject(g,d,a)},shiftLineStyles:function(c,b){var a=d(this.styles),e;for(e in this.styles){var g=parseInt(e,10);g>c&&(this.styles[g+b]=
a[g],a[g-b]||delete this.styles[g])}},removeStyleObject:function(c,b){var a=this.get2DCursorLocation(b);this._removeStyleObject(c,a,a.lineIndex,a.charIndex)},_getTextOnPreviousLine:function(c){return this._textLines[c-1]},_removeStyleObject:function(c,b,a,e){if(c){var g=this._getTextOnPreviousLine(b.lineIndex),g=g?g.length:0;this.styles[a-1]||(this.styles[a-1]={});for(e in this.styles[a])this.styles[a-1][parseInt(e,10)+g]=this.styles[a][e];this.shiftLineStyles(b.lineIndex,-1)}else for(g in(b=this.styles[a])&&
delete b[e],a=d(b),a)c=parseInt(g,10),c>=e&&0!==c&&(b[c-1]=a[c],delete b[c])},insertNewline:function(){this.insertChars("\n")}})})();
fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(d){this.__newClickTime=+new Date;var c=this.canvas.getPointer(d.e);this.isTripleClick(c)?(this.fire("tripleclick",d),this._stopEvent(d.e)):this.isDoubleClick(c)&&(this.fire("dblclick",d),this._stopEvent(d.e));this.__lastLastClickTime=this.__lastClickTime;
this.__lastClickTime=this.__newClickTime;this.__lastPointer=c;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(d){return 500>this.__newClickTime-this.__lastClickTime&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y&&this.__lastIsEditing},isTripleClick:function(d){return 500>this.__newClickTime-this.__lastClickTime&&500>this.__lastClickTime-this.__lastLastClickTime&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y},_stopEvent:function(d){d.preventDefault&&
d.preventDefault();d.stopPropagation&&d.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(d){this.selectWord(this.getSelectionStartFromPointer(d.e))});this.on("tripleclick",function(d){this.selectLine(this.getSelectionStartFromPointer(d.e))})},initMousedownHandler:function(){this.on("mousedown",function(d){if(this.editable){var c=this.canvas.getPointer(d.e);
this.__mousedownX=c.x;this.__mousedownY=c.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.selected&&this.setCursorByClick(d.e);this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))}})},_isObjectMoved:function(d){d=this.canvas.getPointer(d);return this.__mousedownX!==d.x||this.__mousedownY!==d.y},initMouseupHandler:function(){this.on("mouseup",function(d){this.__isMousedown=!1;this.editable&&
!this._isObjectMoved(d.e)&&(this.__lastSelected&&!this.__corner&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(d){var c=this.getSelectionStartFromPointer(d);d.shiftKey?c<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(c)):this.setSelectionEnd(c):(this.setSelectionStart(c),this.setSelectionEnd(c))},getSelectionStartFromPointer:function(d){for(var c=this.getLocalPointer(d),b=0,a=0,e=0,g=0,f=0,h=this._textLines.length;h>
f;f++){d=this._textLines[f];e+=this._getHeightOfLine(this.ctx,f)*this.scaleY;a=this._getLineWidth(this.ctx,f);a=this._getLineLeftOffset(a)*this.scaleX;this.flipX&&(this._textLines[f]=d.reverse().join(""));for(var k=0,l=d.length;l>k;k++){if(b=a,a+=this._getWidthOfChar(this.ctx,d[k],f,this.flipX?l-k:k)*this.scaleX,!(e<=c.y||a<=c.x))return this._getNewSelectionStartFromOffset(c,b,a,g+f,l);g++}if(c.y<e)return this._getNewSelectionStartFromOffset(c,b,a,g+f-1,l)}return this.text.length},_getNewSelectionStartFromOffset:function(d,
c,b,a,e){d=a+(b-d.x>d.x-c?0:1);return this.flipX&&(d=e-d),d>this.text.length&&(d=this.text.length),d}});
fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,
"input",this.onInput.bind(this));fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",
37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(d){if(this.isEditing){if(d.keyCode in this._keysMap)this[this._keysMap[d.keyCode]](d);else{if(!(d.keyCode in this._ctrlKeysMap&&(d.ctrlKey||d.metaKey)))return;this[this._ctrlKeysMap[d.keyCode]](d)}d.stopImmediatePropagation();d.preventDefault();this.canvas&&this.canvas.renderAll()}},
onInput:function(d){if(this.isEditing){var c=this.selectionStart||0,c=this.hiddenTextarea.value.slice(c,c+(this.hiddenTextarea.value.length-this.text.length+(this.selectionEnd||0)-c));this.insertChars(c);d.stopPropagation()}},forwardDelete:function(d){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length)return;this.moveCursorRight(d)}this.removeChars(d)},copy:function(d){var c=this.getSelectedText();(d=this._getClipboardData(d))&&d.setData("text",c);fabric.copiedText=
c;fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(d){var c=null,b=this._getClipboardData(d),a=!0;b?(c=b.getData("text").replace(/\r/g,""),fabric.copiedTextStyle&&fabric.copiedText===c||(a=!1)):c=fabric.copiedText;c&&this.insertChars(c,a);d.stopImmediatePropagation();d.preventDefault()},cut:function(d){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(d))},_getClipboardData:function(d){return d&&(d.clipboardData||fabric.window.clipboardData)},
getDownCursorOffset:function(d,c){var b;b=c?this.selectionEnd:this.selectionStart;var a=this.get2DCursorLocation(b),e=a.lineIndex,g=this._textLines[e].slice(0,a.charIndex),f=this._textLines[e].slice(a.charIndex),h=this._textLines[e+1]||"";if(e===this._textLines.length-1||d.metaKey||34===d.keyCode)return this.text.length-b;b=this._getLineWidth(this.ctx,e);for(var k=this._getLineLeftOffset(b),l=0,p=g.length;p>l;l++)b=g[l],k+=this._getWidthOfChar(this.ctx,b,e,l);a=this._getIndexOnNextLine(a,h,k);return f.length+
1+a},_getIndexOnNextLine:function(d,c,b){var a;d=d.lineIndex+1;for(var e=this._getLineWidth(this.ctx,d),e=this._getLineLeftOffset(e),g=0,f=0,h=c.length;h>f;f++){var k=this._getWidthOfChar(this.ctx,c[f],d,f);if(e+=k,e>b){a=!0;g=Math.abs(e-k-b)>Math.abs(e-b)?f+1:f;break}}return a||(g=c.length),g},moveCursorDown:function(d){this.abortCursorAnimation();this._currentCursorOpacity=1;var c=this.getDownCursorOffset(d,"right"===this._selectionDirection);d.shiftKey?this.moveCursorDownWithShift(c):this.moveCursorDownWithoutShift(c);
this.initDelayedCursor()},moveCursorDownWithoutShift:function(d){this._selectionDirection="right";this.setSelectionStart(this.selectionStart+d);this.setSelectionEnd(this.selectionStart)},swapSelectionPoints:function(){var d=this.selectionEnd;this.setSelectionEnd(this.selectionStart);this.setSelectionStart(d)},moveCursorDownWithShift:function(d){this.selectionEnd===this.selectionStart&&(this._selectionDirection="right");"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd+d):this.setSelectionStart(this.selectionStart+
d);this.selectionEnd<this.selectionStart&&"left"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="right");this.selectionEnd>this.text.length&&this.setSelectionEnd(this.text.length)},getUpCursorOffset:function(d,c){var b=c?this.selectionEnd:this.selectionStart,a=this.get2DCursorLocation(b),e=a.lineIndex;if(0===e||d.metaKey||33===d.keyCode)return b;var g,b=this._textLines[e].slice(0,a.charIndex),f=this._textLines[e-1]||"";g=this._getLineWidth(this.ctx,a.lineIndex);for(var h=
this._getLineLeftOffset(g),k=0,l=b.length;l>k;k++)g=b[k],h+=this._getWidthOfChar(this.ctx,g,e,k);a=this._getIndexOnPrevLine(a,f,h);return f.length-a+b.length},_getIndexOnPrevLine:function(d,c,b){var a;d=d.lineIndex-1;for(var e=this._getLineWidth(this.ctx,d),e=this._getLineLeftOffset(e),g=0,f=0,h=c.length;h>f;f++){var k=this._getWidthOfChar(this.ctx,c[f],d,f);if(e+=k,e>b){a=!0;g=Math.abs(e-k-b)>Math.abs(e-b)?f:f-1;break}}return a||(g=c.length-1),g},moveCursorUp:function(d){this.abortCursorAnimation();
this._currentCursorOpacity=1;var c=this.getUpCursorOffset(d,"right"===this._selectionDirection);d.shiftKey?this.moveCursorUpWithShift(c):this.moveCursorUpWithoutShift(c);this.initDelayedCursor()},moveCursorUpWithShift:function(d){this.selectionEnd===this.selectionStart&&(this._selectionDirection="left");"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd-d):this.setSelectionStart(this.selectionStart-d);this.selectionEnd<this.selectionStart&&"right"===this._selectionDirection&&
(this.swapSelectionPoints(),this._selectionDirection="left")},moveCursorUpWithoutShift:function(d){this.selectionStart===this.selectionEnd&&this.setSelectionStart(this.selectionStart-d);this.setSelectionEnd(this.selectionStart);this._selectionDirection="left"},moveCursorLeft:function(d){0===this.selectionStart&&0===this.selectionEnd||(this.abortCursorAnimation(),this._currentCursorOpacity=1,d.shiftKey?this.moveCursorLeftWithShift(d):this.moveCursorLeftWithoutShift(d),this.initDelayedCursor())},_move:function(d,
c,b){var a="selectionStart"===c?"setSelectionStart":"setSelectionEnd";d.altKey?this[a](this["findWordBoundary"+b](this[c])):d.metaKey||35===d.keyCode||36===d.keyCode?this[a](this["findLineBoundary"+b](this[c])):this[a](this[c]+("Left"===b?-1:1))},_moveLeft:function(d,c){this._move(d,c,"Left")},_moveRight:function(d,c){this._move(d,c,"Right")},moveCursorLeftWithoutShift:function(d){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(d,"selectionStart");this.setSelectionEnd(this.selectionStart)},
moveCursorLeftWithShift:function(d){"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(d,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(d,"selectionStart"))},moveCursorRight:function(d){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,d.shiftKey?this.moveCursorRightWithShift(d):this.moveCursorRightWithoutShift(d),this.initDelayedCursor())},moveCursorRightWithShift:function(d){"left"===
this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(d,"selectionStart"):(this._selectionDirection="right",this._moveRight(d,"selectionEnd"))},moveCursorRightWithoutShift:function(d){this._selectionDirection="right";this.selectionStart===this.selectionEnd?(this._moveRight(d,"selectionStart"),this.setSelectionEnd(this.selectionStart)):(this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText()),this.setSelectionStart(this.selectionEnd))},removeChars:function(d){this.selectionStart===
this.selectionEnd?this._removeCharsNearCursor(d):this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.setSelectionEnd(this.selectionStart);this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(d){0!==this.selectionStart&&(d.metaKey?(d=this.findLineBoundaryLeft(this.selectionStart),this._removeCharsFromTo(d,this.selectionStart),this.setSelectionStart(d)):
d.altKey?(d=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(d,this.selectionStart),this.setSelectionStart(d)):(this._removeSingleCharAndStyle(this.selectionStart),this.setSelectionStart(this.selectionStart-1)))}});
(function(){var d=fabric.util.toFixed,c=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(b,a,c,d,f,h){this.styles[b]?this._setSVGTextLineChars(b,a,c,d,h):fabric.Text.prototype._setSVGTextLineText.call(this,b,a,c,d,f)},_setSVGTextLineChars:function(b,a,c,d,f){c=this._textLines[b];d=0;for(var h=this._getLineLeftOffset(this._getLineWidth(this.ctx,b))-this.width/2,k=this._getSVGLineTopOffset(b),l=this._getHeightOfLine(this.ctx,b),p=0,m=c.length;m>
p;p++){var n=this.styles[b][p]||{};a.push(this._createTextCharSpan(c[p],n,h,k.lineTop+k.offset,d));var u=this._getWidthOfChar(this.ctx,c[p],b,p);n.textBackgroundColor&&f.push(this._createTextCharBg(n,h,k.lineTop,l,u,d));d+=u}},_getSVGLineTopOffset:function(b){for(var a=0,c=0,d=0;b>d;d++)a+=this._getHeightOfLine(this.ctx,d);return c=this._getHeightOfLine(this.ctx,d),{lineTop:a,offset:(this._fontSizeMult-this._fontSizeFraction)*c/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(b,a,
e,g,f,h){return['<rect fill="',b.textBackgroundColor,'" x="',d(a+h,c),'" y="',d(e-this.height/2,c),'" width="',d(f,c),'" height="',d(g/this.lineHeight,c),'"></rect>'].join("")},_createTextCharSpan:function(b,a,e,g,f){var h=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text",getSvgFilter:fabric.Object.prototype.getSvgFilter},a));return['<tspan x="',d(e+f,c),'" y="',d(g-this.height/2,c),'" ',a.fontFamily?'font-family="'+a.fontFamily.replace(/"/g,
"'")+'" ':"",a.fontSize?'font-size="'+a.fontSize+'" ':"",a.fontStyle?'font-style="'+a.fontStyle+'" ':"",a.fontWeight?'font-weight="'+a.fontWeight+'" ':"",a.textDecoration?'text-decoration="'+a.textDecoration+'" ':"",'style="',h,'">',fabric.util.string.escapeXml(b),"</tspan>"].join("")}})})();
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.clone;c.Textbox=c.util.createClass(c.IText,c.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:0,__cachedLines:null,initialize:function(a,b){this.ctx=c.util.createCanvasElement().getContext("2d");this.callSuper("initialize",a,b);this.set({lockUniScaling:!1,lockScalingY:!0,lockScalingFlip:!0,hasBorders:!0});this.setControlsVisibility(c.Textbox.getTextboxControlVisibility());this._dimensionAffectingProps.width=!0},_initDimensions:function(a){this.__skipDimension||
(a||(a=c.util.createCanvasElement().getContext("2d"),this._setTextStyles(a)),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(a))},_generateStyleMap:function(){for(var a=0,b=0,c=0,d={},h=0;h<this._textLines.length;h++)"\n"===this.text[c]?(b=0,c++,a++):" "===this.text[c]&&(b++,c++),d[h]={line:a,offset:b},c+=this._textLines[h].length,b+=this._textLines[h].length;
return d},_getStyleDeclaration:function(a,b,c){if(this._styleMap){var d=this._styleMap[a];if(!d)return c?{}:null;a=d.line;b=d.offset+b}return this.callSuper("_getStyleDeclaration",a,b,c)},_setStyleDeclaration:function(a,b,c){var d=this._styleMap[a];a=d.line;b=d.offset+b;this.styles[a][b]=c},_deleteStyleDeclaration:function(a,b){var c=this._styleMap[a];a=c.line;b=c.offset+b;delete this.styles[a][b]},_getLineStyle:function(a){return this.styles[this._styleMap[a].line]},_setLineStyle:function(a,b){this.styles[this._styleMap[a].line]=
b},_deleteLineStyle:function(a){delete this.styles[this._styleMap[a].line]},_wrapText:function(a,b){var c,d=b.split(this._reNewline),h=[];for(c=0;c<d.length;c++)h=h.concat(this._wrapLine(a,d[c],c));return h},_measureText:function(a,b,c,d){var h=0;d=d||0;for(var k=0,l=b.length;l>k;k++)h+=this._getWidthOfChar(a,b[k],c,k+d);return h},_wrapLine:function(a,b,c){var d=0,h=[],k="";b=b.split(" ");for(var l="",p=0,m=0,n=0,u=0,x=0;x<b.length;x++)l=b[x],m=this._measureText(a,l,c,p),p+=l.length,d+=n+m,d>=this.width&&
""!==k&&(h.push(k),k="",d=m),""===k&&1!==x||(k+=" "),k+=l,n=this._measureText(a," ",c,p),p++,m>u&&(u=m);return x&&h.push(k),u>this.dynamicMinWidth&&(this.dynamicMinWidth=u),h},_splitTextIntoLines:function(){var a=this.textAlign;this.ctx.save();this._setTextStyles(this.ctx);this.textAlign="left";var b=this._wrapText(this.ctx,this.text);return this.textAlign=a,this.ctx.restore(),this._textLines=b,this._styleMap=this._generateStyleMap(),b},setOnGroup:function(a,b){"scaleX"===a&&(this.set("scaleX",Math.abs(1/
b)),this.set("width",this.get("width")*b/("undefined"==typeof this.__oldScaleX?1:this.__oldScaleX)),this.__oldScaleX=b)},get2DCursorLocation:function(a){"undefined"==typeof a&&(a=this.selectionStart);for(var b=this._textLines.length,c=0,d=0;b>d;d++){var h=this._textLines[d].length;if(c+h>=a)return{lineIndex:d,charIndex:a-c};c+=h;"\n"!==this.text[c]&&" "!==this.text[c]||c++}return{lineIndex:b-1,charIndex:this._textLines[b-1].length}},_getCursorBoundariesOffsets:function(a,b){for(var c=0,d=0,h=this.get2DCursorLocation(),
k=this._textLines[h.lineIndex].split(""),l=this._getLineLeftOffset(this._getLineWidth(this.ctx,h.lineIndex)),p=0;p<h.charIndex;p++)d+=this._getWidthOfChar(this.ctx,k[p],h.lineIndex,p);for(p=0;p<h.lineIndex;p++)c+=this._getHeightOfLine(this.ctx,p);return"cursor"===b&&(c+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,h.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(h.lineIndex,h.charIndex)*(1-this._fontSizeFraction)),{top:c,left:d,lineLeft:l}},getMinWidth:function(){return Math.max(this.minWidth,
this.dynamicMinWidth)},toObject:function(a){return c.util.object.extend(this.callSuper("toObject",a),{minWidth:this.minWidth})}});c.Textbox.fromObject=function(a){return new c.Textbox(a.text,b(a))};c.Textbox.getTextboxControlVisibility=function(){return{tl:!1,tr:!1,br:!1,bl:!1,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}};c.Textbox.instances=[]})("undefined"!=typeof exports?exports:this);
(function(){var d=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(b,a,c,g,f,h,k){var l=a.target;l instanceof fabric.Textbox?(b=b.x/a.scaleX/(l.width+l.strokeWidth)*l.width,b>=l.getMinWidth()&&l.set("width",b)):d.call(fabric.Canvas.prototype,b,a,c,g,f,h,k)};fabric.Group.prototype._refreshControlsVisibility=function(){if("undefined"!=typeof fabric.Textbox)for(var b=this._objects.length;b--;)if(this._objects[b]instanceof fabric.Textbox)return void this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility())};
var c=fabric.util.object.clone;fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var b in this._styleMap)this._textLines[b]||delete this.styles[this._styleMap[b].line]},insertCharStyleObject:function(b,a,c){var d=this._styleMap[b];b=d.line;a=d.offset+a;fabric.IText.prototype.insertCharStyleObject.apply(this,[b,a,c])},insertNewlineStyleObject:function(b,a,c){var d=this._styleMap[b];b=d.line;a=d.offset+a;fabric.IText.prototype.insertNewlineStyleObject.apply(this,
[b,a,c])},shiftLineStyles:function(b,a){var d=c(this.styles);b=this._styleMap[b].line;for(var g in this.styles){var f=parseInt(g,10);f>b&&(this.styles[f+a]=d[f],d[f-a]||delete this.styles[f])}},_getTextOnPreviousLine:function(b){for(var a=this._textLines[b-1];this._styleMap[b-2]&&this._styleMap[b-2].line===this._styleMap[b-1].line;)a=this._textLines[b-2]+a,b--;return a},removeStyleObject:function(b,a){var c=this.get2DCursorLocation(a),d=this._styleMap[c.lineIndex];this._removeStyleObject(b,c,d.line,
d.offset+c.charIndex)}})})();(function(){var d=fabric.IText.prototype._getNewSelectionStartFromOffset;fabric.IText.prototype._getNewSelectionStartFromOffset=function(c,b,a,e,g){e=d.call(this,c,b,a,e,g);for(a=b=c=0;a<this._textLines.length&&(c+=this._textLines[a].length,!(c+b>=e));a++)"\n"!==this.text[c+b]&&" "!==this.text[c+b]||b++;return e-a+b}})();
(function(){function d(b,c,d){var f=a.parse(b);f.port||(f.port=0===f.protocol.indexOf("https:")?443:80);b=(0===f.protocol.indexOf("https:")?g:e).request({hostname:f.hostname,port:f.port,path:f.path,method:"GET"},function(a){var b="";c&&a.setEncoding(c);a.on("end",function(){d(b)});a.on("data",function(c){200===a.statusCode&&(b+=c)})});b.on("error",function(a){a.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+f.hostname+":"+f.port):fabric.log(a.message);d(null)});b.end()}
function c(a,b){require("fs").readFile(a,function(a,c){if(a)throw fabric.log(a),a;b(c)})}if("undefined"==typeof document||"undefined"==typeof window){var b=require("xmldom").DOMParser,a=require("url"),e=require("http"),g=require("https"),f=require("canvas"),h=require("canvas").Image;fabric.util.loadImage=function(a,b,e){function f(c){c?(g.src=new Buffer(c,"binary"),g._src=a,b&&b.call(e,g)):(g=null,b&&b.call(e,null,!0))}var g=new h;a&&(a instanceof Buffer||0===a.indexOf("data"))?(g.src=g._src=a,b&&
b.call(e,g)):a&&0!==a.indexOf("http")?c(a,f):a?d(a,"binary",f):b&&b.call(e,a)};fabric.loadSVGFromURL=function(a,b,e){a=a.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();0!==a.indexOf("http")?c(a,function(a){fabric.loadSVGFromString(a.toString(),b,e)}):d(a,"",function(a){fabric.loadSVGFromString(a,b,e)})};fabric.loadSVGFromString=function(a,c,d){a=(new b).parseFromString(a);fabric.parseSVGDocument(a.documentElement,function(a,b){c&&c(a,b)},d)};fabric.util.getScript=function(a,b){d(a,"",function(a){eval(a);
b&&b()})};fabric.Image.fromObject=function(a,b){fabric.util.loadImage(a.src,function(c){var d=new fabric.Image(c);d._initConfig(a);d._initFilters(a.filters,function(c){d.filters=c||[];d._initFilters(a.resizeFilters,function(a){d.resizeFilters=a||[];b&&b(d)})})})};fabric.createCanvasForNode=function(a,b,c,d){d=d||c;var e=fabric.document.createElement("canvas");a=new f(a||600,b||600,d);e.style={};e.width=a.width;e.height=a.height;c=new (fabric.Canvas||fabric.StaticCanvas)(e,c);return c.contextContainer=
a.getContext("2d"),c.nodeCanvas=a,c.Font=f.Font,c};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)};var k=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(a,b){return k.call(this,a,b),this.nodeCanvas.width=a,this};fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var l=fabric.StaticCanvas.prototype.setHeight;
fabric.StaticCanvas.prototype.setHeight=function(a,b){return l.call(this,a,b),this.nodeCanvas.height=a,this};fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}})();
function initAligningGuidelines(d){function c(b,c,d,f){a.save();a.lineWidth=1;a.strokeStyle="rgb(0,255,0)";a.beginPath();a.moveTo((b+e[4])*g,(c+e[5])*g);a.lineTo((d+e[4])*g,(f+e[5])*g);a.stroke();a.restore()}function b(a,b){a=Math.round(a);b=Math.round(b);for(var c=a-4,d=a+4;c<=d;c++)if(c===b)return!0;return!1}var a=d.getSelectionContext(),e,g=1,f=[],h=[];d.on("mouse:down",function(){e=d.viewportTransform;g=d.getZoom()});d.on("object:moving",function(a){a=a.target;var c=d.getObjects(),g=a.getCenterPoint(),
m=g.x,g=g.y,n=a.getBoundingRectHeight()/e[3],u=a.getBoundingRectWidth()/e[0],x=!1,y=!1;if(d._currentTransform){for(var z=c.length;z--;)if(c[z]!==a){var t=c[z].getCenterPoint(),r=t.x,t=t.y,v=c[z].getBoundingRectHeight()/e[3],q=c[z].getBoundingRectWidth()/e[0];b(r,m)&&(y=!0,f.push({x:r,y1:t<g?t-v/2-5:t+v/2+5,y2:g>t?g+n/2+5:g-n/2-5}),a.setPositionByOrigin(new fabric.Point(r,g),"center","center"));b(r-q/2,m-u/2)&&(y=!0,f.push({x:r-q/2,y1:t<g?t-v/2-5:t+v/2+5,y2:g>t?g+n/2+5:g-n/2-5}),a.setPositionByOrigin(new fabric.Point(r-
q/2+u/2,g),"center","center"));b(r+q/2,m+u/2)&&(y=!0,f.push({x:r+q/2,y1:t<g?t-v/2-5:t+v/2+5,y2:g>t?g+n/2+5:g-n/2-5}),a.setPositionByOrigin(new fabric.Point(r+q/2-u/2,g),"center","center"));b(t,g)&&(x=!0,h.push({y:t,x1:r<m?r-q/2-5:r+q/2+5,x2:m>r?m+u/2+5:m-u/2-5}),a.setPositionByOrigin(new fabric.Point(m,t),"center","center"));b(t-v/2,g-n/2)&&(x=!0,h.push({y:t-v/2,x1:r<m?r-q/2-5:r+q/2+5,x2:m>r?m+u/2+5:m-u/2-5}),a.setPositionByOrigin(new fabric.Point(m,t-v/2+n/2),"center","center"));b(t+v/2,g+n/2)&&
(x=!0,h.push({y:t+v/2,x1:r<m?r-q/2-5:r+q/2+5,x2:m>r?m+u/2+5:m-u/2-5}),a.setPositionByOrigin(new fabric.Point(m,t+v/2-n/2),"center","center"))}x||(h.length=0);y||(f.length=0)}});d.on("before:render",function(){d.clearContext(d.contextTop)});d.on("after:render",function(){for(var a=f.length;a--;){var b=f[a];c(b.x+.5,b.y1>b.y2?b.y2:b.y1,b.x+.5,b.y2>b.y1?b.y2:b.y1)}for(a=h.length;a--;)b=h[a],c(b.x1>b.x2?b.x2:b.x1,b.y+.5,b.x2>b.x1?b.x2:b.x1,b.y+.5);f.length=h.length=0});d.on("mouse:up",function(){f.length=
h.length=0;d.renderAll()})}
(function(){function d(a,c){a=void 0===a?"":a;c=void 0===c?"":c;""==a&&null!=document.getElementById("canva-row")?b.setWidth(document.getElementById("canva-row").offsetWidth):(b.setWidth(a),b.setHeight(c))}function c(a){fabric.Image.fromURL(a,function(a){b.add(a.set({left:110,top:110}).scale(.5))})}var b=new fabric.Canvas("canvas");b.backgroundColor="white";$("#canva-row").hide();$(".item-handler").hide();null!=document.getElementById("fileupload")&&(document.getElementById("fileupload").onchange=function(a){var c=
new FileReader;$("#canva-row").show();$(".item-handler").show();c.onload=function(a){console.log("fdsf");$(".button-submit").show({duration:"260",easing:"easeInOutBack"});var c=new Image;c.src=a.target.result;c.onload=function(){var a=new fabric.Image(c);d(a.width,a.height);a.set("selectable",!1);b.add(a);b.centerObject(a)}};c.readAsDataURL(a.target.files[0])});window.addEventListener("resize",d,!1);d();initAligningGuidelines(b);b.observe("object:modified",function(a){a.target.straighten(45)});$(".menu img, .menu > img").on("click",
function(){c(this.src)});$("#saveToPng").on("click",function(){b.setActiveGroup(new fabric.Group(b.getObjects())).renderAll();var a=b.getActiveGroup();b.discardActiveObject().renderAll();b.discardActiveGroup().renderAll();var c=document.createElement("canvas"),d=c.getContext("2d");c.width=a.width+60;c.height=a.height+60;var f=a.left-a.width/2-30,h=a.top-a.height/2-30;0>f&&(f=0);0>h&&(h=0);d.drawImage(b.getElement(),f,h,a.width+60,a.height+60,0,0,a.width+60,a.height+60);Canvas2Image.saveAsJPEG(c)});
$("#delete").on("click",function(){b.remove(b.getActiveObject())});$("#addText").on("click",function(){var a=new fabric.Text($("#canvaText").val(),{left:210,top:110});b.add(a)});$("#send_image").click(function(a){a.preventDefault();var c=$(this).next(".msg");b.discardActiveGroup();b.discardActiveObject();b.renderAll();$.ajax({url:"upload/upload_result?type=fabric",type:"POST",dataType:"json",data:{data:b.toDataURL("image/png"),csrf_token:$.cookie("csrf_cookie")},complete:function(a,b){var d=a.responseJSON;
console.log(d);c.empty();c.html('<div class="alert alert-danger msg"><button class="close" data-close="alert"></button>'+d.result.text+"</div>");1===d.result.code&&setTimeout(function(){window.location.href=base_URL+"fabric"},2E3);"success"==b&&alert("saved!")}})})})();
